(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4fb56773"],{"0115":function(e,t,a){},"257c":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=this,a=t.$createElement,r=t._self._c||a;return r("div",{staticClass:"ldap-account-layout"},[r("a-row",{attrs:{gutter:0}},[r("a-col",{attrs:{md:24,lg:16}},[r("a-card",{attrs:{bordered:!1}},[r("a-input-search",{staticStyle:{"margin-bottom":"10px"},attrs:{placeholder:t.$t("label.search")},on:{search:t.handleSearch},model:{value:t.searchQuery,callback:function(e){t.searchQuery=e},expression:"searchQuery"}}),r("a-table",{staticStyle:{"overflow-y":"auto"},attrs:{size:"small",loading:t.listLoading,columns:t.columns,dataSource:t.dataSource,rowSelection:{columnWidth:50,selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange},rowKey:function(e){return e.username},rowClassName:t.getRowClassName,pagination:!1,scroll:{y:"50vh"}}})],1)],1),r("a-col",{attrs:{md:24,lg:8}},[r("a-card",{attrs:{bordered:!1}},[r("a-form",{attrs:{form:t.form,layout:"vertical"},on:{submit:t.handleSubmit}},[r("a-form-item",{attrs:{label:t.$t("label.filterby")}},[r("a-select",{on:{change:t.fetchListLdapUsers},model:{value:t.selectedFilter,callback:function(e){t.selectedFilter=e},expression:"selectedFilter"}},t._l(t.filters,(function(e){return r("a-select-option",{key:e.id},[t._v(" "+t._s(e.name)+" ")])})),1)],1),r("a-form-item",{attrs:{label:t.$t("label.domain")}},[r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["domainid",{rules:[{required:!0,memessage:""+this.$t("message.error.select")}]}],expression:"['domainid', {\n                rules: [{ required: true, memessage: `${this.$t('message.error.select')}` }]\n              }]"}],attrs:{showSearch:"",placeholder:t.apiParams.domainid.description,loading:t.domainLoading},on:{change:function(e){return t.fetchListLdapUsers(e)}}},t._l(t.listDomains,(function(e){return r("a-select-option",{key:e.name},[t._v(" "+t._s(e.name)+" ")])})),1)],1),r("a-form-item",{attrs:{label:t.$t("label.account")}},[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["account"],expression:"['account']"}],attrs:{placeholder:t.apiParams.account.description}})],1),r("a-form-item",{attrs:{label:t.$t("label.role")}},[r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["roleid",{rules:[{required:!0,message:""+this.$t("message.error.select")}]}],expression:"['roleid', {\n                rules: [{ required: true, message: `${this.$t('message.error.select')}` }]\n              }]"}],attrs:{showSearch:"",placeholder:t.apiParams.roleid.description,loading:t.roleLoading}},t._l(t.listRoles,(function(e){return r("a-select-option",{key:e.name},[t._v(" "+t._s(e.name)+" ")])})),1)],1),r("a-form-item",{attrs:{label:t.$t("label.timezone")}},[r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["timezone"],expression:"['timezone']"}],attrs:{showSearch:"",placeholder:t.apiParams.timezone.description,loading:t.timeZoneLoading}},t._l(t.timeZoneMap,(function(e){return r("a-select-option",{key:e.id},[t._v(" "+t._s(e.name||e.description)+" ")])})),1)],1),r("a-form-item",{attrs:{label:t.$t("label.networkdomain")}},[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["networkdomain"],expression:"['networkdomain']"}],attrs:{placeholder:t.apiParams.networkdomain.description}})],1),r("a-form-item",{attrs:{label:t.$t("label.ldap.group.name")}},[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["group"],expression:"['group']"}],attrs:{placeholder:t.apiParams.group.description}})],1),"authorizeSamlSso"in t.$store.getters.apis?r("div",[r("a-form-item",{attrs:{label:t.$t("label.samlenable")}},[r("a-switch",{directives:[{name:"decorator",rawName:"v-decorator",value:["samlEnable"],expression:"['samlEnable']"}],on:{change:function(t){e.samlEnable=t}}})],1),t.samlEnable?r("a-form-item",{attrs:{label:t.$t("label.samlentity")}},[r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["samlEntity",{initialValue:t.selectedIdp,rules:[{required:t.samlEnable,message:""+this.$t("message.error.select")}]}],expression:"['samlEntity', {\n                  initialValue: selectedIdp,\n                  rules: [{ required: samlEnable, message: `${this.$t('message.error.select')}` }]\n                }]"}],attrs:{placeholder:t.$t("label.choose.saml.indentity"),loading:t.loading}},t._l(t.listIdps,(function(e,a){return r("a-select-option",{key:a},[t._v(" "+t._s(e.orgName)+" ")])})),1)],1):t._e()],1):t._e(),r("div",{staticClass:"card-footer"},[r("a-button",{on:{click:t.handleClose}},[t._v(t._s(t.$t("label.close")))]),r("a-button",{attrs:{loading:t.loading,type:"primary"},on:{click:t.handleSubmit}},[t._v(t._s(t.$t("label.add")))])],1)],1)],1)],1)],1)],1)},n=[],i=(a("a4d3"),a("e01a"),a("d28b"),a("4de4"),a("4160"),a("c975"),a("a15b"),a("b0c0"),a("d3b7"),a("3ca3"),a("498a"),a("159b"),a("ddb0"),a("d0af")),o=(a("96cf"),a("c964")),s=a("365c"),l=a("e95a3"),c=a("4360"),d={name:"AddLdapAccount",data:function(){return{columns:[],dataSource:[],oldDataSource:[],selectedRowKeys:[],listDomains:[],listRoles:[],timeZoneMap:[],listIdps:[],selectedIdp:"",filters:[],selectedFilter:"",listLoading:!1,timeZoneLoading:!1,domainLoading:!1,roleLoading:!1,loading:!1,searchQuery:void 0,samlEnable:!1}},beforeCreate:function(){var e=this;this.form=this.$form.createForm(this),this.apiLdapCreateAccountConfig=this.$store.getters.apis.ldapCreateAccount||{},this.apiImportLdapUsersConfig=this.$store.getters.apis.importLdapUsers||{},this.apiParams={},this.apiLdapCreateAccountConfig.params.forEach((function(t){e.apiParams[t.name]=t})),this.apiImportLdapUsersConfig.params.forEach((function(t){e.apiParams&&e.apiParams[t.name]||(e.apiParams[t.name]=t)}))},created:function(){this.selectedRowKeys=[],this.dataSource=[],this.listDomains=[],this.listRoles=[],this.listIdps=[],this.columns=[{title:this.$t("label.name"),dataIndex:"name",width:120,scopedSlots:{customRender:"name"}},{title:this.$t("label.username"),dataIndex:"username",width:120,scopedSlots:{customRender:"username"}},{title:this.$t("label.email"),dataIndex:"email",scopedSlots:{customRender:"email"}},{title:this.$t("label.user.conflict"),dataIndex:"conflictingusersource",scopedSlots:{customRender:"conflictingusersource"}}],this.filters=[{id:"NoFilter",name:"No filter"},{id:"LocalDomain",name:"Local domain"},{id:"AnyDomain",name:"Any domain"},{id:"PotentialImport",name:"Potential import"}],this.selectedFilter=this.filters[0].id},mounted:function(){this.fetchData()},methods:{fetchData:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,r,n,o,s,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.timeZoneLoading=!0,e.domainLoading=!0,e.roleLoading=!0,e.fetchListLdapUsers(),t.next=6,Promise.all([e.fetchTimeZone(),e.fetchListDomains(),e.fetchListRoles(),"listIdps"in e.$store.getters.apis?e.fetchIdps():[]]).catch((function(t){e.$notifyError(t)})).finally((function(){e.timeZoneLoading=!1,e.domainLoading=!1,e.roleLoading=!1}));case 6:a=t.sent,r=Object(i["a"])(a,4),n=r[0],o=r[1],s=r[2],l=r[3],e.timeZoneMap=n&&n.length>0?n:[],e.listDomains=o&&o.length>0?o:[],e.listRoles=s&&s.length>0?s:[],e.listIdps=l&&l.length>0?l:[];case 16:case"end":return t.stop()}}),t)})))()},fetchTimeZone:function(e){return new Promise((function(t,a){Object(l["a"])(e).then((function(e){t(e)})).catch((function(e){a(e)}))}))},fetchListLdapUsers:function(e){var t=this;this.listLoading=!0;var a={listtype:"new"};if(a.userfilter=this.selectedFilter,a.domainid=c["a"].getters.userInfo.domainid,e){var r=this.listDomains.filter((function(t){return t.name===e}));r.length>0&&(a.domainid=r[0].id)}Object(s["a"])("listLdapUsers",a).then((function(e){var a=e.ldapuserresponse.LdapUser;if(a)for(var r=a.length,n=0;n<r;n++)a[n].name=[a[n].firstname,a[n].lastname].join(" ");t.dataSource=a,t.oldDataSource=a})).catch((function(e){t.$notifyError(e)})).finally((function(){t.listLoading=!1}))},fetchListDomains:function(){return new Promise((function(e,t){var a={};Object(s["a"])("listDomains",a).then((function(t){var a=t.listdomainsresponse.domain;e(a)})).catch((function(e){t(e)}))}))},fetchListRoles:function(){return new Promise((function(e,t){var a={};Object(s["a"])("listRoles",a).then((function(t){var a=t.listrolesresponse.role;e(a)})).catch((function(e){t(e)}))}))},fetchIdps:function(){var e=this;return new Promise((function(t,a){Object(s["a"])("listIdps").then((function(a){var r=a.listidpsresponse.idp||[];0!==r.length&&(e.selectedIdp=r[0].id),t(r)})).catch((function(e){a(e)}))}))},handleSubmit:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,a){if(!e){var r="ldapCreateAccount",n=t.listDomains.filter((function(e){return e.name===a.domainid})),i=t.listRoles.filter((function(e){return e.name===a.roleid})),o=[],l={};l.domainid=n[0].id,l.roleid=i[0].id,l.account=a.account,l.timezone=a.timezone,l.networkdomain=a.networkdomain,a.group&&a.group.trim().length>0?(l.group=a.group,r="importLdapUsers",o.push(new Promise((function(e,t){Object(s["a"])(r,l).then((function(t){e(t)})).catch((function(e){t(e)}))})))):t.selectedRowKeys.forEach((function(e){l.username=e,o.push(new Promise((function(e,t){Object(s["a"])(r,l).then((function(t){e(t)})).catch((function(e){t(e)}))})))})),t.loading=!0,Promise.all(o).then((function(n){var i=!0,o=!1,s=void 0;try{for(var l,c=n[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var d=l.value;if("ldapCreateAccount"===r&&a.samlEnable){var u=d.createaccountresponse.account.user,m=a.samlEntity;u&&m&&t.authorizeUsersForSamlSSO(u,m)}else"importLdapUsers"===r&&d.ldapuserresponse&&a.samlEnable?t.$notification.error({message:t.$t("message.request.failed"),description:t.$t("message.error.enable.saml")}):"ldapCreateAccount"===r&&t.$notification.success({message:t.$t("label.add.ldap.account"),description:d.createaccountresponse.account.name})}}catch(e){o=!0,s=e}finally{try{i||null==c.return||c.return()}finally{if(o)throw s}}t.$emit("refresh-data"),t.handleClose()})).catch((function(e){t.$notifyError(e),t.$emit("refresh-data")})).finally((function(){t.loading=!1}))}}))},handleSearch:function(){var e=this;this.dataSource=this.oldDataSource,this.searchQuery&&0!==this.searchQuery.length&&(this.dataSource=this.dataSource.filter((function(t){return e.filterLdapUser(t)})))},filterLdapUser:function(e){switch(!0){case e.name&&e.name.toLowerCase().indexOf(this.searchQuery.toLowerCase())>-1:return e;case e.username&&e.username.toLowerCase().indexOf(this.searchQuery.toLowerCase())>-1:return e;case e.email&&e.email.toLowerCase().indexOf(this.searchQuery.toLowerCase())>-1:return e;default:break}},handleClose:function(){this.$emit("close-action")},authorizeUsersForSamlSSO:function(e,t){for(var a=this,r=[],n=function(){var a={enable:!0};a.userid=e[i].id,a.entityid=t,r.push(new Promise((function(e,t){Object(s["a"])("authorizeSamlSso",a).catch((function(e){t(e)}))})))},i=0;i<e.length;i++)n();Promise.all(r).catch((function(e){a.$notifyError(e)}))},onSelectChange:function(e){this.selectedRowKeys=e},getRowClassName:function(e,t){return t%2===0?"light-row":"dark-row"}}},u=d,m=(a("6117"),a("2877")),h=Object(m["a"])(u,r,n,!1,null,"655e19bb",null);t["default"]=h.exports},"498a":function(e,t,a){"use strict";var r=a("23e7"),n=a("58a8").trim,i=a("c8d2");r({target:"String",proto:!0,forced:i("trim")},{trim:function(){return n(this)}})},6117:function(e,t,a){"use strict";var r=a("0115"),n=a.n(r);n.a},c8d2:function(e,t,a){var r=a("d039"),n=a("5899"),i="​᠎";e.exports=function(e){return r((function(){return!!n[e]()||i[e]()!=i||n[e].name!==e}))}}}]);
//# sourceMappingURL=chunk-4fb56773.4bc02627.js.map