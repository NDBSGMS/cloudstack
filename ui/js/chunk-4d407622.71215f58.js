(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4d407622"],{"5be7":function(e,t,o){},"915a":function(e,t,o){"use strict";o.r(t);var s=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("a-table",{staticStyle:{"overflow-y":"auto"},attrs:{size:"small",loading:e.loading||e.fetchLoading,columns:e.columns,dataSource:e.dataSource,pagination:!1,rowKey:function(e){return e.zoneid}},scopedSlots:e._u([{key:"isready",fn:function(t,s){return o("div",{},[s.isready?o("span",[e._v(e._s(e.$t("label.yes")))]):o("span",[e._v(e._s(e.$t("label.no")))])])}},{key:"action",fn:function(t,s){return[o("span",{staticStyle:{"margin-right":"5px"}},[o("a-button",{attrs:{disabled:!("copyIso"in e.$store.getters.apis&&s.isready),icon:"copy",shape:"circle",loading:e.copyLoading},on:{click:function(t){return e.showCopyIso(s)}}})],1),o("span",{staticStyle:{"margin-right":"5px"}},["deleteIso"in e.$store.getters.apis?o("a-popconfirm",{attrs:{placement:"topRight",title:e.$t("message.action.delete.iso"),"ok-text":e.$t("label.yes"),"cancel-text":e.$t("label.no"),loading:e.deleteLoading},on:{confirm:function(t){return e.deleteIso(s)}}},[o("a-button",{attrs:{type:"danger",icon:"delete",shape:"circle"}})],1):e._e()],1)]}}])}),o("a-pagination",{staticClass:"row-element",attrs:{size:"small",current:e.page,pageSize:e.pageSize,total:e.itemCount,showTotal:function(t){return e.$t("label.total")+" "+t+" "+e.$t("label.items")},pageSizeOptions:["10","20","40","80","100"],showSizeChanger:""},on:{change:e.handleChangePage,showSizeChange:e.handleChangePageSize},scopedSlots:e._u([{key:"buildOptionText",fn:function(t){return[o("span",[e._v(e._s(t.value)+" / "+e._s(e.$t("label.page")))])]}}])}),"copyIso"in e.$store.getters.apis?o("a-modal",{staticStyle:{top:"20px"},attrs:{title:e.$t("label.action.copy.iso"),visible:e.showCopyActionForm,closable:!0,maskClosable:!1,okText:e.$t("label.ok"),cancelText:e.$t("label.cancel"),confirmLoading:e.copyLoading,centered:""},on:{ok:e.handleCopyIsoSubmit,cancel:e.onCloseCopyForm}},[o("a-spin",{attrs:{spinning:e.copyLoading}},[o("a-form",{attrs:{form:e.form,layout:"vertical"},on:{submit:e.handleCopyIsoSubmit}},[o("a-form-item",{attrs:{label:e.$t("label.zoneid")}},[o("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["zoneid",{rules:[{required:!0,message:""+this.$t("message.error.select")}]}],expression:"['zoneid', {\n              rules: [\n                {\n                  required: true,\n                  message: `${this.$t('message.error.select')}`\n                }\n              ]\n            }]"}],attrs:{id:"zone-selection",mode:"multiple",placeholder:e.$t("label.select.zones"),showSearch:"",optionFilterProp:"children",filterOption:function(e,t){return t.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0},loading:e.zoneLoading}},e._l(e.zones,(function(t){return o("a-select-option",{key:t.id},[e._v(" "+e._s(t.name)+" ")])})),1)],1)],1)],1)],1):e._e()],1)},n=[],i=(o("99af"),o("4de4"),o("4160"),o("caad"),o("c975"),o("a15b"),o("b0c0"),o("d3b7"),o("159b"),o("d0ff")),a=o("365c"),r={name:"IsoZones",props:{resource:{type:Object,required:!0},loading:{type:Boolean,default:!1}},data:function(){return{columns:[],dataSource:[],page:1,pageSize:10,itemCount:0,fetchLoading:!1,showCopyActionForm:!1,currentRecord:{},zones:[],zoneLoading:!1,copyLoading:!1,deleteLoading:!1}},beforeCreate:function(){var e=this;this.form=this.$form.createForm(this),this.apiConfigParams=this.$store.getters.apis.copyIso&&this.$store.getters.apis.copyIso.params||[],this.apiParams={},this.apiConfigParams.forEach((function(t){e.apiParams[t.name]=t}))},created:function(){this.columns=[{title:this.$t("label.zonename"),dataIndex:"zonename"},{title:this.$t("label.status"),dataIndex:"status"},{title:this.$t("label.isready"),dataIndex:"isready",scopedSlots:{customRender:"isready"}}],this.isActionPermitted()&&this.columns.push({title:"",dataIndex:"action",fixed:"right",width:100,scopedSlots:{customRender:"action"}});var e=this.$store.getters.userInfo;["Admin"].includes(e.roletype)||e.account===this.resource.account&&e.domain===this.resource.domain||(this.columns=this.columns.filter((function(e){return"status"!==e.dataIndex})))},mounted:function(){this.fetchData()},watch:{loading:function(e,t){e||this.fetchData()}},methods:{fetchData:function(){var e=this,t={};t.id=this.resource.id,t.isofilter="executable",t.listall=!0,t.page=this.page,t.pagesize=this.pageSize,this.dataSource=[],this.itemCount=0,this.fetchLoading=!0,Object(a["a"])("listIsos",t).then((function(t){e.dataSource=t.listisosresponse.iso||[],e.itemCount=t.listisosresponse.count||0})).catch((function(t){e.$notifyError(t)})).finally((function(){e.fetchLoading=!1}))},handleChangePage:function(e,t){this.page=e,this.pageSize=t,this.fetchData()},handleChangePageSize:function(e,t){this.page=e,this.pageSize=t,this.fetchData()},isActionPermitted:function(){return(["Admin"].includes(this.$store.getters.userInfo.roletype)||this.resource.domainid===this.$store.getters.userInfo.domainid&&this.resource.account===this.$store.getters.userInfo.account||this.resource.domainid===this.$store.getters.userInfo.domainid&&this.resource.projectid&&this.$store.getters.project&&this.$store.getters.project.id&&this.resource.projectid===this.$store.getters.project.id)&&(this.resource.isready||!this.resource.status||-1===this.resource.status.indexOf("Downloaded"))&&"system"!==this.resource.account},deleteIso:function(e){var t=this,o={id:e.id,zoneid:e.zoneid};this.deleteLoading=!0,Object(a["a"])("deleteIso",o).then((function(e){var o=e.deleteisoresponse.jobid;t.$store.dispatch("AddAsyncJob",{title:t.$t("label.action.delete.iso"),jobid:o,description:t.resource.name,status:"progress"});var s=1===t.dataSource.length;t.$pollJob({jobId:o,successMethod:function(e){s?t.$router.go(-1):t.fetchData()},errorMethod:function(){return t.fetchData()},loadingMessage:"".concat(t.$t("label.deleting.iso")," ").concat(t.resource.name," ").concat(t.$t("label.in.progress")),catchMessage:t.$t("error.fetching.async.job.result")})})).catch((function(e){t.$notifyError(e)})).finally((function(){t.deleteLoading=!1,t.fetchData()}))},fetchZoneData:function(){var e=this;this.zones=[],this.zoneLoading=!0,Object(a["a"])("listZones",{listall:!0}).then((function(t){var o=t.listzonesresponse.zone||[];e.zones=Object(i["a"])(o.filter((function(t){return e.currentRecord.zoneid!==t.id})))})).finally((function(){e.zoneLoading=!1}))},showCopyIso:function(e){this.currentRecord=e,this.form.setFieldsValue({zoneid:[]}),this.fetchZoneData(),this.showCopyActionForm=!0},onCloseCopyForm:function(){this.currentRecord={},this.showCopyActionForm=!1},handleCopyIsoSubmit:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,o){if(!e){var s={id:t.currentRecord.id,sourcezoneid:t.currentRecord.zoneid,destzoneids:o.zoneid.join()};t.copyLoading=!0,Object(a["a"])("copyIso",s).then((function(e){var o=e.copytemplateresponse.jobid;t.$store.dispatch("AddAsyncJob",{title:t.$t("label.action.copy.iso"),jobid:o,description:t.resource.name,status:"progress"}),t.$pollJob({jobId:o,successMethod:function(e){t.fetchData()},errorMethod:function(){return t.fetchData()},loadingMessage:"".concat(t.$t("label.action.copy.iso")," ").concat(t.resource.name," ").concat(t.$t("label.in.progress")),catchMessage:t.$t("error.fetching.async.job.result")})})).catch((function(e){t.$notification.error({message:t.$t("message.request.failed"),description:e.response&&e.response.headers&&e.response.headers["x-description"]||e.message})})).finally((function(){t.copyLoading=!1,t.$emit("refresh-data"),t.onCloseCopyForm(),t.fetchData()}))}}))}}},c=r,l=(o("f1f0"),o("2877")),d=Object(l["a"])(c,s,n,!1,null,"23a74f2e",null);t["default"]=d.exports},f1f0:function(e,t,o){"use strict";var s=o("5be7"),n=o.n(s);n.a}}]);
//# sourceMappingURL=chunk-4d407622.71215f58.js.map