(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-755ca4c4"],{"0ed2":function(t,e,a){"use strict";var n=a("63d4"),i=a.n(n);i.a},"63d4":function(t,e,a){},"65d4":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"take-snapshot"},[a("a-spin",{attrs:{spinning:t.loading||t.actionLoading}},[a("label",[t._v(" "+t._s(t.$t("label.header.volume.take.snapshot"))+" ")]),a("a-form",{staticClass:"form",attrs:{form:t.form,layout:"vertical"},on:{submit:t.handleSubmit}},[a("a-row",{attrs:{gutter:12}},[a("a-col",{attrs:{md:24,lg:24}},[a("a-form-item",{attrs:{label:t.$t("label.name")}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name"],expression:"['name']"}],attrs:{placeholder:t.apiParams.name.description}})],1)],1),a("a-col",{attrs:{md:24,lg:24}},[a("a-form-item",{attrs:{label:t.$t("label.asyncbackup")}},[a("a-switch",{directives:[{name:"decorator",rawName:"v-decorator",value:["asyncbackup"],expression:"['asyncbackup']"}]})],1)],1),t.quiescevm?a("a-col",{attrs:{md:24,lg:24}},[a("a-form-item",{attrs:{label:t.$t("label.quiescevm")}},[a("a-switch",{directives:[{name:"decorator",rawName:"v-decorator",value:["quiescevm"],expression:"['quiescevm']"}]})],1)],1):t._e()],1),a("a-divider"),a("div",{staticClass:"tagsTitle"},[t._v(t._s(t.$t("label.tags")))]),a("div",[t._l(t.tags,(function(e,n){return[a("a-tag",{key:n,attrs:{closable:!0}},[t._v(" "+t._s(e.key)+" = "+t._s(e.value)+" ")])]})),t.inputVisible?a("div",[a("a-input-group",{attrs:{type:"text",size:"small",compact:""},on:{blur:t.handleInputConfirm,keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputConfirm(e)}}},[a("a-input",{ref:"input",staticStyle:{width:"100px","text-align":"center"},attrs:{value:t.inputKey,placeholder:t.$t("label.key")},on:{change:t.handleKeyChange}}),a("a-input",{staticStyle:{width:"30px","border-left":"0","pointer-events":"none",backgroundColor:"#fff"},attrs:{placeholder:"=",disabled:""}}),a("a-input",{staticStyle:{width:"100px","text-align":"center","border-left":"0"},attrs:{value:t.inputValue,placeholder:t.$t("label.value")},on:{change:t.handleValueChange}}),a("a-button",{attrs:{shape:"circle",size:"small"},on:{click:t.handleInputConfirm}},[a("a-icon",{attrs:{type:"check"}})],1),a("a-button",{attrs:{shape:"circle",size:"small"},on:{click:function(e){t.inputVisible=!1}}},[a("a-icon",{attrs:{type:"close"}})],1)],1)],1):a("a-tag",{staticStyle:{background:"#fff",borderStyle:"dashed"},on:{click:t.showInput}},[a("a-icon",{attrs:{type:"plus"}}),t._v(" "+t._s(t.$t("label.new.tag"))+" ")],1)],2),a("div",{staticClass:"action-button",attrs:{span:24}},[a("a-button",{attrs:{loading:t.actionLoading},on:{click:t.closeAction}},[t._v(" "+t._s(this.$t("label.cancel"))+" ")]),t.handleShowButton()?a("a-button",{attrs:{loading:t.actionLoading,type:"primary"},on:{click:t.handleSubmit}},[t._v(" "+t._s(this.$t("label.ok"))+" ")]):t._e()],1)],1)],1)],1)},i=[],s=(a("99af"),a("4de4"),a("4160"),a("b0c0"),a("d3b7"),a("159b"),a("365c")),o={name:"TakeSnapshot",props:{loading:{type:Boolean,default:!1},resource:{type:Object,required:!0}},data:function(){return{actionLoading:!1,quiescevm:!1,inputValue:"",inputKey:"",inputVisible:"",tags:[],dataSource:[]}},beforeCreate:function(){var t=this;this.form=this.$form.createForm(this),this.apiConfig=this.$store.getters.apis.createSnapshot||{},this.apiParams={},this.apiConfig.params.forEach((function(e){t.apiParams[e.name]=e}))},mounted:function(){this.quiescevm=this.resource.quiescevm},methods:{handleSubmit:function(t){var e=this;t.preventDefault(),this.form.validateFields((function(t,a){if(!t){var n={};n.volumeId=e.resource.id,a.name&&(n.name=a.name),n.asyncBackup=!1,a.asyncbackup&&(n.asyncBackup=a.asyncbackup),n.quiescevm=!1,a.quiescevm&&(n.quiescevm=a.quiescevm);for(var i=0;i<e.tags.length;i++){var o={},r=e.tags[i];o["tags["+i+"].key"]=r.key,o["tags["+i+"].value"]=r.value,n=Object.assign({},n,o)}e.actionLoading=!0;var c=e.$t("label.action.take.snapshot"),l=e.$t("label.volume")+" "+e.resource.id;Object(s["a"])("createSnapshot",n).then((function(t){var a=t.createsnapshotresponse.jobid;a&&e.$pollJob({jobId:a,successMethod:function(t){var n=t.jobresult.snapshot.name;e.$store.dispatch("AddAsyncJob",{title:c,jobid:a,description:n,status:"progress"})},loadingMessage:"".concat(c," ").concat(e.$t("label.in.progress.for")," ").concat(l),catchMessage:e.$t("error.fetching.async.job.result")}),e.closeAction()})).catch((function(t){e.$notifyError(t)})).finally((function(){e.actionLoading=!1}))}}))},handleVisibleInterval:function(t){if(0===this.dataSource.length)return!1;var e=this.dataSource.filter((function(e){return e.intervaltype===t}));return!!(e&&e.length>0)},handleShowButton:function(){var t=this;if(0===this.dataSource.length)return!0;var e=this.dataSource.filter((function(e){return e.intervaltype===t.intervalValue}));return!(e&&e.length>0)},handleKeyChange:function(t){this.inputKey=t.target.value},handleValueChange:function(t){this.inputValue=t.target.value},handleInputConfirm:function(){this.tags.push({key:this.inputKey,value:this.inputValue}),this.inputVisible=!1,this.inputKey="",this.inputValue=""},showInput:function(){this.inputVisible=!0,this.$nextTick((function(){this.$refs.input.focus()}))},closeAction:function(){this.$emit("close-action")}}},r=o,c=(a("0ed2"),a("2877")),l=Object(c["a"])(r,n,i,!1,null,"f58246a6",null);e["default"]=l.exports}}]);
//# sourceMappingURL=chunk-755ca4c4.464c688b.js.map