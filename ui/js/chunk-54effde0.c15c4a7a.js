(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-54effde0"],{"3ddc":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",[s("div",{staticClass:"form"},[s("div",{ref:"newRuleName",staticClass:"form__item"},[s("div",{staticClass:"form__label"},[s("span",{staticClass:"form__required"},[e._v("*")]),e._v(e._s(e.$t("label.name")))]),s("a-input",{model:{value:e.newRule.name,callback:function(t){e.$set(e.newRule,"name",t)},expression:"newRule.name"}}),s("span",{staticClass:"error-text"},[e._v(e._s(e.$t("label.required")))])],1),s("div",{ref:"newRulePublicPort",staticClass:"form__item"},[s("div",{staticClass:"form__label"},[s("span",{staticClass:"form__required"},[e._v("*")]),e._v(e._s(e.$t("label.publicport")))]),s("a-input",{model:{value:e.newRule.publicport,callback:function(t){e.$set(e.newRule,"publicport",t)},expression:"newRule.publicport"}}),s("span",{staticClass:"error-text"},[e._v(e._s(e.$t("label.required")))])],1),s("div",{ref:"newRulePrivatePort",staticClass:"form__item"},[s("div",{staticClass:"form__label"},[s("span",{staticClass:"form__required"},[e._v("*")]),e._v(e._s(e.$t("label.privateport")))]),s("a-input",{model:{value:e.newRule.privateport,callback:function(t){e.$set(e.newRule,"privateport",t)},expression:"newRule.privateport"}}),s("span",{staticClass:"error-text"},[e._v(e._s(e.$t("label.required")))])],1)]),s("div",{staticClass:"form"},[s("div",{staticClass:"form__item"},[s("div",{staticClass:"form__label"},[e._v(e._s(e.$t("label.algorithm")))]),s("a-select",{model:{value:e.newRule.algorithm,callback:function(t){e.$set(e.newRule,"algorithm",t)},expression:"newRule.algorithm"}},[s("a-select-option",{attrs:{value:"roundrobin"}},[e._v(e._s(e.$t("label.lb.algorithm.roundrobin")))]),s("a-select-option",{attrs:{value:"leastconn"}},[e._v(e._s(e.$t("label.lb.algorithm.leastconn")))]),s("a-select-option",{attrs:{value:"source"}},[e._v(e._s(e.$t("label.lb.algorithm.source")))])],1)],1),s("div",{staticClass:"form__item"},[s("div",{staticClass:"form__label"},[e._v(e._s(e.$t("label.protocol")))]),s("a-select",{staticStyle:{"min-width":"100px"},model:{value:e.newRule.protocol,callback:function(t){e.$set(e.newRule,"protocol",t)},expression:"newRule.protocol"}},[s("a-select-option",{attrs:{value:"tcp-proxy"}},[e._v(e._s(e.$t("label.tcp.proxy")))]),s("a-select-option",{attrs:{value:"tcp"}},[e._v(e._s(e.$t("label.tcp")))]),s("a-select-option",{attrs:{value:"udp"}},[e._v(e._s(e.$t("label.udp")))])],1)],1),s("div",{staticClass:"form__item"},[s("div",{staticClass:"form__label",staticStyle:{"white-space":"nowrap"}},[e._v(e._s(e.$t("label.add.vms")))]),s("a-button",{attrs:{disabled:!("createLoadBalancerRule"in e.$store.getters.apis),type:"primary"},on:{click:e.handleOpenAddVMModal}},[e._v(" "+e._s(e.$t("label.add"))+" ")])],1)])]),s("a-divider"),s("a-table",{staticClass:"list-view",attrs:{size:"small",loading:e.loading,columns:e.columns,dataSource:e.lbRules,pagination:!1,rowKey:function(e){return e.id}},scopedSlots:e._u([{key:"algorithm",fn:function(t){return[e._v(" "+e._s(e.returnAlgorithmName(t.algorithm))+" ")]}},{key:"protocol",fn:function(t){return[e._v(" "+e._s(e._f("capitalise")(t.protocol))+" ")]}},{key:"stickiness",fn:function(t){return[s("a-button",{on:{click:function(){return e.openStickinessModal(t.id)}}},[e._v(" "+e._s(e.returnStickinessLabel(t.id))+" ")])]}},{key:"add",fn:function(t){return[s("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(){e.selectedRule=t,e.handleOpenAddVMModal()}}},[e._v(" "+e._s(e.$t("label.add"))+" ")])]}},{key:"expandedRowRender",fn:function(t){return[s("div",{staticClass:"rule-instance-list"},e._l(t.ruleInstances,(function(a){return s("div",{key:a.loadbalancerruleinstance.id},e._l(a.lbvmipaddresses,(function(i){return s("div",{key:i,staticClass:"rule-instance-list__item"},[s("div",[s("status",{attrs:{text:a.loadbalancerruleinstance.state}}),s("a-icon",{attrs:{type:"desktop"}}),s("router-link",{attrs:{to:{path:"/vm/"+a.loadbalancerruleinstance.id}}},[e._v(" "+e._s(a.loadbalancerruleinstance.displayname)+" ")])],1),s("div",[e._v(e._s(i))]),s("a-button",{attrs:{shape:"circle",type:"danger",icon:"delete"},on:{click:function(){return e.handleDeleteInstanceFromRule(a,t,i)}}})],1)})),0)})),0)]}},{key:"actions",fn:function(t){return[s("div",{staticClass:"actions"},[s("a-button",{attrs:{shape:"circle",icon:"edit"},on:{click:function(){return e.openEditRuleModal(t)}}}),s("a-button",{attrs:{disabled:!("updateLoadBalancerRule"in e.$store.getters.apis),shape:"circle",icon:"tag"},on:{click:function(){return e.openTagsModal(t.id)}}}),s("a-popconfirm",{attrs:{title:e.$t("label.delete")+"?",okText:e.$t("label.yes"),cancelText:e.$t("label.no")},on:{confirm:function(s){return e.handleDeleteRule(t)}}},[s("a-button",{attrs:{disabled:!("deleteLoadBalancerRule"in e.$store.getters.apis),shape:"circle",type:"danger",icon:"delete"}})],1)],1)]}}])}),s("a-pagination",{staticClass:"pagination",attrs:{size:"small",current:e.page,pageSize:e.pageSize,total:e.totalCount,showTotal:function(t){return e.$t("label.total")+" "+t+" "+e.$t("label.items")},pageSizeOptions:["10","20","40","80","100"],showSizeChanger:""},on:{change:e.handleChangePage,showSizeChange:e.handleChangePageSize},scopedSlots:e._u([{key:"buildOptionText",fn:function(t){return[s("span",[e._v(e._s(t.value)+" / "+e._s(e.$t("label.page")))])]}}])}),s("a-modal",{staticClass:"tags-modal",attrs:{title:e.$t("label.edit.tags"),footer:null,afterClose:e.closeModal,maskClosable:!1},model:{value:e.tagsModalVisible,callback:function(t){e.tagsModalVisible=t},expression:"tagsModalVisible"}},[s("span",{directives:[{name:"show",rawName:"v-show",value:e.tagsModalLoading,expression:"tagsModalLoading"}],staticClass:"modal-loading"},[s("a-icon",{attrs:{type:"loading"}})],1),s("a-form",{staticClass:"add-tags",attrs:{form:e.newTagsForm},on:{submit:e.handleAddTag}},[s("div",{staticClass:"add-tags__input"},[s("p",{staticClass:"add-tags__label"},[e._v(e._s(e.$t("label.key")))]),s("a-form-item",[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["key",{rules:[{required:!0,message:this.$t("message.specifiy.tag.key")}]}],expression:"['key', { rules: [{ required: true, message: this.$t('message.specifiy.tag.key')}] }]"}]})],1)],1),s("div",{staticClass:"add-tags__input"},[s("p",{staticClass:"add-tags__label"},[e._v(e._s(e.$t("label.value")))]),s("a-form-item",[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["value",{rules:[{required:!0,message:this.$t("message.specifiy.tag.value")}]}],expression:"['value', { rules: [{ required: true, message: this.$t('message.specifiy.tag.value')}] }]"}]})],1)],1),s("a-button",{attrs:{disabled:!("createTags"in e.$store.getters.apis),type:"primary","html-type":"submit"}},[e._v(e._s(e.$t("label.add")))])],1),s("a-divider"),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.tagsModalLoading,expression:"!tagsModalLoading"}],staticClass:"tags-container"},e._l(e.tags,(function(t,a){return s("div",{key:a,staticClass:"tags"},[s("a-tag",{key:a,attrs:{closable:"deleteTags"in e.$store.getters.apis,afterClose:function(){return e.handleDeleteTag(t)}}},[e._v(" "+e._s(t.key)+" = "+e._s(t.value)+" ")])],1)})),0),s("a-button",{staticClass:"add-tags-done",attrs:{type:"primary"},on:{click:function(t){e.tagsModalVisible=!1}}},[e._v(e._s(e.$t("label.done")))])],1),s("a-modal",{attrs:{title:e.$t("label.configure.sticky.policy"),footer:null,afterClose:e.closeModal,maskClosable:!1,okButtonProps:{props:{htmlType:"submit"}}},model:{value:e.stickinessModalVisible,callback:function(t){e.stickinessModalVisible=t},expression:"stickinessModalVisible"}},[s("span",{directives:[{name:"show",rawName:"v-show",value:e.stickinessModalLoading,expression:"stickinessModalLoading"}],staticClass:"modal-loading"},[s("a-icon",{attrs:{type:"loading"}})],1),s("a-form",{staticClass:"custom-ant-form",attrs:{form:e.stickinessPolicyForm},on:{submit:e.handleSubmitStickinessForm}},[s("a-form-item",{attrs:{label:e.$t("label.stickiness.method")}},[s("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["methodname"],expression:"['methodname']"}],on:{change:e.handleStickinessMethodSelectChange}},[s("a-select-option",{attrs:{value:"LbCookie"}},[e._v(e._s(e.$t("label.lb.cookie")))]),s("a-select-option",{attrs:{value:"AppCookie"}},[e._v(e._s(e.$t("label.app.cookie")))]),s("a-select-option",{attrs:{value:"SourceBased"}},[e._v(e._s(e.$t("label.source.based")))]),s("a-select-option",{attrs:{value:"none"}},[e._v(e._s(e.$t("label.none")))])],1)],1),s("a-form-item",{directives:[{name:"show",rawName:"v-show",value:"LbCookie"===e.stickinessPolicyMethod||"AppCookie"===e.stickinessPolicyMethod||"SourceBased"===e.stickinessPolicyMethod,expression:"stickinessPolicyMethod === 'LbCookie' || stickinessPolicyMethod ===\n          'AppCookie' || stickinessPolicyMethod === 'SourceBased'"}],attrs:{label:e.$t("label.sticky.name")}},[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:e.$t("message.error.specify.sticky.name")}]}],expression:"['name', { rules: [{ required: true, message: $t('message.error.specify.sticky.name')}] }]"}]})],1),s("a-form-item",{directives:[{name:"show",rawName:"v-show",value:"LbCookie"===e.stickinessPolicyMethod||"AppCookie"===e.stickinessPolicyMethod,expression:"stickinessPolicyMethod === 'LbCookie' || stickinessPolicyMethod ===\n          'AppCookie'"}],attrs:{label:e.$t("label.sticky.cookie-name")}},[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["cookieName"],expression:"['cookieName']"}]})],1),s("a-form-item",{directives:[{name:"show",rawName:"v-show",value:"LbCookie"===e.stickinessPolicyMethod||"AppCookie"===e.stickinessPolicyMethod,expression:"stickinessPolicyMethod === 'LbCookie' || stickinessPolicyMethod ===\n          'AppCookie'"}],attrs:{label:e.$t("label.sticky.mode")}},[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["mode"],expression:"['mode']"}]})],1),s("a-form-item",{directives:[{name:"show",rawName:"v-show",value:"LbCookie"===e.stickinessPolicyMethod,expression:"stickinessPolicyMethod === 'LbCookie'"}],attrs:{label:e.$t("label.sticky.nocache")}},[s("a-checkbox",{directives:[{name:"decorator",rawName:"v-decorator",value:["nocache"],expression:"['nocache']"}],model:{value:e.stickinessNoCache,callback:function(t){e.stickinessNoCache=t},expression:"stickinessNoCache"}})],1),s("a-form-item",{directives:[{name:"show",rawName:"v-show",value:"LbCookie"===e.stickinessPolicyMethod,expression:"stickinessPolicyMethod === 'LbCookie'"}],attrs:{label:e.$t("label.sticky.indirect")}},[s("a-checkbox",{directives:[{name:"decorator",rawName:"v-decorator",value:["indirect"],expression:"['indirect']"}],model:{value:e.stickinessIndirect,callback:function(t){e.stickinessIndirect=t},expression:"stickinessIndirect"}})],1),s("a-form-item",{directives:[{name:"show",rawName:"v-show",value:"LbCookie"===e.stickinessPolicyMethod,expression:"stickinessPolicyMethod === 'LbCookie'"}],attrs:{label:e.$t("label.sticky.postonly")}},[s("a-checkbox",{directives:[{name:"decorator",rawName:"v-decorator",value:["postonly"],expression:"['postonly']"}],model:{value:e.stickinessPostOnly,callback:function(t){e.stickinessPostOnly=t},expression:"stickinessPostOnly"}})],1),s("a-form-item",{directives:[{name:"show",rawName:"v-show",value:"LbCookie"===e.stickinessPolicyMethod,expression:"stickinessPolicyMethod === 'LbCookie'"}],attrs:{label:e.$t("label.domain")}},[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["domain"],expression:"['domain']"}]})],1),s("a-form-item",{directives:[{name:"show",rawName:"v-show",value:"AppCookie"===e.stickinessPolicyMethod,expression:"stickinessPolicyMethod === 'AppCookie'"}],attrs:{label:e.$t("label.sticky.length")}},[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["length"],expression:"['length']"}],attrs:{type:"number"}})],1),s("a-form-item",{directives:[{name:"show",rawName:"v-show",value:"AppCookie"===e.stickinessPolicyMethod,expression:"stickinessPolicyMethod === 'AppCookie'"}],attrs:{label:e.$t("label.sticky.holdtime")}},[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["holdtime"],expression:"['holdtime']"}],attrs:{type:"number"}})],1),s("a-form-item",{directives:[{name:"show",rawName:"v-show",value:"AppCookie"===e.stickinessPolicyMethod,expression:"stickinessPolicyMethod === 'AppCookie'"}],attrs:{label:e.$t("label.sticky.request-learn")}},[s("a-checkbox",{directives:[{name:"decorator",rawName:"v-decorator",value:["requestLearn"],expression:"['requestLearn']"}],model:{value:e.stickinessRequestLearn,callback:function(t){e.stickinessRequestLearn=t},expression:"stickinessRequestLearn"}})],1),s("a-form-item",{directives:[{name:"show",rawName:"v-show",value:"AppCookie"===e.stickinessPolicyMethod,expression:"stickinessPolicyMethod === 'AppCookie'"}],attrs:{label:e.$t("label.sticky.prefix")}},[s("a-checkbox",{directives:[{name:"decorator",rawName:"v-decorator",value:["prefix"],expression:"['prefix']"}],model:{value:e.stickinessPrefix,callback:function(t){e.stickinessPrefix=t},expression:"stickinessPrefix"}})],1),s("a-form-item",{directives:[{name:"show",rawName:"v-show",value:"SourceBased"===e.stickinessPolicyMethod,expression:"stickinessPolicyMethod === 'SourceBased'"}],attrs:{label:e.$t("label.sticky.tablesize")}},[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["tablesize"],expression:"['tablesize']"}]})],1),s("a-form-item",{directives:[{name:"show",rawName:"v-show",value:"SourceBased"===e.stickinessPolicyMethod,expression:"stickinessPolicyMethod === 'SourceBased'"}],attrs:{label:e.$t("label.sticky.expire")}},[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["expire"],expression:"['expire']"}]})],1),s("a-button",{attrs:{type:"primary","html-type":"submit"}},[e._v(e._s(e.$t("label.ok")))])],1)],1),s("a-modal",{attrs:{title:e.$t("label.edit.rule"),afterClose:e.closeModal,maskClosable:!1},on:{ok:e.handleSubmitEditForm},model:{value:e.editRuleModalVisible,callback:function(t){e.editRuleModalVisible=t},expression:"editRuleModalVisible"}},[s("span",{directives:[{name:"show",rawName:"v-show",value:e.editRuleModalLoading,expression:"editRuleModalLoading"}],staticClass:"modal-loading"},[s("a-icon",{attrs:{type:"loading"}})],1),e.selectedRule?s("div",{staticClass:"edit-rule"},[s("div",{staticClass:"edit-rule__item"},[s("p",{staticClass:"edit-rule__label"},[e._v(e._s(e.$t("label.name")))]),s("a-input",{model:{value:e.editRuleDetails.name,callback:function(t){e.$set(e.editRuleDetails,"name",t)},expression:"editRuleDetails.name"}})],1),s("div",{staticClass:"edit-rule__item"},[s("p",{staticClass:"edit-rule__label"},[e._v(e._s(e.$t("label.algorithm")))]),s("a-select",{model:{value:e.editRuleDetails.algorithm,callback:function(t){e.$set(e.editRuleDetails,"algorithm",t)},expression:"editRuleDetails.algorithm"}},[s("a-select-option",{attrs:{value:"roundrobin"}},[e._v(e._s(e.$t("label.lb.algorithm.roundrobin")))]),s("a-select-option",{attrs:{value:"leastconn"}},[e._v(e._s(e.$t("label.lb.algorithm.leastconn")))]),s("a-select-option",{attrs:{value:"source"}},[e._v(e._s(e.$t("label.lb.algorithm.source")))])],1)],1),s("div",{staticClass:"edit-rule__item"},[s("p",{staticClass:"edit-rule__label"},[e._v(e._s(e.$t("label.protocol")))]),s("a-select",{model:{value:e.editRuleDetails.protocol,callback:function(t){e.$set(e.editRuleDetails,"protocol",t)},expression:"editRuleDetails.protocol"}},[s("a-select-option",{attrs:{value:"tcp-proxy"}},[e._v(e._s(e.$t("label.tcp.proxy")))]),s("a-select-option",{attrs:{value:"tcp"}},[e._v(e._s(e.$t("label.tcp")))]),s("a-select-option",{attrs:{value:"udp"}},[e._v(e._s(e.$t("label.udp")))])],1)],1)]):e._e()]),s("a-modal",{staticClass:"vm-modal",attrs:{title:e.$t("label.add.vms"),maskClosable:!1,okText:e.$t("label.ok"),cancelText:e.$t("label.cancel"),width:"60vw",okButtonProps:{props:{disabled:e.newRule.virtualmachineid===[]}}},on:{ok:e.handleAddNewRule,cancel:e.closeModal},model:{value:e.addVmModalVisible,callback:function(t){e.addVmModalVisible=t},expression:"addVmModalVisible"}},[s("div",["vpcid"in e.resource&&!("associatednetworkid"in e.resource)?s("span",[s("strong",[e._v(e._s(e.$t("label.select.tier"))+" ")]),s("a-select",{attrs:{placeholder:e.$t("label.select.tier")},on:{change:function(t){return e.fetchVirtualMachines()}},model:{value:e.selectedTier,callback:function(t){e.selectedTier=t},expression:"selectedTier"}},e._l(e.tiers.data,(function(t){return s("a-select-option",{key:t.id,attrs:{loading:e.tiers.loading}},[e._v(" "+e._s(t.displaytext)+" ")])})),1)],1):e._e(),s("a-input-search",{staticClass:"input-search",attrs:{placeholder:e.$t("label.search"),allowClear:""},on:{search:e.onSearch},model:{value:e.searchQuery,callback:function(t){e.searchQuery=t},expression:"searchQuery"}}),s("a-table",{staticClass:"list-view",attrs:{size:"small",loading:e.addVmModalLoading,columns:e.vmColumns,dataSource:e.vms,pagination:!1,rowKey:function(e){return e.id},scroll:{y:300}},scopedSlots:e._u([{key:"name",fn:function(t,a,i){return s("div",{},[s("span",[e._v(" "+e._s(t)+" ")]),e.addVmModalNicLoading?s("a-icon",{attrs:{type:"loading"}}):e.addVmModalNicLoading||e.newRule.virtualmachineid[i]!==a.id?e._e():s("a-select",{staticStyle:{display:"block"},attrs:{mode:"multiple"},model:{value:e.newRule.vmguestip[i],callback:function(t){e.$set(e.newRule.vmguestip,i,t)},expression:"newRule.vmguestip[index]"}},e._l(e.nics[i],(function(t,a){return s("a-select-option",{key:t,attrs:{value:t}},[e._v(" "+e._s(t)+e._s(0===a?" ("+e.$t("label.primary")+")":null)+" ")])})),1)],1)}},{key:"state",fn:function(e){return s("div",{},[s("status",{attrs:{text:e||"",displayText:""}})],1)}},{key:"action",fn:function(t,a,i){return s("div",{staticStyle:{"text-align":"center"}},[s("a-checkbox",{attrs:{value:a.id},on:{change:function(t){return e.fetchNics(t,i)}}})],1)}}])}),s("a-pagination",{staticClass:"pagination",attrs:{size:"small",current:e.vmPage,pageSize:e.vmPageSize,total:e.vmCount,showTotal:function(t){return e.$t("label.total")+" "+t+" "+e.$t("label.items")},pageSizeOptions:["10","20","40","80","100"],showSizeChanger:""},on:{change:e.handleChangePage,showSizeChange:e.handleChangePageSize},scopedSlots:e._u([{key:"buildOptionText",fn:function(t){return[s("span",[e._v(e._s(t.value)+" / "+e._s(e.$t("label.page")))])]}}])})],1)])],1)},i=[],o=(s("a4d3"),s("e01a"),s("d28b"),s("4de4"),s("7db0"),s("4160"),s("d81d"),s("b0c0"),s("4fad"),s("d3b7"),s("3ca3"),s("159b"),s("ddb0"),s("fc11")),l=s("d0af"),n=s("f3f3"),c=s("d0ff"),r=s("365c"),d=s("829c"),u=void 0,h={name:"LoadBalancing",components:{Status:d["a"]},props:{resource:{type:Object,required:!0}},inject:["parentFetchData","parentToggleLoading"],data:function(){return{loading:!0,lbRules:[],newTagsForm:this.$form.createForm(this),tagsModalVisible:!1,tagsModalLoading:!1,tags:[],selectedRule:null,selectedTier:null,stickinessModalVisible:!1,stickinessPolicies:[],stickinessPolicyForm:this.$form.createForm(this),stickinessModalLoading:!1,selectedStickinessPolicy:null,stickinessPolicyMethod:"LbCookie",stickinessNoCache:null,stickinessIndirect:null,stickinessPostOnly:null,stickinessRequestLearn:null,stickinessPrefix:null,editRuleModalVisible:!1,editRuleModalLoading:!1,editRuleDetails:{name:"",algorithm:"",protocol:""},newRule:{algorithm:"roundrobin",name:"",privateport:"",publicport:"",protocol:"tcp",virtualmachineid:[],vmguestip:[]},addVmModalVisible:!1,addVmModalLoading:!1,addVmModalNicLoading:!1,vms:[],nics:[],totalCount:0,page:1,pageSize:10,columns:[{title:this.$t("label.name"),dataIndex:"name"},{title:this.$t("label.publicport"),dataIndex:"publicport"},{title:this.$t("label.privateport"),dataIndex:"privateport"},{title:this.$t("label.algorithm"),scopedSlots:{customRender:"algorithm"}},{title:this.$t("label.protocol"),scopedSlots:{customRender:"protocol"}},{title:this.$t("label.state"),dataIndex:"state"},{title:this.$t("label.action.configure.stickiness"),scopedSlots:{customRender:"stickiness"}},{title:this.$t("label.add.vms"),scopedSlots:{customRender:"add"}},{title:this.$t("label.action"),scopedSlots:{customRender:"actions"}}],tiers:{loading:!1,data:[]},vmColumns:[{title:this.$t("label.name"),dataIndex:"name",scopedSlots:{customRender:"name"},width:220},{title:this.$t("label.state"),dataIndex:"state",scopedSlots:{customRender:"state"}},{title:this.$t("label.displayname"),dataIndex:"displayname"},{title:this.$t("label.account"),dataIndex:"account"},{title:this.$t("label.zonename"),dataIndex:"zonename"},{title:this.$t("label.select"),dataIndex:"action",scopedSlots:{customRender:"action"},width:80}],vmPage:1,vmPageSize:10,vmCount:0,searchQuery:null}},mounted:function(){this.fetchData()},watch:{resource:function(e,t){e&&e.id&&(this.resource=e,this.fetchData())}},filters:{capitalise:function(e){return"all"===e?u.$t("label.all"):e.toUpperCase()}},methods:{fetchData:function(){this.fetchListTiers(),this.fetchLBRules()},fetchListTiers:function(){var e=this;this.tiers.loading=!0,Object(r["a"])("listNetworks",{account:this.resource.account,domainid:this.resource.domainid,supportedservices:"Lb",vpcid:this.resource.vpcid}).then((function(t){e.tiers.data=t.listnetworksresponse.network||[],e.selectedTier=e.tiers.data&&e.tiers.data[0].id?e.tiers.data[0].id:null,e.$forceUpdate()})).catch((function(t){e.$notifyError(t)})).finally((function(){e.tiers.loading=!1}))},fetchLBRules:function(){var e=this;this.loading=!0,this.lbRules=[],this.stickinessPolicies=[],Object(r["a"])("listLoadBalancerRules",{listAll:!0,publicipid:this.resource.id,page:this.page,pageSize:this.pageSize}).then((function(t){e.lbRules=t.listloadbalancerrulesresponse.loadbalancerrule||[],e.totalCount=t.listloadbalancerrulesresponse.count||0})).then((function(){if(e.lbRules.length>0)return setTimeout((function(){e.fetchLBRuleInstances()}),100),void e.fetchLBStickinessPolicies();e.loading=!1})).catch((function(t){e.$notifyError(t),e.loading=!1}))},fetchLBRuleInstances:function(){var e=this,t=!0,s=!1,a=void 0;try{for(var i,o=function(){var t=i.value;e.loading=!0,Object(r["a"])("listLoadBalancerRuleInstances",{listAll:!0,lbvmips:!0,id:t.id}).then((function(s){e.$set(t,"ruleInstances",s.listloadbalancerruleinstancesresponse.lbrulevmidip)})).catch((function(t){e.$notifyError(t)})).finally((function(){e.loading=!1}))},l=this.lbRules[Symbol.iterator]();!(t=(i=l.next()).done);t=!0)o()}catch(n){s=!0,a=n}finally{try{t||null==l.return||l.return()}finally{if(s)throw a}}},fetchLBStickinessPolicies:function(){var e=this;this.loading=!0,this.lbRules.forEach((function(t){Object(r["a"])("listLBStickinessPolicies",{listAll:!0,lbruleid:t.id}).then((function(t){var s;(s=e.stickinessPolicies).push.apply(s,Object(c["a"])(t.listlbstickinesspoliciesresponse.stickinesspolicies))})).catch((function(t){e.$notifyError(t)})).finally((function(){e.loading=!1}))}))},returnAlgorithmName:function(e){switch(e){case"leastconn":return"Least connections";case"roundrobin":return"Round-robin";case"source":return"Source";default:return""}},returnStickinessLabel:function(e){var t=this.stickinessPolicies.filter((function(t){return t.lbruleid===e}));return t.length>0&&t[0].stickinesspolicy.length>0?t[0].stickinesspolicy[0].methodname:"Configure"},openTagsModal:function(e){var t=this;this.tagsModalLoading=!0,this.tagsModalVisible=!0,this.tags=[],this.selectedRule=e,this.newTagsForm.resetFields(),Object(r["a"])("listTags",{resourceId:e,resourceType:"LoadBalancer",listAll:!0}).then((function(e){t.tags=e.listtagsresponse.tag,t.tagsModalLoading=!1})).catch((function(e){t.$notifyError(e),t.closeModal()}))},handleAddTag:function(e){var t=this;this.tagsModalLoading=!0,e.preventDefault(),this.newTagsForm.validateFields((function(e,s){e?t.tagsModalLoading=!1:Object(r["a"])("createTags",{"tags[0].key":s.key,"tags[0].value":s.value,resourceIds:t.selectedRule,resourceType:"LoadBalancer"}).then((function(e){t.$pollJob({jobId:e.createtagsresponse.jobid,successMessage:t.$t("message.success.add.tag"),successMethod:function(){t.parentFetchData(),t.parentToggleLoading(),t.openTagsModal(t.selectedRule)},errorMessage:t.$t("message.add.tag.failed"),errorMethod:function(){t.parentFetchData(),t.parentToggleLoading(),t.closeModal()},loadingMessage:t.$t("message.add.tag.processing"),catchMessage:t.$t("error.fetching.async.job.result"),catchMethod:function(){t.parentFetchData(),t.parentToggleLoading(),t.closeModal()}})})).catch((function(e){t.$notifyError(e)}))}))},handleDeleteTag:function(e){var t=this;this.tagsModalLoading=!0,Object(r["a"])("deleteTags",{"tags[0].key":e.key,"tags[0].value":e.value,resourceIds:e.resourceid,resourceType:"LoadBalancer"}).then((function(e){t.$pollJob({jobId:e.deletetagsresponse.jobid,successMessage:t.$t("message.success.delete.tag"),successMethod:function(){t.parentFetchData(),t.parentToggleLoading(),t.openTagsModal(t.selectedRule)},errorMessage:t.$t("message.delete.tag.failed"),errorMethod:function(){t.parentFetchData(),t.parentToggleLoading(),t.closeModal()},loadingMessage:t.$t("message.delete.tag.processing"),catchMessage:t.$t("error.fetching.async.job.result"),catchMethod:function(){t.parentFetchData(),t.parentToggleLoading(),t.closeModal()}})})).catch((function(e){t.$notifyError(e)}))},openStickinessModal:function(e){var t=this;this.stickinessModalVisible=!0,this.selectedRule=e;var s=this.stickinessPolicies.find((function(t){return t.lbruleid===e}));s&&s.stickinesspolicy.length>0&&(this.selectedStickinessPolicy=s.stickinesspolicy[0],this.stickinessPolicyMethod=this.selectedStickinessPolicy.methodname,this.$nextTick((function(){t.stickinessPolicyForm.setFieldsValue({methodname:t.selectedStickinessPolicy.methodname}),t.stickinessPolicyForm.setFieldsValue({name:t.selectedStickinessPolicy.name}),t.stickinessPolicyForm.setFieldsValue({cookieName:t.selectedStickinessPolicy.params["cookie-name"]}),t.stickinessPolicyForm.setFieldsValue({mode:t.selectedStickinessPolicy.params.mode}),t.stickinessPolicyForm.setFieldsValue({domain:t.selectedStickinessPolicy.params.domain}),t.stickinessPolicyForm.setFieldsValue({length:t.selectedStickinessPolicy.params.length}),t.stickinessPolicyForm.setFieldsValue({holdtime:t.selectedStickinessPolicy.params.holdtime}),t.stickinessNoCache=!!t.selectedStickinessPolicy.params.nocache,t.stickinessIndirect=!!t.selectedStickinessPolicy.params.indirect,t.stickinessPostOnly=!!t.selectedStickinessPolicy.params.postonly,t.stickinessRequestLearn=!!t.selectedStickinessPolicy.params["request-learn"],t.stickinessPrefix=!!t.selectedStickinessPolicy.params.prefix})))},handleAddStickinessPolicy:function(e,t){var s=this;Object(r["a"])("createLBStickinessPolicy",Object(n["a"])(Object(n["a"])({},e),{},{lbruleid:this.selectedRule,name:t.name,methodname:t.methodname})).then((function(e){s.$pollJob({jobId:e.createLBStickinessPolicy.jobid,successMessage:s.$t("message.success.config.sticky.policy"),successMethod:function(){s.parentFetchData(),s.parentToggleLoading(),s.fetchData(),s.closeModal()},errorMessage:s.$t("message.config.sticky.policy.failed"),errorMethod:function(){s.parentFetchData(),s.parentToggleLoading(),s.fetchData(),s.closeModal()},loadingMessage:s.$t("message.config.sticky.policy.processing"),catchMessage:s.$t("error.fetching.async.job.result"),catchMethod:function(){s.parentFetchData(),s.parentToggleLoading(),s.fetchData(),s.closeModal()}})})).catch((function(e){s.$notifyError(e)}))},handleDeleteStickinessPolicy:function(){var e=this;this.stickinessModalLoading=!0,Object(r["a"])("deleteLBStickinessPolicy",{id:this.selectedStickinessPolicy.id}).then((function(t){e.$pollJob({jobId:t.deleteLBstickinessrruleresponse.jobid,successMessage:e.$t("message.success.remove.sticky.policy"),successMethod:function(){e.parentFetchData(),e.parentToggleLoading(),e.fetchData(),e.closeModal()},errorMessage:e.$t("message.remove.sticky.policy.failed"),errorMethod:function(){e.parentFetchData(),e.parentToggleLoading(),e.fetchData(),e.closeModal()},loadingMessage:e.$t("message.remove.sticky.policy.processing"),catchMessage:e.$t("error.fetching.async.job.result"),catchMethod:function(){e.parentFetchData(),e.parentToggleLoading(),e.fetchData(),e.closeModal()}})})).catch((function(t){e.$notifyError(t)}))},handleSubmitStickinessForm:function(e){var t=this;this.stickinessModalLoading=!0,e.preventDefault(),this.stickinessPolicyForm.validateFields((function(e,s){if(e)t.stickinessModalLoading=!1;else if("none"!==s.methodname){s.nocache=t.stickinessNoCache,s.indirect=t.stickinessIndirect,s.postonly=t.stickinessPostOnly,s.requestLearn=t.stickinessRequestLearn,s.prefix=t.stickinessPrefix;var a={},i=0;Object.entries(s).forEach((function(e){var t=Object(l["a"])(e,2),s=t[0],c=t[1];c&&"name"!==s&&"methodname"!==s&&(a="cookieName"===s?Object(n["a"])(Object(n["a"])({},a),Object(o["a"])({},"param[".concat(i,"].name"),"cookie-name")):"requestLearn"===s?Object(n["a"])(Object(n["a"])({},a),Object(o["a"])({},"param[".concat(i,"].name"),"request-learn")):Object(n["a"])(Object(n["a"])({},a),Object(o["a"])({},"param[".concat(i,"].name"),s)),a=Object(n["a"])(Object(n["a"])({},a),Object(o["a"])({},"param[".concat(i,"].value"),c)),i++)})),t.handleAddStickinessPolicy(a,s)}else t.handleDeleteStickinessPolicy()}))},handleStickinessMethodSelectChange:function(e){this.stickinessPolicyMethod=e},handleDeleteInstanceFromRule:function(e,t,s){var a=this;this.loading=!0,Object(r["a"])("removeFromLoadBalancerRule",{id:t.id,"vmidipmap[0].vmid":e.loadbalancerruleinstance.id,"vmidipmap[0].vmip":s}).then((function(e){a.$pollJob({jobId:e.removefromloadbalancerruleresponse.jobid,successMessage:a.$t("message.success.remove.instance.rule"),successMethod:function(){a.fetchData()},errorMessage:a.$t("message.remove.instance.failed"),errorMethod:function(){a.fetchData()},loadingMessage:a.$t("message.remove.instance.processing"),catchMessage:a.$t("error.fetching.async.job.result"),catchMethod:function(){a.fetchData()}})})).catch((function(e){a.$notifyError(e),a.fetchData()}))},openEditRuleModal:function(e){this.selectedRule=e,this.editRuleModalVisible=!0,this.editRuleDetails.name=this.selectedRule.name,this.editRuleDetails.algorithm=this.selectedRule.algorithm,this.editRuleDetails.protocol=this.selectedRule.protocol},handleSubmitEditForm:function(){var e=this;this.loading=!0,this.editRuleModalLoading=!0,Object(r["a"])("updateLoadBalancerRule",Object(n["a"])(Object(n["a"])({},this.editRuleDetails),{},{id:this.selectedRule.id})).then((function(t){e.$pollJob({jobId:t.updateloadbalancerruleresponse.jobid,successMessage:e.$t("message.success.edit.rule"),successMethod:function(){e.parentFetchData(),e.parentToggleLoading(),e.fetchData(),e.closeModal()},errorMessage:e.$t("message.edit.rule.failed"),errorMethod:function(){e.parentFetchData(),e.parentToggleLoading(),e.fetchData(),e.closeModal()},loadingMessage:e.$t("message.edit.rule.processing"),catchMessage:e.$t("error.fetching.async.job.result"),catchMethod:function(){e.parentFetchData(),e.parentToggleLoading(),e.fetchData(),e.closeModal()}})})).catch((function(t){e.$notifyError(t),e.loading=!1}))},handleDeleteRule:function(e){var t=this;this.loading=!0,Object(r["a"])("deleteLoadBalancerRule",{id:e.id}).then((function(e){t.$pollJob({jobId:e.deleteloadbalancerruleresponse.jobid,successMessage:t.$t("message.success.remove.rule"),successMethod:function(){t.parentFetchData(),t.parentToggleLoading(),t.fetchData(),t.closeModal()},errorMessage:t.$t("message.remove.rule.failed"),errorMethod:function(){t.parentFetchData(),t.parentToggleLoading(),t.fetchData(),t.closeModal()},loadingMessage:t.$t("message.delete.rule.processing"),catchMessage:t.$t("error.fetching.async.job.result"),catchMethod:function(){t.parentFetchData(),t.parentToggleLoading(),t.fetchData(),t.closeModal()}})})).catch((function(e){t.$notifyError(e),t.loading=!1}))},handleOpenAddVMModal:function(){(this.selectedRule||(this.newRule.name?this.$refs.newRuleName.classList.remove("error"):this.$refs.newRuleName.classList.add("error"),this.newRule.publicport?this.$refs.newRulePublicPort.classList.remove("error"):this.$refs.newRulePublicPort.classList.add("error"),this.newRule.privateport?this.$refs.newRulePrivatePort.classList.remove("error"):this.$refs.newRulePrivatePort.classList.add("error"),this.newRule.name&&this.newRule.publicport&&this.newRule.privateport))&&(this.addVmModalVisible=!0,this.fetchVirtualMachines())},fetchNics:function(e,t){var s=this;if(!e.target.checked)return this.newRule.virtualmachineid[t]=null,this.nics[t]=null,void(this.newRule.vmguestip[t]=null);this.newRule.virtualmachineid[t]=e.target.value,this.addVmModalNicLoading=!0,Object(r["a"])("listNics",{virtualmachineid:e.target.value,networkid:"vpcid"in this.resource&&!("associatednetworkid"in this.resource)?this.selectedTier:this.resource.associatednetworkid}).then((function(e){if(e&&e.listnicsresponse&&e.listnicsresponse.nic[0]){var a=[];a.push(e.listnicsresponse.nic[0].ipaddress),e.listnicsresponse.nic[0].secondaryip&&a.push.apply(a,Object(c["a"])(e.listnicsresponse.nic[0].secondaryip.map((function(e){return e.ipaddress})))),s.nics[t]=a,s.newRule.vmguestip[t]=s.nics[t][0],s.addVmModalNicLoading=!1}})).catch((function(e){s.$notifyError(e),s.closeModal()}))},fetchVirtualMachines:function(){var e=this;this.vmCount=0,this.vms=[],this.addVmModalLoading=!0;var t="vpcid"in this.resource&&!("associatednetworkid"in this.resource)?this.selectedTier:this.resource.associatednetworkid;Object(r["a"])("listVirtualMachines",{listAll:!0,keyword:this.searchQuery,page:this.vmPage,pagesize:this.vmPageSize,networkid:t,account:this.resource.account,domainid:this.resource.domainid}).then((function(t){e.vmCount=t.listvirtualmachinesresponse.count||0,e.vms=t.listvirtualmachinesresponse.virtualmachine||[],e.vms.forEach((function(t,s){e.newRule.virtualmachineid[s]=null,e.nics[s]=null,e.newRule.vmguestip[s]=null}))})).catch((function(t){e.$notifyError(t)})).finally((function(){e.addVmModalLoading=!1}))},handleAssignToLBRule:function(e){var t=this,s={},a=0,i=0;this.newRule.vmguestip.forEach((function(e){Array.isArray(e)?e.forEach((function(e){s["vmidipmap[".concat(i,"].vmid")]=t.newRule.virtualmachineid[a],s["vmidipmap[".concat(i,"].vmip")]=e,i++})):(s["vmidipmap[".concat(i,"].vmid")]=t.newRule.virtualmachineid[a],s["vmidipmap[".concat(i,"].vmip")]=e,i++),a++})),this.loading=!0,Object(r["a"])("assignToLoadBalancerRule",Object(n["a"])({id:e},s)).then((function(e){t.$pollJob({jobId:e.assigntoloadbalancerruleresponse.jobid,successMessage:t.$t("message.success.asign.vm"),successMethod:function(){t.parentFetchData(),t.parentToggleLoading(),t.fetchData(),t.closeModal()},errorMessage:t.$t("message.assign.vm.failed"),errorMethod:function(){t.parentFetchData(),t.parentToggleLoading(),t.fetchData(),t.closeModal()},loadingMessage:t.$t("message.assign.vm.processing"),catchMessage:t.$t("error.fetching.async.job.result"),catchMethod:function(){t.parentFetchData(),t.parentToggleLoading(),t.fetchData(),t.closeModal()}})}))},handleAddNewRule:function(){var e=this;if(this.loading=!0,this.selectedRule)this.handleAssignToLBRule(this.selectedRule.id);else{var t="vpcid"in this.resource&&!("associatednetworkid"in this.resource)?this.selectedTier:this.resource.associatednetworkid;Object(r["a"])("createLoadBalancerRule",{openfirewall:!1,networkid:t,publicipid:this.resource.id,algorithm:this.newRule.algorithm,name:this.newRule.name,privateport:this.newRule.privateport,protocol:this.newRule.protocol,publicport:this.newRule.publicport}).then((function(t){e.addVmModalVisible=!1,e.handleAssignToLBRule(t.createloadbalancerruleresponse.id)})).catch((function(t){e.$notifyError(t),e.loading=!1}))}},closeModal:function(){this.selectedRule=null,this.tagsModalVisible=!1,this.stickinessModalVisible=!1,this.stickinessModalLoading=!1,this.selectedStickinessPolicy=null,this.stickinessPolicyMethod="LbCookie",this.stickinessNoCache=null,this.stickinessIndirect=null,this.stickinessPostOnly=null,this.editRuleModalVisible=!1,this.editRuleModalLoading=!1,this.addVmModalLoading=!1,this.addVmModalNicLoading=!1,this.vms=[],this.nics=[],this.addVmModalVisible=!1,this.newRule.virtualmachineid=[],this.newTagsForm.resetFields(),this.stickinessPolicyForm.resetFields()},handleChangePage:function(e,t){this.page=e,this.pageSize=t,this.fetchData()},handleChangePageSize:function(e,t){this.page=e,this.pageSize=t,this.fetchData()},onSearch:function(e){this.searchQuery=e,this.fetchVirtualMachines()}}},p=h,m=(s("cfb4"),s("2877")),g=Object(m["a"])(p,a,i,!1,null,"59a1d627",null);t["default"]=g.exports},"5e73":function(e,t,s){},cfb4:function(e,t,s){"use strict";var a=s("5e73"),i=s.n(a);i.a}}]);
//# sourceMappingURL=chunk-54effde0.c15c4a7a.js.map