(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b481993c"],{"86cd":function(e,i,t){"use strict";t.r(i);var n=function(){var e=this,i=this,t=i.$createElement,n=i._self._c||t;return n("div",{staticClass:"form-layout"},[n("a-spin",{attrs:{spinning:i.loading}},[n("a-form",{attrs:{form:i.form,layout:"vertical"},on:{submit:i.handleSubmit}},[n("a-form-item",{directives:[{name:"show",rawName:"v-show",value:this.isAdmin(),expression:"this.isAdmin()"}],attrs:{label:i.$t("label.ispublic")}},[n("a-switch",{directives:[{name:"decorator",rawName:"v-decorator",value:["ispublic",{initialValue:this.offeringIsPublic}],expression:"['ispublic', { initialValue: this.offeringIsPublic }]"}],attrs:{checked:this.offeringIsPublic},on:{change:function(i){e.offeringIsPublic=i}}})],1),this.offeringIsPublic?i._e():n("a-form-item",{attrs:{label:i.$t("label.domainid")}},[n("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["domainid",{rules:[{required:!0,message:""+this.$t("message.error.select")}],initialValue:this.selectedDomains}],expression:"['domainid', {\n            rules: [\n              {\n                required: true,\n                message: `${this.$t('message.error.select')}`\n              }\n            ],\n            initialValue: this.selectedDomains\n          }]"}],attrs:{mode:"multiple",showSearch:"",optionFilterProp:"children",filterOption:function(e,i){return i.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0},loading:i.domainLoading,placeholder:this.apiParams.domainid.description}},i._l(this.domains,(function(e,t){return n("a-select-option",{key:t},[i._v(" "+i._s(e.name||e.description)+" ")])})),1)],1),n("a-form-item",{attrs:{label:i.$t("label.zoneid")}},[n("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["zoneid",{rules:[{validator:function(e,t,n){t&&t.length>1&&-1!==t.indexOf(0)&&n(i.$t("message.error.zone.combined")),n()}}]}],expression:"['zoneid', {\n            rules: [\n              {\n                validator: (rule, value, callback) => {\n                  if (value && value.length > 1 && value.indexOf(0) !== -1) {\n                    callback($t('message.error.zone.combined'))\n                  }\n                  callback()\n                }\n              }\n            ]\n          }]"}],attrs:{id:"zone-selection",mode:"multiple",showSearch:"",optionFilterProp:"children",filterOption:function(e,i){return i.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0},loading:i.zoneLoading,placeholder:this.apiParams.zoneid.description}},i._l(this.zones,(function(e,t){return n("a-select-option",{key:t},[i._v(" "+i._s(e.name||e.description)+" ")])})),1)],1),n("div",{staticClass:"action-button",attrs:{span:24}},[n("a-button",{on:{click:i.closeAction}},[i._v(i._s(this.$t("label.cancel")))]),n("a-button",{attrs:{loading:i.loading,type:"primary"},on:{click:i.handleSubmit}},[i._v(i._s(this.$t("label.ok")))])],1)],1)],1)],1)},a=[],o=(t("99af"),t("4160"),t("caad"),t("c975"),t("a15b"),t("b0c0"),t("b64b"),t("d3b7"),t("ac1f"),t("1276"),t("159b"),t("365c")),s={name:"UpdateOfferingAccess",props:{resource:{type:Object,required:!0}},data:function(){return{formOffering:{},selectedDomains:[],selectedZones:[],offeringIsPublic:!1,domains:[],domainLoading:!1,zones:[],zoneLoading:!1,loading:!1}},beforeCreate:function(){var e=this;switch(this.form=this.$form.createForm(this),this.$route.meta.name){case"computeoffering":this.offeringType="ServiceOffering";break;case"diskoffering":this.offeringType="DiskOffering";break;case"networkoffering":this.offeringType="NetworkOffering";break;case"vpcoffering":this.offeringType="VPCOffering";break;default:this.offeringType=this.$route.meta.name}this.apiParams={},this.apiParamsConfig=this.$store.getters.apis["update"+this.offeringType]||{},this.apiParamsConfig.params.forEach((function(i){e.apiParams[i.name]=i}))},created:function(){this.zones=[{id:"all",name:this.$t("label.all.zone")}]},mounted:function(){this.fetchData()},methods:{fetchData:function(){this.fetchOfferingData(),this.fetchDomainData(),this.fetchZoneData()},isAdmin:function(){return["Admin"].includes(this.$store.getters.userInfo.roletype)},fetchOfferingData:function(){var e=this;this.loading=!0;var i={};i.id=this.resource.id,i.isrecursive=!0;var t="list"+this.offeringType+"s";Object(o["a"])(t,i).then((function(i){var n=i[t.toLowerCase()+"response"][e.offeringType.toLowerCase()];e.formOffering=n[0]})).finally((function(){e.updateDomainSelection(),e.updateZoneSelection(),e.loading=!1}))},fetchDomainData:function(){var e=this,i={listAll:!0,details:"min"};this.domainLoading=!0,Object(o["a"])("listDomains",i).then((function(i){var t=i.listdomainsresponse.domain;e.domains=e.domains.concat(t)})).finally((function(){e.domainLoading=!1,e.updateDomainSelection()}))},fetchZoneData:function(){var e=this,i={listAll:!0};this.zoneLoading=!0,Object(o["a"])("listZones",i).then((function(i){var t=i.listzonesresponse.zone;e.zones=e.zones.concat(t)})).finally((function(){e.zoneLoading=!1,e.updateZoneSelection()}))},updateDomainSelection:function(){if(this.formOffering&&0!==Object.keys(this.formOffering).length){var e=this.formOffering.domainid;if(this.selectedDomains=[],e){this.offeringIsPublic=!1,e=-1!==e.indexOf(",")?e.split(","):[e];for(var i=0;i<e.length;i++)for(var t=0;t<this.domains.length;t++)e[i]===this.domains[t].id&&this.selectedDomains.push(t)}else this.isAdmin()&&(this.offeringIsPublic=!0);"domainid"in this.form.fieldsStore.fieldsMeta&&this.form.setFieldsValue({domainid:this.selectedDomains})}},updateZoneSelection:function(){if(this.formOffering&&0!==Object.keys(this.formOffering).length){var e=this.formOffering.zoneid;if(this.selectedZones=[],e){e=-1!==e.indexOf(",")?e.split(","):[e];for(var i=0;i<e.length;i++)for(var t=0;t<this.zones.length;t++)e[i]===this.zones[t].id&&this.selectedZones.push(t)}this.form.setFieldsValue({zoneid:this.selectedZones})}},handleSubmit:function(e){var i=this;e.preventDefault(),this.form.validateFields((function(e,t){if(!e){var n={};n.id=i.resource.id;var a=t.ispublic;if(!0===a)n.domainid="public";else{var s=t.domainid,r="public";if(s&&s.length>0){for(var c=[],l=0;l<s.length;l++)c=c.concat(i.domains[s[l]].id);r=c.join(",")}n.domainid=r}var f=t.zoneid,d="all";if(f&&f.length>0){for(var h=[],u=0;u<f.length;u++)h=h.concat(i.zones[f[u]].id);d=h.join(",")}n.zoneid=d,i.loading=!0,Object(o["a"])("update"+i.offeringType,n).then((function(e){i.$emit("refresh-data"),i.$notification.success({message:i.$t("label.action.update.offering.access"),description:i.$t("label.action.update.offering.access")}),i.closeAction()})).catch((function(e){i.$notifyError(e)})).finally((function(){i.loading=!1}))}}))},closeAction:function(){this.$emit("close-action")}}},r=s,c=(t("a377"),t("2877")),l=Object(c["a"])(r,n,a,!1,null,"74a28ecf",null);i["default"]=l.exports},a377:function(e,i,t){"use strict";var n=t("a9a3"),a=t.n(n);a.a},a9a3:function(e,i,t){}}]);
//# sourceMappingURL=chunk-b481993c.3e3c18d7.js.map