(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8a13d83e"],{"073c":function(e,t,a){"use strict";var s=a("8370"),i=a.n(s);i.a},5329:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"form-layout"},[e.uploadPercentage>0?a("span",[a("a-icon",{attrs:{type:"loading"}}),e._v(" "+e._s(e.$t("message.upload.file.processing"))+" "),a("a-progress",{attrs:{percent:e.uploadPercentage}})],1):a("a-spin",{attrs:{spinning:e.loading}},[a("a-form",{attrs:{form:e.form,layout:"vertical"},on:{submit:e.handleSubmit}},["Create"===e.currentForm?a("a-form-item",{attrs:{label:e.$t("label.url")}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["url",{rules:[{required:!0,message:""+this.$t("label.upload.iso.from.local")}]}],expression:"['url', {\n            rules: [{ required: true, message: `${this.$t('label.upload.iso.from.local')}` }]\n          }]"}],attrs:{autoFocus:"",placeholder:e.apiParams.url.description}})],1):e._e(),"Upload"===e.currentForm?a("a-form-item",{attrs:{label:e.$t("label.templatefileupload")}},[a("a-upload-dragger",{directives:[{name:"decorator",rawName:"v-decorator",value:["file",{rules:[{required:!0,message:""+this.$t("message.error.required.input")}]}],expression:"['file', {\n            rules: [{ required: true, message: `${this.$t('message.error.required.input')}` }]\n          }]"}],attrs:{multiple:!1,fileList:e.fileList,remove:e.handleRemove,beforeUpload:e.beforeUpload}},[a("p",{staticClass:"ant-upload-drag-icon"},[a("a-icon",{attrs:{type:"cloud-upload"}})],1),0===e.fileList.length?a("p",{staticClass:"ant-upload-text"},[e._v(" "+e._s(e.$t("label.volume.volumefileupload.description"))+" ")]):e._e()])],1):e._e(),a("a-form-item",{attrs:{label:e.$t("label.name")}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:""+this.$t("message.error.required.input")}]}],expression:"['name', {\n            rules: [{ required: true, message: `${this.$t('message.error.required.input')}` }]\n          }]"}],attrs:{placeholder:e.apiParams.name.description}})],1),a("a-form-item",{attrs:{label:e.$t("label.displaytext")}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["displaytext",{rules:[{required:!0,message:""+this.$t("message.error.required.input")}]}],expression:"['displaytext', {\n            rules: [{ required: true, message: `${this.$t('message.error.required.input')}` }]\n          }]"}],attrs:{placeholder:e.apiParams.displaytext.description}})],1),e.allowed&&"Upload"!==e.currentForm?a("a-form-item",{attrs:{label:e.$t("label.directdownload")}},[a("a-switch",{directives:[{name:"decorator",rawName:"v-decorator",value:["directdownload"],expression:"['directdownload']"}]})],1):e._e(),a("a-form-item",{attrs:{label:e.$t("label.zoneid")}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["zoneid",{initialValue:this.selectedZone,rules:[{required:!0,message:""+this.$t("message.error.select")}]}],expression:"['zoneid', {\n            initialValue: this.selectedZone,\n            rules: [\n              {\n                required: true,\n                message: `${this.$t('message.error.select')}`\n              }\n            ]\n          }]"}],attrs:{showSearch:"",optionFilterProp:"children",filterOption:function(e,t){return t.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0},loading:e.zoneLoading,placeholder:e.apiParams.zoneid.description}},e._l(e.zones,(function(t){return a("a-select-option",{key:t.id,attrs:{value:t.id}},[e._v(" "+e._s(t.name||t.description)+" ")])})),1)],1),a("a-form-item",{attrs:{label:e.$t("label.bootable")}},[a("a-switch",{directives:[{name:"decorator",rawName:"v-decorator",value:["bootable",{initialValue:!0}],expression:"['bootable', {\n            initialValue: true,\n          }]"}],attrs:{checked:e.bootable},on:{change:function(t){return e.bootable=t}}})],1),e.bootable?a("a-form-item",{attrs:{label:e.$t("label.ostypeid")}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["ostypeid",{initialValue:e.defaultOsType,rules:[{required:!0,message:""+this.$t("message.error.select")}]}],expression:"['ostypeid', {\n            initialValue: defaultOsType,\n            rules: [{ required: true, message: `${this.$t('message.error.select')}` }]\n          }]"}],attrs:{showSearch:"",optionFilterProp:"children",filterOption:function(e,t){return t.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0},loading:e.osTypeLoading,placeholder:e.apiParams.ostypeid.description}},e._l(e.osTypes,(function(t,s){return a("a-select-option",{key:s,attrs:{value:t.id}},[e._v(" "+e._s(t.name||t.description)+" ")])})),1)],1):e._e(),a("a-form-item",{attrs:{label:e.$t("label.isextractable")}},[a("a-switch",{directives:[{name:"decorator",rawName:"v-decorator",value:["isextractable",{initialValue:!1}],expression:"['isextractable', {\n            initialValue: false\n          }]"}]})],1),"Admin"===e.$store.getters.userInfo.roletype||e.$store.getters.features.userpublictemplateenabled?a("a-form-item",{attrs:{label:e.$t("label.ispublic")}},[a("a-switch",{directives:[{name:"decorator",rawName:"v-decorator",value:["ispublic",{initialValue:!1}],expression:"['ispublic', {\n            initialValue: false\n          }]"}]})],1):e._e(),a("a-form-item",{attrs:{label:e.$t("label.isfeatured")}},[a("a-switch",{directives:[{name:"decorator",rawName:"v-decorator",value:["isfeatured",{initialValue:!1}],expression:"['isfeatured', {\n            initialValue: false\n          }]"}]})],1),a("div",{staticClass:"action-button",attrs:{span:24}},[a("a-button",{on:{click:e.closeAction}},[e._v(e._s(this.$t("label.cancel")))]),a("a-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.handleSubmit}},[e._v(e._s(this.$t("label.ok")))])],1)],1)],1)],1)},i=[],r=(a("99af"),a("4de4"),a("4160"),a("c975"),a("fb6a"),a("a434"),a("b0c0"),a("a9e3"),a("b6802"),a("d3b7"),a("159b"),a("365c")),o=a("4360"),n=a("b775"),l={name:"RegisterIso",props:{resource:{type:Object,required:!0},action:{type:Object,required:!0}},data:function(){return{fileList:[],zones:[],osTypes:[],zoneLoading:!1,osTypeLoading:!1,defaultOsType:"",loading:!1,allowed:!1,bootable:!0,selectedZone:"",uploadParams:null,uploadPercentage:0,currentForm:"plus"===this.action.currentAction.icon?"Create":"Upload"}},beforeCreate:function(){var e=this;this.form=this.$form.createForm(this),this.apiConfig=this.$store.getters.apis.registerIso||{},this.apiParams={},this.apiConfig.params.forEach((function(t){e.apiParams[t.name]=t}))},created:function(){this.zones=[],"Admin"===this.$store.getters.userInfo.roletype&&"Create"===this.currentForm&&(this.zones=[{id:"-1",name:this.$t("label.all.zone")}])},mounted:function(){this.fetchData()},methods:{fetchData:function(){this.fetchZoneData(),this.fetchOsType()},fetchZoneData:function(){var e=this,t={listAll:!0};this.zoneLoading=!0,o["a"].getters.userInfo.roletype===this.rootAdmin&&(this.allowed=!0),Object(r["a"])("listZones",t).then((function(t){var a=t.listzonesresponse.zone;e.zones=e.zones.concat(a)})).finally((function(){e.zoneLoading=!1,e.selectedZone=e.zones[0].id?e.zones[0].id:""}))},fetchOsType:function(){var e=this,t={listAll:!0};this.osTypeLoading=!0,Object(r["a"])("listOsTypes",t).then((function(t){var a=t.listostypesresponse.ostype;e.osTypes=e.osTypes.concat(a)})).finally((function(){e.osTypeLoading=!1,e.defaultOsType=e.osTypes[0].id}))},handleRemove:function(e){var t=this.fileList.indexOf(e),a=this.fileList.slice();a.splice(t,1),this.fileList=a},beforeUpload:function(e){return this.fileList=[e],!1},handleUpload:function(){var e=this,t=this.fileList;this.fileList.length>1&&this.$notification.error({message:this.$t("message.upload.iso.failed"),description:this.$t("message.error.upload.iso.description"),duration:0});var a=new FormData;t.forEach((function(e){a.append("files[]",e)})),this.uploadPercentage=0,n["b"].post(this.uploadParams.postURL,a,{headers:{"Content-Type":"multipart/form-data","X-signature":this.uploadParams.signature,"X-expires":this.uploadParams.expires,"X-metadata":this.uploadParams.metadata},onUploadProgress:function(t){e.uploadPercentage=Number(parseFloat(100*t.loaded/t.total).toFixed(1))},timeout:864e5}).then((function(t){e.$notification.success({message:e.$t("message.success.upload"),description:e.$t("message.success.upload.description")}),e.closeAction(),e.$emit("refresh-data")})).catch((function(t){e.$notification.error({message:e.$t("message.upload.failed"),description:"".concat(e.$t("message.upload.iso.failed.description")," -  ").concat(t),duration:0})}))},handleSubmit:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,a){if(!e){var s={},i=function(e){var i=a[e];if(void 0===i)return"continue";if("file"===e)return"continue";switch(e){case"zoneid":n=t.zones.filter((function(e){return e.id===i})),s[e]=n[0].id;break;case"ostypeid":s[e]=i;break;default:s[e]=i;break}};for(var o in a){var n;i(o)}if("Create"===t.currentForm)t.loading=!0,Object(r["a"])("registerIso",s).then((function(e){t.$notification.success({message:t.$t("label.action.register.iso"),description:"".concat(t.$t("message.success.register.iso")," ").concat(s.name)}),t.closeAction(),t.$emit("refresh-data")})).catch((function(e){t.$notifyError(e)})).finally((function(){t.loading=!1}));else{if(1!==t.fileList.length)return;s.format="ISO",t.loading=!0,Object(r["a"])("getUploadParamsForIso",s).then((function(e){t.uploadParams=e.postuploadisoresponse&&e.postuploadisoresponse.getuploadparams?e.postuploadisoresponse.getuploadparams:"";var a=t.handleUpload();"upload successful"===a&&t.$notification.success({message:t.$t("message.success.upload"),description:t.$t("message.success.upload.iso.description")})})).catch((function(e){t.$notifyError(e)})).finally((function(){t.loading=!1,t.$emit("refresh-data")}))}}}))},closeAction:function(){this.$emit("close-action")}}},c=l,d=(a("073c"),a("2877")),u=Object(d["a"])(c,s,i,!1,null,"0d633d81",null);t["default"]=u.exports},8370:function(e,t,a){}}]);
//# sourceMappingURL=chunk-8a13d83e.3cfcd2de.js.map