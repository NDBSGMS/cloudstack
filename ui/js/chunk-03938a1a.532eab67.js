(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-03938a1a"],{"0024":function(e,a,t){"use strict";t.r(a);var i=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("a-spin",{attrs:{spinning:e.fetchLoading}},[t("div",[t("div",{staticClass:"vm-modal__header"},[t("span",{staticStyle:{"min-width":"200px"}},[e._v(e._s(e.$t("label.name")))]),t("span",[e._v(e._s(e.$t("label.state")))]),t("span",[e._v(e._s(e.$t("label.instancename")))]),t("span",[e._v(e._s(e.$t("label.displayname")))]),t("span",[e._v(e._s(e.$t("label.ip")))]),t("span",[e._v(e._s(e.$t("label.account")))]),t("span",[e._v(e._s(e.$t("label.zonenamelabel")))]),t("span",[e._v(e._s(e.$t("label.select")))])]),t("a-checkbox-group",{staticStyle:{width:"100%"}},[e._l(e.vms,(function(a,i){return t("div",{key:i,staticClass:"vm-modal__item"},[t("span",{staticStyle:{"min-width":"200px"}},[t("span",[e._v(" "+e._s(a.name)+" ")]),e.addVmModalNicLoading?t("a-icon",{attrs:{type:"loading"}}):e.addVmModalNicLoading||e.iLb.virtualmachineid[i]!==a.id?e._e():t("a-select",{attrs:{mode:"multiple"},model:{value:e.iLb.vmguestip[i],callback:function(a){e.$set(e.iLb.vmguestip,i,a)},expression:"iLb.vmguestip[index]"}},e._l(e.nics[i],(function(a,i){return t("a-select-option",{key:a,attrs:{value:a}},[e._v(" "+e._s(a)+e._s(0===i?" ("+this.$t("label.primary")+")":null)+" ")])})),1)],1),t("span",[t("status",{attrs:{text:a.state,displayText:""}})],1),t("span",[e._v(e._s(a.instancename))]),t("span",[e._v(e._s(a.displayname))]),t("span"),t("span",[e._v(e._s(a.account))]),t("span",[e._v(e._s(a.zonename))]),t("a-checkbox",{attrs:{value:a.id},on:{change:function(a){return e.fetchNics(a,i)}}})],1)})),t("a-divider"),t("a-pagination",{staticClass:"row-element pagination",attrs:{size:"small",current:e.page,pageSize:e.pageSize,total:e.vmCounts,showTotal:function(a){return e.$t("label.total")+" "+a+" "+e.$t("label.items")},pageSizeOptions:["10","20","40","80","100"],showSizeChanger:""},on:{change:e.changePage,showSizeChange:e.changePageSize},scopedSlots:e._u([{key:"buildOptionText",fn:function(a){return[t("span",[e._v(e._s(a.value)+" / "+e._s(e.$t("label.page")))])]}}])})],2)],1),t("div",{staticClass:"actions"},[t("a-button",{on:{click:e.closeModal}},[e._v(" "+e._s(e.$t("label.cancel"))+" ")]),t("a-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v(" "+e._s(e.$t("label.ok"))+" ")])],1)])},s=[],n=(t("99af"),t("4de4"),t("4160"),t("d81d"),t("45fc"),t("b0c0"),t("d3b7"),t("159b"),t("d0ff")),c=t("365c"),o=t("829c"),r={name:"InternalLBAssignVmForm",components:{Status:o["a"]},props:{resource:{type:Object,required:!0}},data:function(){return{page:1,pageSize:10,vmCounts:0,addVmModalNicLoading:!1,vms:[],nics:[],params:{},assignedVMs:[],iLb:{virtualmachineid:[],vmguestip:[]},fetchLoading:!1}},mounted:function(){this.fetchData()},methods:{fetchData:function(){this.fetchLoadBalancers(),this.fetchVirtualMachines()},fetchLoadBalancers:function(){var e=this;this.fetchLoading=!0,Object(c["a"])("listLoadBalancers",{id:this.resource.id}).then((function(a){var t=a.listloadbalancersresponse.loadbalancer;e.assignedVMs=[],Array.isArray(t)&&t.length&&(e.assignedVMs=t[0].loadbalancerinstance||[])})).finally((function(){e.fetchLoading=!1}))},differenceBy:function(e,a,t){return e.filter((function(e){return!a.some((function(a){return a[t]===e[t]}))}))},fetchVirtualMachines:function(){var e=this;this.fetchLoading=!0,Object(c["a"])("listVirtualMachines",{listAll:!0,networkid:this.resource.networkid,page:this.page,pagesize:this.pageSize}).then((function(a){var t=a.listvirtualmachinesresponse.virtualmachine||[];e.vms=e.differenceBy(t,e.assignedVMs,"id"),e.vmCounts=e.vms.length||0,e.vms.forEach((function(a,t){e.iLb.virtualmachineid[t]=null,e.nics[t]=null,e.iLb.vmguestip[t]=null}))})).finally((function(){e.fetchLoading=!1}))},fetchNics:function(e,a){var t=this;if(!e.target.checked)return this.iLb.virtualmachineid[a]=null,this.nics[a]=null,void(this.iLb.vmguestip[a]=null);this.iLb.virtualmachineid[a]=e.target.value,this.addVmModalNicLoading=!0,Object(c["a"])("listNics",{virtualmachineid:e.target.value,networkid:this.resource.networkid}).then((function(e){if(e.listnicsresponse.nic[0]){var i=[];i.push(e.listnicsresponse.nic[0].ipaddress),e.listnicsresponse.nic[0].secondaryip&&i.push.apply(i,Object(n["a"])(e.listnicsresponse.nic[0].secondaryip.map((function(e){return e.ipaddress})))),t.nics[a]=i,t.iLb.vmguestip[a]=t.nics[a][0],t.addVmModalNicLoading=!1}})).catch((function(e){t.$notifyError(e),t.closeModal()}))},closeModal:function(){this.$emit("close-action")},handleSubmit:function(){var e=this,a=0;this.params={};for(var t=0;t<this.iLb.virtualmachineid.length;t++)null!==this.iLb.virtualmachineid[t]&&(this.params["vmidipmap["+a+"].vmid"]=this.iLb.virtualmachineid[t],this.params["vmidipmap["+a+"].vmip"]=this.iLb.vmguestip[t],a++);this.params.id=this.resource.id,this.fetchLoading=!0,Object(c["a"])("assignToLoadBalancerRule",this.params).then((function(a){e.$pollJob({jobId:a.assigntoloadbalancerruleresponse.jobid,successMessage:"".concat(e.$t("message.success.assigned.vms")," ").concat(e.$t("label.to")," ").concat(e.resource.name),successMethod:function(){e.$emit("refresh-data")},errorMessage:"".concat(e.$t("message.failed.to.assign.vms")," ").concat(e.$t("label.to")," ").concat(e.resource.name),errorMethod:function(){e.$emit("refresh-data")},loadingMessage:"".concat(e.$t("label.assigning.vms")," ").concat(e.$t("label.to")," ").concat(e.resource.name),catchMessage:e.$t("error.fetching.async.job.result")}),e.$emit("refresh-data"),e.closeModal()})).catch((function(a){e.$notification.error({message:"".concat(e.$t("label.error")," ").concat(a.response.status),description:a.response.data.errorresponse.errortext,duration:0})})).finally((function(){e.fetchLoading=!1}))},changePage:function(e,a){this.page=e,this.pageSize=a,this.fetchData()},changePageSize:function(e,a){this.page=e,this.pageSize=a,this.fetchData()}}},l=r,u=(t("13e3"),t("2877")),d=Object(u["a"])(l,i,s,!1,null,"6e2792f0",null);a["default"]=d.exports},"13e3":function(e,a,t){"use strict";var i=t("1709"),s=t.n(i);s.a},1709:function(e,a,t){},"45fc":function(e,a,t){"use strict";var i=t("23e7"),s=t("b727").some,n=t("a640"),c=t("ae40"),o=n("some"),r=c("some");i({target:"Array",proto:!0,forced:!o||!r},{some:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=chunk-03938a1a.532eab67.js.map