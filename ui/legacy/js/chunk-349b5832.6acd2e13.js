(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-349b5832"],{"649a":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"form-layout"},[a("a-form",{attrs:{layout:"vertical",form:e.form}},[a("a-form-item",{attrs:{label:e.$t("label.volume")}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["volumeid",{rules:[{required:!0,message:""+this.$t("message.error.select")}]}],expression:"['volumeid', {\n          rules: [{ required: true, message: `${this.$t('message.error.select')}` }]\n        }]"}],attrs:{allowClear:"",loading:e.volumeOptions.loading}},e._l(e.volumeOptions.opts,(function(t){return a("a-select-option",{key:t.id},[e._v(" "+e._s(t.name)+" ")])})),1)],1),a("a-form-item",{attrs:{label:e.$t("label.vm")}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["virtualmachineid",{rules:[{required:!0,message:""+this.$t("message.error.select")}]}],expression:"['virtualmachineid', {\n          rules: [{ required: true, message: `${this.$t('message.error.select')}` }]\n        }]"}],attrs:{showSearch:"",allowClear:"",loading:e.virtualMachineOptions.loading}},e._l(e.virtualMachineOptions.opts,(function(t){return a("a-select-option",{key:t.name},[e._v(" "+e._s(t.name)+" ")])})),1)],1),a("div",{staticClass:"action-button",attrs:{span:24}},[a("a-button",{attrs:{loading:e.loading||e.actionLoading},on:{click:e.closeAction}},[e._v(e._s(this.$t("label.cancel")))]),a("a-button",{attrs:{loading:e.loading||e.actionLoading,type:"primary"},on:{click:e.handleSubmit}},[e._v(e._s(this.$t("label.ok")))])],1)],1)],1)},o=[],i=(a("99af"),a("4de4"),a("a15b"),a("d81d"),a("b0c0"),a("b64b"),a("d3b7"),a("96cf"),a("c964")),r=a("365c"),s={name:"RestoreAttachBackupVolume",props:{loading:{type:Boolean,default:!1},resource:{type:Object,default:function(){}}},data:function(){return{virtualMachineOptions:{loading:!1,opts:[]},volumeOptions:{loading:!1,opts:[]},actionLoading:!1}},beforeCreate:function(){this.form=this.$form.createForm(this)},mounted:function(){this.fetchData()},inject:["parentFetchData"],methods:{fetchData:function(){this.fetchVirtualMachine(),this.fetchVolumes()},fetchVirtualMachine:function(){var e=this;this.virtualMachineOptions.loading=!0,Object(r["a"])("listVirtualMachines",{zoneid:this.resource.zoneid}).then((function(t){e.virtualMachineOptions.opts=t.listvirtualmachinesresponse.virtualmachine||[],e.$forceUpdate()})).catch((function(t){e.$notifyError(t)})).finally((function(){e.virtualMachineOptions.loading=!1}))},fetchVolumes:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.resource&&0!==Object.keys(e.resource).length){t.next=2;break}return t.abrupt("return");case 2:if(e.resource.volumes&&"string"===typeof e.resource.volumes){t.next=4;break}return t.abrupt("return");case 4:return a=JSON.parse(e.resource.volumes),e.volumeOptions.loading=!0,t.next=8,a.map((function(e){return{id:e.uuid,name:["(",e.type,") ",e.uuid].join("")}}));case 8:e.volumeOptions.opts=t.sent,e.volumeOptions.loading=!1,e.$forceUpdate();case 11:case"end":return t.stop()}}),t)})))()},handleSubmit:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,a){if(!e){var n={};n.backupid=t.resource.id,n.volumeid=a.volumeid,n.virtualmachineid=t.virtualMachineOptions.opts.filter((function(e){return e.name===a.virtualmachineid}))[0].id||null,t.actionLoading=!0;var o=t.$t("label.restore.volume.attach");Object(r["a"])("restoreVolumeFromBackupAndAttachToVM",n).then((function(e){var a=e.restorevolumefrombackupandattachtovmresponse.jobid||null;a&&t.$pollJob({jobId:a,successMethod:function(e){var n=e.jobresult.storagebackup.name;t.$store.dispatch("AddAsyncJob",{title:o,jobid:a,description:n,status:"progress"}),t.parentFetchData(),t.closeAction()},loadingMessage:"".concat(o," ").concat(t.$t("label.in.progress.for")," ").concat(t.resource.id),catchMessage:t.$t("error.fetching.async.job.result")})})).catch((function(e){t.$notifyError(e)})).finally((function(){t.actionLoading=!1}))}}))},closeAction:function(){this.$emit("close-action")}}},c=s,l=(a("c824"),a("2877")),u=Object(l["a"])(c,n,o,!1,null,"54d7ac3f",null);t["default"]=u.exports},"9e60":function(e,t,a){},c824:function(e,t,a){"use strict";var n=a("9e60"),o=a.n(n);o.a}}]);
//# sourceMappingURL=chunk-349b5832.6acd2e13.js.map