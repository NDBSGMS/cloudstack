(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-757d19e8"],{"5cc3":function(e,t,o){"use strict";var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("a-select",{attrs:{value:e.defaultValue},on:{change:e.handleChange}},[o("a-select-option",{attrs:{value:"allow"}},[e._v(e._s(e.$t("label.allow")))]),o("a-select-option",{attrs:{value:"deny"}},[e._v(e._s(e.$t("label.deny")))])],1)},i=[],l={props:{defaultValue:{type:String,required:!0}},methods:{handleChange:function(e){this.$emit("change",e)}}},r=l,n=o("2877"),s=Object(n["a"])(r,a,i,!1,null,null,null);t["a"]=s.exports},"8c1f":function(e,t,o){"use strict";var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("a-tooltip",{attrs:{placement:"bottom"}},[o("template",{slot:"title"},[e._v(" "+e._s(e.$t("label.delete.rule"))+" ")]),o("a-popconfirm",{attrs:{title:e.$t("label.delete.rule")+"?",disabled:e.disabled},on:{confirm:e.handleDelete}},[o("a-button",{attrs:{type:"danger",shape:"circle",disabled:e.disabled}},[o("a-icon",{attrs:{type:"delete"}})],1)],1)],2)},i=[],l={name:"RuleDelete",props:{record:{type:Object,required:!0},disabled:{type:Boolean,default:!1}},methods:{handleDelete:function(){this.$emit("delete")}}},r=l,n=(o("c466"),o("2877")),s=Object(n["a"])(r,a,i,!1,null,"c2a6d786",null);t["a"]=s.exports},a0b5:function(e,t,o){"use strict";var a=o("b30d"),i=o.n(a);i.a},a232:function(e,t,o){"use strict";var a=o("e57d"),i=o.n(a);i.a},b30d:function(e,t,o){},c466:function(e,t,o){"use strict";var a=o("db3a"),i=o.n(a);i.a},d129:function(e,t,o){"use strict";o.r(t);var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("a-button",{staticStyle:{width:"100%","margin-bottom":"15px"},attrs:{type:"dashed",icon:"plus"},on:{click:e.openCreateModal}},[e._v(" "+e._s(e.$t("label.create.project.role"))+" ")]),o("a-row",{attrs:{gutter:12}},[o("a-col",{attrs:{md:24,lg:24}},[o("a-table",{attrs:{size:"small",loading:e.loading,columns:e.columns,dataSource:e.dataSource,rowKey:function(e,t){return e.projectid+"-"+t},pagination:!1},scopedSlots:e._u([{key:"expandedRowRender",fn:function(t){return[o("ProjectRolePermissionTab",{staticClass:"table",attrs:{resource:e.resource,role:t}})]}},{key:"name",fn:function(t){return[e._v(" "+e._s(t)+" ")]}},{key:"description",fn:function(t){return[e._v(" "+e._s(t)+" ")]}},{key:"action",fn:function(t,a){return o("span",{},[o("a-tooltip",{attrs:{placement:"top"}},[o("template",{slot:"title"},[e._v(" "+e._s(e.$t("label.update.project.role"))+" ")]),o("a-button",{staticStyle:{margin:"10px"},attrs:{type:"default",shape:"circle",icon:"edit",size:"small"},on:{click:function(t){return e.openUpdateModal(a)}}})],2),o("a-tooltip",{attrs:{placement:"top"}},[o("template",{slot:"title"},[e._v(" "+e._s(e.$t("label.remove.project.role"))+" ")]),o("a-button",{attrs:{type:"danger",shape:"circle",icon:"delete",size:"small"},on:{click:function(t){return e.deleteProjectRole(a)}}})],2)],1)}}])}),o("a-modal",{attrs:{title:e.$t("label.edit.project.role"),footer:null,afterClose:e.closeAction,maskClosable:!1},model:{value:e.editModalVisible,callback:function(t){e.editModalVisible=t},expression:"editModalVisible"}},[o("a-form",{attrs:{form:e.form,layout:"vertical"},on:{submit:e.updateProjectRole},scopedSlots:e._u([{key:"action",fn:function(t,a){return o("span",{},[o("a-tooltip",{attrs:{placement:"top"}},[o("template",{slot:"title"},[e._v(" "+e._s(e.$t("label.update.project.role"))+" ")]),o("a-button",{staticStyle:{margin:"10px"},attrs:{type:"default",shape:"circle",icon:"edit",size:"small"},on:{click:function(t){return e.openUpdateModal(a)}}})],2),o("a-tooltip",{attrs:{placement:"top"}},[o("template",{slot:"title"},[e._v(" "+e._s(e.$t("label.remove.project.role"))+" ")]),o("a-button",{attrs:{type:"danger",shape:"circle",icon:"delete",size:"small"},on:{click:function(t){return e.deleteProjectRole(a)}}})],2)],1)}}])},[o("a-form-item",{attrs:{label:e.$t("label.name")}},[o("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name"],expression:"[ 'name' ]"}]})],1),o("a-form-item",{attrs:{label:e.$t("label.description")}},[o("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["description"],expression:"[ 'description' ]"}]})],1),o("div",{staticClass:"action-button",attrs:{span:24}},[o("a-button",{on:{click:e.closeAction}},[e._v(e._s(this.$t("label.cancel")))]),o("a-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.updateProjectRole}},[e._v(e._s(e.$t("label.ok")))])],1)],1)],1),o("a-modal",{attrs:{title:e.$t("label.create.project.role"),footer:null,afterClose:e.closeAction,maskClosable:!1},model:{value:e.createModalVisible,callback:function(t){e.createModalVisible=t},expression:"createModalVisible"}},[o("a-form",{attrs:{form:e.form,layout:"vertical"},on:{submit:e.createProjectRole}},[o("a-form-item",{attrs:{label:e.$t("label.name")}},[o("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"Please provide input"}]}],expression:"[ 'name', { rules: [{ required: true, message: 'Please provide input' }] }]"}]})],1),o("a-form-item",{attrs:{label:e.$t("label.description")}},[o("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["description"],expression:"[ 'description' ]"}]})],1),o("div",{staticClass:"action-button",attrs:{span:24}},[o("a-button",{on:{click:e.closeAction}},[e._v(e._s(this.$t("label.cancel")))]),o("a-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.createProjectRole}},[e._v(e._s(e.$t("label.ok")))])],1)],1)],1)],1)],1)],1)},i=[],l=(o("d3b7"),o("365c")),r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return e.loadingTable?o("a-icon",{staticClass:"main-loading-spinner",attrs:{type:"loading"}}):o("div",[e.updateTable?o("div",{staticClass:"loading-overlay"},[o("a-icon",{attrs:{type:"loading"}})],1):e._e(),o("div",{staticClass:"rules-list ant-list ant-list-bordered",class:{"rules-list--overflow-hidden":e.updateTable}},[o("div",{staticClass:"rules-table-item ant-list-item"},[o("div",{staticClass:"rules-table__col rules-table__col--grab"}),o("div",{staticClass:"rules-table__col rules-table__col--rule rules-table__col--new"},[o("a-auto-complete",{class:{"rule-dropdown-error":e.newRuleSelectError},attrs:{autoFocus:!0,filterOption:e.filterOption,dataSource:e.apis,value:e.newRule,placeholder:"Rule"},on:{change:function(t){return e.newRule=t}}})],1),o("div",{staticClass:"rules-table__col rules-table__col--permission"},[o("permission-editable",{attrs:{defaultValue:e.newRulePermission},on:{change:function(t){return e.onPermissionChange(null,t)}}})],1),o("div",{staticClass:"rules-table__col rules-table__col--description"},[o("a-input",{attrs:{placeholder:"Description"},model:{value:e.newRuleDescription,callback:function(t){e.newRuleDescription=t},expression:"newRuleDescription"}})],1),o("div",{staticClass:"rules-table__col rules-table__col--actions"},[o("a-tooltip",{attrs:{placement:"bottom"}},[o("template",{slot:"title"},[e._v(" Save new Rule ")]),o("a-button",{attrs:{icon:"plus",type:"primary",shape:"circle"},on:{click:e.onRuleSave}})],2)],1)]),o("draggable",{attrs:{handle:".drag-handle",animation:"200",ghostClass:"drag-ghost"},on:{change:e.changeOrder},model:{value:e.rules,callback:function(t){e.rules=t},expression:"rules"}},[o("transition-group",{attrs:{type:"transition"}},e._l(e.rules,(function(t,a){return o("div",{key:"item-"+a,staticClass:"rules-table-item ant-list-item"},[o("div",{staticClass:"rules-table__col rules-table__col--grab drag-handle"},[o("a-icon",{attrs:{type:"drag"}})],1),o("div",{staticClass:"rules-table__col rules-table__col--rule"},[e._v(" "+e._s(t.rule)+" ")]),o("div",{staticClass:"rules-table__col rules-table__col--permission"},[o("permission-editable",{attrs:{defaultValue:t.permission},on:{change:function(o){return e.onPermissionChange(t,o)}}})],1),o("div",{staticClass:"rules-table__col rules-table__col--description"},[t.description?[e._v(" "+e._s(t.description)+" ")]:o("div",{staticClass:"no-description"},[e._v(" No description entered. ")])],2),o("div",{staticClass:"rules-table__col rules-table__col--actions"},[o("rule-delete",{attrs:{record:t},on:{delete:function(o){return e.onRuleDelete(t.id)}}})],1)])})),0)],1)],1)])},n=[],s=(o("c975"),o("d81d"),o("b64b"),o("310e")),c=o.n(s),u=o("5cc3"),d=o("8c1f"),p={name:"ProjectRolePermissionTab",components:{RuleDelete:d["a"],PermissionEditable:u["a"],draggable:c.a},props:{resource:{type:Object,required:!0},role:{type:Object,required:!0}},data:function(){return{loadingTable:!0,updateTable:!1,rules:null,newRule:"",newRulePermission:"allow",newRuleDescription:"",newRuleSelectError:!1,drag:!1,apis:[]}},mounted:function(){this.apis=Object.keys(this.$store.getters.apis).sort((function(e,t){return e.localeCompare(t)})),this.fetchData()},watch:{resource:function(){var e=this;this.fetchData((function(){e.resetNewFields()}))}},methods:{filterOption:function(e,t){return t.componentOptions.children[0].text.toUpperCase().indexOf(e.toUpperCase())>=0},resetNewFields:function(){this.newRule="",this.newRulePermission="allow",this.newRuleDescription="",this.newRuleSelectError=!1},fetchData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.resource.id&&Object(l["a"])("listProjectRolePermissions",{projectid:this.resource.id,projectroleid:this.role.id}).then((function(t){e.rules=t.listprojectrolepermissionsresponse.projectrolepermission})).catch((function(e){console.error(e)})).finally((function(){e.loadingTable=!1,e.updateTable=!1,t&&t()}))},changeOrder:function(){var e=this;Object(l["a"])("updateProjectRolePermission",{},"POST",{projectid:this.resource.id,projectroleid:this.role.id,ruleorder:this.rules.map((function(e){return e.id}))}).catch((function(e){console.error(e)})).finally((function(){e.fetchData()}))},onRuleDelete:function(e){var t=this;this.updateTable=!0,Object(l["a"])("deleteProjectRolePermission",{id:e,projectid:this.resource.id}).catch((function(e){console.error(e)})).finally((function(){t.fetchData()}))},onPermissionChange:function(e,t){var o=this;this.newRulePermission=t,e&&(this.updateTable=!0,Object(l["a"])("updateProjectRolePermission",{projectid:this.resource.id,projectroleid:this.role.id,projectrolepermissionid:e.id,permission:t}).then((function(){o.fetchData()})).catch((function(e){o.$notifyError(e)})))},onRuleSelect:function(e){this.newRule=e},onRuleSave:function(){var e=this;this.newRule?(this.updateTable=!0,Object(l["a"])("createProjectRolePermission",{rule:this.newRule,permission:this.newRulePermission,description:this.newRuleDescription,projectroleid:this.role.id,projectid:this.resource.id}).then((function(){})).catch((function(t){console.error(t),e.$notifyError(t)})).finally((function(){e.resetNewFields(),e.fetchData()}))):this.newRuleSelectError=!0}}},f=p,b=(o("a0b5"),o("f60a"),o("2877")),m=Object(b["a"])(f,r,n,!1,null,"4f9f8275",null),h=m.exports,v={name:"ProjectRoleTab",props:{resource:{type:Object,required:!0}},components:{ProjectRolePermissionTab:h},data:function(){return{columns:[],dataSource:[],loading:!1,createModalVisible:!1,editModalVisible:!1,selectedRole:null,projectPermisssions:[],customStyle:"margin-bottom: -10px; border-bottom-style: none"}},beforeCreate:function(){this.form=this.$form.createForm(this)},created:function(){this.columns=[{title:this.$t("label.name"),dataIndex:"name",width:"35%",scopedSlots:{customRender:"name"}},{title:this.$t("label.description"),dataIndex:"description"},{title:this.$t("label.action"),dataIndex:"action",width:100,scopedSlots:{customRender:"action"}}]},mounted:function(){this.fetchData()},watch:{resource:function(e,t){e&&e.id&&(this.resource=e,this.fetchData())}},methods:{fetchData:function(){var e=this;this.loading=!0,Object(l["a"])("listProjectRoles",{projectid:this.resource.id}).then((function(t){var o=t.listprojectrolesresponse.projectrole;o&&0!==o.length?e.dataSource=o:e.dataSource=[]})).catch((function(t){e.$notifyError(t)})).finally((function(){e.loading=!1}))},openUpdateModal:function(e){this.selectedRole=e,this.editModalVisible=!0},openCreateModal:function(){this.createModalVisible=!0},updateProjectRole:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,o){if(!e){var a={};for(var i in t.loading=!0,a.projectid=t.resource.id,a.id=t.selectedRole.id,o){var r=o[i];void 0!==r&&(a[i]=r)}Object(l["a"])("updateProjectRole",a).then((function(e){t.$notification.success({message:t.$t("label.update.project.role"),description:t.$t("label.update.project.role")}),t.fetchData(),t.closeAction()})).catch((function(e){t.$notifyError(e)})).finally((function(){t.loading=!1}))}}))},closeAction:function(){this.editModalVisible&&(this.editModalVisible=!1),this.createModalVisible&&(this.createModalVisible=!1)},createProjectRole:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,o){if(!e){t.loading=!0;var a={};for(var i in a.projectid=t.resource.id,o){var r=o[i];void 0!==r&&(a[i]=r)}Object(l["a"])("createProjectRole",a).then((function(e){t.$notification.success({message:t.$t("label.create.project.role"),description:t.$t("label.create.project.role")}),t.fetchData(),t.closeAction()})).catch((function(e){t.$notifyError(e)})).finally((function(){t.loading=!1}))}}))},deleteProjectRole:function(e){var t=this;this.loading=!0,Object(l["a"])("deleteProjectRole",{projectid:this.resource.id,id:e.id}).then((function(e){t.$notification.success({message:t.$t("label.delete.project.role"),description:t.$t("label.delete.project.role")}),t.fetchData(),t.closeAction()})).catch((function(e){t.$notifyError(e)})).finally((function(){t.loading=!1}))}}},_=v,j=(o("a232"),Object(b["a"])(_,a,i,!1,null,"0e748e62",null));t["default"]=j.exports},db3a:function(e,t,o){},e57d:function(e,t,o){},e913:function(e,t,o){},f60a:function(e,t,o){"use strict";var a=o("e913"),i=o.n(a);i.a}}]);
//# sourceMappingURL=chunk-757d19e8.dd3eebfa.js.map