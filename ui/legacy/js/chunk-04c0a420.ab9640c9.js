(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-04c0a420"],{"0c73":function(e,t,a){"use strict";var s=a("6a16"),i=a.n(s);i.a},"6a16":function(e,t,a){},d16c:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("div",{staticClass:"form"},[a("div",{staticClass:"form__item"},[a("div",{staticClass:"form__label"},[e._v(e._s(e.$t("label.privateport")))]),a("a-input-group",{staticClass:"form__item__input-container",attrs:{compact:""}},[a("a-input",{staticStyle:{"border-right":"0",width:"60px","margin-right":"0"},attrs:{placeholder:e.$t("label.start")},model:{value:e.newRule.privateport,callback:function(t){e.$set(e.newRule,"privateport",t)},expression:"newRule.privateport"}}),a("a-input",{staticStyle:{width:"30px","border-left":"0","border-right":"0","pointer-events":"none",backgroundColor:"#fff","margin-right":"0"},attrs:{placeholder:"-",disabled:""}}),a("a-input",{staticStyle:{"border-left":"0",width:"60px","text-align":"right","margin-right":"0"},attrs:{placeholder:e.$t("label.end")},model:{value:e.newRule.privateendport,callback:function(t){e.$set(e.newRule,"privateendport",t)},expression:"newRule.privateendport"}})],1)],1),a("div",{staticClass:"form__item"},[a("div",{staticClass:"form__label"},[e._v(e._s(e.$t("label.publicport")))]),a("a-input-group",{staticClass:"form__item__input-container",attrs:{compact:""}},[a("a-input",{staticStyle:{"border-right":"0",width:"60px","margin-right":"0"},attrs:{placeholder:e.$t("label.start")},model:{value:e.newRule.publicport,callback:function(t){e.$set(e.newRule,"publicport",t)},expression:"newRule.publicport"}}),a("a-input",{staticStyle:{width:"30px","border-left":"0","border-right":"0","pointer-events":"none",backgroundColor:"#fff","text-align":"center","margin-right":"0"},attrs:{placeholder:"-",disabled:""}}),a("a-input",{staticStyle:{"border-left":"0",width:"60px","text-align":"right","margin-right":"0"},attrs:{placeholder:e.$t("label.end")},model:{value:e.newRule.publicendport,callback:function(t){e.$set(e.newRule,"publicendport",t)},expression:"newRule.publicendport"}})],1)],1),a("div",{staticClass:"form__item"},[a("div",{staticClass:"form__label"},[e._v(e._s(e.$t("label.protocol")))]),a("a-select",{staticStyle:{width:"100%"},model:{value:e.newRule.protocol,callback:function(t){e.$set(e.newRule,"protocol",t)},expression:"newRule.protocol"}},[a("a-select-option",{attrs:{value:"tcp"}},[e._v(e._s(e.$t("label.tcp")))]),a("a-select-option",{attrs:{value:"udp"}},[e._v(e._s(e.$t("label.udp")))])],1)],1),a("div",{staticClass:"form__item",staticStyle:{"margin-left":"auto"}},[a("div",{staticClass:"form__label"},[e._v(e._s(e.$t("label.add.vm")))]),a("a-button",{attrs:{disabled:!("createPortForwardingRule"in e.$store.getters.apis),type:"primary"},on:{click:e.openAddVMModal}},[e._v(e._s(e.$t("label.add")))])],1)])]),a("a-divider"),a("a-table",{staticStyle:{"overflow-y":"auto"},attrs:{size:"small",loading:e.loading,columns:e.columns,dataSource:e.portForwardRules,pagination:!1,rowKey:function(e){return e.id}},scopedSlots:e._u([{key:"privateport",fn:function(t){return[e._v(" "+e._s(t.privateport)+" - "+e._s(t.privateendport)+" ")]}},{key:"publicport",fn:function(t){return[e._v(" "+e._s(t.publicport)+" - "+e._s(t.publicendport)+" ")]}},{key:"protocol",fn:function(t){return[e._v(" "+e._s(e._f("capitalise")(t.protocol))+" ")]}},{key:"vm",fn:function(t){return[a("div",[a("a-icon",{attrs:{type:"desktop"}}),a("router-link",{attrs:{to:{path:"/vm/"+t.virtualmachineid}}},[e._v(" "+e._s(t.virtualmachinename))]),e._v(" ("+e._s(t.vmguestip)+")")],1)]}},{key:"actions",fn:function(t){return[a("div",{staticClass:"actions"},[a("a-button",{staticClass:"rule-action",attrs:{shape:"circle",icon:"tag"},on:{click:function(){return e.openTagsModal(t.id)}}}),a("a-button",{staticClass:"rule-action",attrs:{shape:"circle",type:"danger",icon:"delete",disabled:!("deletePortForwardingRule"in e.$store.getters.apis)},on:{click:function(a){return e.deleteRule(t)}}})],1)]}}])}),a("a-pagination",{staticClass:"pagination",attrs:{size:"small",current:e.page,pageSize:e.pageSize,total:e.totalCount,showTotal:function(t){return e.$t("label.total")+" "+t+" "+e.$t("label.items")},pageSizeOptions:["10","20","40","80","100"],showSizeChanger:""},on:{change:e.handleChangePage,showSizeChange:e.handleChangePageSize},scopedSlots:e._u([{key:"buildOptionText",fn:function(t){return[a("span",[e._v(e._s(t.value)+" / "+e._s(e.$t("label.page")))])]}}])}),a("a-modal",{attrs:{title:e.$t("label.edit.tags"),footer:null,maskClosable:!1,afterClose:e.closeModal},model:{value:e.tagsModalVisible,callback:function(t){e.tagsModalVisible=t},expression:"tagsModalVisible"}},[a("span",{directives:[{name:"show",rawName:"v-show",value:e.tagsModalLoading,expression:"tagsModalLoading"}],staticClass:"tags-modal-loading"},[a("a-icon",{attrs:{type:"loading"}})],1),a("div",{staticClass:"add-tags"},[a("div",{staticClass:"add-tags__input"},[a("p",{staticClass:"add-tags__label"},[e._v(e._s(e.$t("label.key")))]),a("a-input",{model:{value:e.newTag.key,callback:function(t){e.$set(e.newTag,"key",t)},expression:"newTag.key"}})],1),a("div",{staticClass:"add-tags__input"},[a("p",{staticClass:"add-tags__label"},[e._v(e._s(e.$t("label.value")))]),a("a-input",{model:{value:e.newTag.value,callback:function(t){e.$set(e.newTag,"value",t)},expression:"newTag.value"}})],1),a("a-button",{attrs:{type:"primary"},on:{click:function(){return e.handleAddTag()}}},[e._v(e._s(e.$t("label.add")))])],1),a("a-divider"),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.tagsModalLoading,expression:"!tagsModalLoading"}],staticClass:"tags-container"},e._l(e.tags,(function(t,s){return a("div",{key:s,staticClass:"tags"},[a("a-tag",{key:s,attrs:{closable:!0,afterClose:function(){return e.handleDeleteTag(t)}}},[e._v(" "+e._s(t.key)+" = "+e._s(t.value)+" ")])],1)})),0),a("a-button",{staticClass:"add-tags-done",attrs:{type:"primary"},on:{click:function(t){e.tagsModalVisible=!1}}},[e._v(e._s(e.$t("label.done")))])],1),a("a-modal",{staticClass:"vm-modal",attrs:{title:e.$t("label.add.vm"),maskClosable:!1,okText:e.$t("label.ok"),cancelText:e.$t("label.cancel"),width:"60vw",okButtonProps:{props:{disabled:null===e.newRule.virtualmachineid}}},on:{ok:e.addRule,cancel:e.closeModal},model:{value:e.addVmModalVisible,callback:function(t){e.addVmModalVisible=t},expression:"addVmModalVisible"}},[a("div",["vpcid"in e.resource&&!("associatednetworkid"in e.resource)?a("span",[a("strong",[e._v(e._s(e.$t("label.select.tier"))+" ")]),a("a-select",{attrs:{placeholder:e.$t("label.select.tier")},on:{change:function(t){return e.fetchVirtualMachines()}},model:{value:e.selectedTier,callback:function(t){e.selectedTier=t},expression:"selectedTier"}},e._l(e.tiers.data,(function(t){return a("a-select-option",{key:t.id,attrs:{loading:e.tiers.loading}},[e._v(" "+e._s(t.displaytext)+" ")])})),1)],1):e._e(),a("a-input-search",{staticClass:"input-search",attrs:{placeholder:e.$t("label.search"),allowClear:""},on:{search:e.onSearch},model:{value:e.searchQuery,callback:function(t){e.searchQuery=t},expression:"searchQuery"}}),a("a-table",{staticClass:"list-view",attrs:{size:"small",loading:e.addVmModalLoading,columns:e.vmColumns,dataSource:e.vms,pagination:!1,rowKey:function(e){return e.id},scroll:{y:300}},scopedSlots:e._u([{key:"name",fn:function(t,s){return a("div",{},[a("span",[e._v(" "+e._s(t)+" ")]),e.addVmModalNicLoading?a("a-icon",{attrs:{type:"loading"}}):e.addVmModalNicLoading||e.newRule.virtualmachineid!==s.id?e._e():a("a-select",{staticStyle:{display:"block"},model:{value:e.newRule.vmguestip,callback:function(t){e.$set(e.newRule,"vmguestip",t)},expression:"newRule.vmguestip"}},e._l(e.nics,(function(t,s){return a("a-select-option",{key:t,attrs:{value:t}},[e._v(" "+e._s(t)+e._s(0===s?" ("+e.$t("label.primary")+")":null)+" ")])})),1)],1)}},{key:"state",fn:function(e){return a("div",{},[a("status",{attrs:{text:e||"",displayText:""}})],1)}},{key:"action",fn:function(t,s){return a("div",{staticStyle:{"text-align":"center"}},[a("a-radio",{attrs:{value:s.id},on:{change:function(t){return e.fetchNics(t)}}})],1)}}])}),a("a-pagination",{staticClass:"pagination",attrs:{size:"small",current:e.vmPage,pageSize:e.vmPageSize,total:e.vmCount,showTotal:function(t){return e.$t("label.total")+" "+t+" "+e.$t("label.items")},pageSizeOptions:["10","20","40","80","100"],showSizeChanger:""},on:{change:e.handleChangePage,showSizeChange:e.handleChangePageSize},scopedSlots:e._u([{key:"buildOptionText",fn:function(t){return[a("span",[e._v(e._s(t.value)+" / "+e._s(e.$t("label.page")))])]}}])})],1)])],1)},i=[],n=(a("d81d"),a("d3b7"),a("d0ff")),o=a("f3f3"),l=a("365c"),r=a("829c"),c=void 0,d={components:{Status:r["a"]},props:{resource:{type:Object,required:!0}},inject:["parentFetchData","parentToggleLoading"],data:function(){return{loading:!0,portForwardRules:[],newRule:{protocol:"tcp",privateport:null,privateendport:null,publicport:null,publicendport:null,openfirewall:!1,vmguestip:null,virtualmachineid:null},tagsModalVisible:!1,selectedRule:null,selectedTier:null,tags:[],newTag:{key:null,value:null},tagsModalLoading:!1,addVmModalVisible:!1,addVmModalLoading:!1,addVmModalNicLoading:!1,vms:[],nics:[],totalCount:0,page:1,pageSize:10,columns:[{title:this.$t("label.privateport"),scopedSlots:{customRender:"privateport"}},{title:this.$t("label.publicport"),scopedSlots:{customRender:"publicport"}},{title:this.$t("label.protocol"),scopedSlots:{customRender:"protocol"}},{title:this.$t("label.state"),dataIndex:"state"},{title:this.$t("label.vm"),scopedSlots:{customRender:"vm"}},{title:this.$t("label.action"),scopedSlots:{customRender:"actions"}}],tiers:{loading:!1,data:[]},vmColumns:[{title:this.$t("label.name"),dataIndex:"name",scopedSlots:{customRender:"name"},width:210},{title:this.$t("label.state"),dataIndex:"state",scopedSlots:{customRender:"state"}},{title:this.$t("label.displayname"),dataIndex:"displayname"},{title:this.$t("label.ip"),dataIndex:"ip",width:100},{title:this.$t("label.account"),dataIndex:"account"},{title:this.$t("label.zone"),dataIndex:"zonename"},{title:this.$t("label.select"),dataIndex:"action",scopedSlots:{customRender:"action"},width:80}],vmPage:1,vmPageSize:10,vmCount:0,searchQuery:null}},mounted:function(){this.fetchData()},watch:{resource:function(e,t){e&&e.id&&(this.resource=e,this.fetchData())}},filters:{capitalise:function(e){return"all"===e?c.$t("label.all"):e.toUpperCase()}},methods:{fetchData:function(){this.fetchListTiers(),this.fetchPFRules()},fetchListTiers:function(){var e=this;"vpcid"in this.resource&&"associatednetworkid"in this.resource||(this.tiers.loading=!0,Object(l["a"])("listNetworks",{account:this.resource.account,domainid:this.resource.domainid,supportedservices:"PortForwarding",vpcid:this.resource.vpcid}).then((function(t){e.tiers.data=t.listnetworksresponse.network||[],e.selectedTier=e.tiers.data&&e.tiers.data[0].id?e.tiers.data[0].id:null,e.$forceUpdate()})).catch((function(t){e.$notifyError(t)})).finally((function(){e.tiers.loading=!1})))},fetchPFRules:function(){var e=this;this.loading=!0,Object(l["a"])("listPortForwardingRules",{listAll:!0,ipaddressid:this.resource.id,page:this.page,pageSize:this.pageSize}).then((function(t){e.portForwardRules=t.listportforwardingrulesresponse.portforwardingrule||[],e.totalCount=t.listportforwardingrulesresponse.count||0})).catch((function(t){e.$notifyError(t)})).finally((function(){e.loading=!1}))},deleteRule:function(e){var t=this;this.loading=!0,Object(l["a"])("deletePortForwardingRule",{id:e.id}).then((function(e){t.$pollJob({jobId:e.deleteportforwardingruleresponse.jobid,successMessage:t.$t("message.success.remove.port.forward"),successMethod:function(){return t.fetchData()},errorMessage:t.$t("message.remove.port.forward.failed"),errorMethod:function(){return t.fetchData()},loadingMessage:t.$t("message.delete.port.forward.processing"),catchMessage:t.$t("error.fetching.async.job.result"),catchMethod:function(){return t.fetchData()}})})).catch((function(e){t.$notifyError(e),t.fetchData()}))},addRule:function(){var e=this;this.loading=!0,this.addVmModalVisible=!1;var t="vpcid"in this.resource&&!("associatednetworkid"in this.resource)?this.selectedTier:this.resource.associatednetworkid;Object(l["a"])("createPortForwardingRule",Object(o["a"])(Object(o["a"])({},this.newRule),{},{ipaddressid:this.resource.id,networkid:t})).then((function(t){e.$pollJob({jobId:t.createportforwardingruleresponse.jobid,successMessage:e.$t("message.success.add.port.forward"),successMethod:function(){e.closeModal(),e.parentFetchData(),e.fetchData()},errorMessage:e.$t("message.add.port.forward.failed"),errorMethod:function(){e.closeModal(),e.parentFetchData(),e.fetchData()},loadingMessage:e.$t("message.add.port.forward.processing"),catchMessage:e.$t("error.fetching.async.job.result"),catchMethod:function(){e.closeModal(),e.fetchData()}})})).catch((function(t){e.$notifyError(t),e.fetchData()}))},resetAllRules:function(){this.newRule.protocol="tcp",this.newRule.privateport=null,this.newRule.privateendport=null,this.newRule.publicport=null,this.newRule.publicendport=null,this.newRule.openfirewall=!1,this.newRule.vmguestip=null,this.newRule.virtualmachineid=null},resetTagInputs:function(){this.newTag.key=null,this.newTag.value=null},closeModal:function(){this.selectedRule=null,this.tagsModalVisible=!1,this.addVmModalVisible=!1,this.newRule.virtualmachineid=null,this.addVmModalLoading=!1,this.addVmModalNicLoading=!1,this.nics=[],this.resetTagInputs(),this.resetAllRules()},openTagsModal:function(e){var t=this;this.tagsModalLoading=!0,this.selectedRule=e,this.tagsModalVisible=!0,this.tags=[],this.resetTagInputs(),Object(l["a"])("listTags",{resourceId:e,resourceType:"PortForwardingRule",listAll:!0}).then((function(e){t.tags=e.listtagsresponse.tag,t.tagsModalLoading=!1})).catch((function(e){t.$notifyError(e),t.closeModal()}))},handleAddTag:function(){var e=this;this.tagsModalLoading=!0,Object(l["a"])("createTags",{"tags[0].key":this.newTag.key,"tags[0].value":this.newTag.value,resourceIds:this.selectedRule,resourceType:"PortForwardingRule"}).then((function(t){e.$pollJob({jobId:t.createtagsresponse.jobid,successMessage:e.$t("message.success.add.tag"),successMethod:function(){e.parentFetchData(),e.parentToggleLoading(),e.openTagsModal(e.selectedRule)},errorMessage:e.$t("message.add.tag.failed"),errorMethod:function(){e.parentFetchData(),e.parentToggleLoading(),e.closeModal()},loadingMessage:e.$t("message.add.tag.processing"),catchMessage:e.$t("error.fetching.async.job.result"),catchMethod:function(){e.parentFetchData(),e.parentToggleLoading(),e.closeModal()}})})).catch((function(t){e.$notifyError(t)}))},handleDeleteTag:function(e){var t=this;this.tagsModalLoading=!0,Object(l["a"])("deleteTags",{"tags[0].key":e.key,"tags[0].value":e.value,resourceIds:this.selectedRule,resourceType:"PortForwardingRule"}).then((function(e){t.$pollJob({jobId:e.deletetagsresponse.jobid,successMessage:t.$t("message.success.delete.tag"),successMethod:function(){t.parentFetchData(),t.parentToggleLoading(),t.openTagsModal(t.selectedRule)},errorMessage:t.$t("message.delete.tag.failed"),errorMethod:function(){t.parentFetchData(),t.parentToggleLoading(),t.closeModal()},loadingMessage:t.$t("message.delete.tag.processing"),catchMessage:t.$t("error.fetching.async.job.result"),catchMethod:function(){t.parentFetchData(),t.parentToggleLoading(),t.closeModal()}})})).catch((function(e){t.$notifyError(e)}))},openAddVMModal:function(){this.addVmModalVisible=!0,this.fetchVirtualMachines()},fetchNics:function(e){var t=this;this.addVmModalNicLoading=!0,this.newRule.virtualmachineid=e.target.value,Object(l["a"])("listNics",{virtualmachineid:e.target.value,networkId:"vpcid"in this.resource&&!("associatednetworkid"in this.resource)?this.selectedTier:this.resource.associatednetworkid}).then((function(e){if(e.listnicsresponse.nic&&!(e.listnicsresponse.nic.length<1)){var a,s=e.listnicsresponse.nic[0];if(t.nics.push(s.ipaddress),s.secondaryip&&s.secondaryip.length>0)(a=t.nics).push.apply(a,Object(n["a"])(s.secondaryip.map((function(e){return e.ipaddress}))));t.newRule.vmguestip=t.nics[0],t.addVmModalNicLoading=!1}})).catch((function(e){console.log(e),t.$notifyError(e),t.closeModal()}))},fetchVirtualMachines:function(){var e=this;this.vmCount=0,this.vms=[],this.addVmModalLoading=!0;var t="vpcid"in this.resource&&!("associatednetworkid"in this.resource)?this.selectedTier:this.resource.associatednetworkid;Object(l["a"])("listVirtualMachines",{listAll:!0,keyword:this.searchQuery,page:this.vmPage,pagesize:this.vmPageSize,networkid:t,account:this.resource.account,domainid:this.resource.domainid}).then((function(t){e.vmCount=t.listvirtualmachinesresponse.count||0,e.vms=t.listvirtualmachinesresponse.virtualmachine,e.addVmModalLoading=!1})).catch((function(t){e.$notifyError(t)}))},handleChangePage:function(e,t){this.page=e,this.pageSize=t,this.fetchData()},handleChangePageSize:function(e,t){this.page=e,this.pageSize=t,this.fetchData()},onSearch:function(e){this.searchQuery=e,this.fetchVirtualMachines()}}},u=d,p=(a("0c73"),a("2877")),h=Object(p["a"])(u,s,i,!1,null,"40544cb9",null);t["default"]=h.exports}}]);
//# sourceMappingURL=chunk-04c0a420.ab9640c9.js.map