(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b0bd0d6e"],{4014:function(e,t,o){"use strict";var a=o("d99f"),n=o.n(a);n.a},"918c":function(e,t,o){"use strict";o.r(t);var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("a-table",{staticStyle:{"overflow-y":"auto"},attrs:{size:"small",loading:e.loading||e.fetchLoading,columns:e.columns,dataSource:e.dataSource,pagination:!1,rowKey:function(e){return e.zoneid}},scopedSlots:e._u([{key:"isready",fn:function(t,a){return o("div",{},[a.isready?o("span",[e._v(e._s(e.$t("label.yes")))]):o("span",[e._v(e._s(e.$t("label.no")))])])}},{key:"action",fn:function(t,a){return[o("span",{staticStyle:{"margin-right":"5px"}},[o("a-button",{attrs:{disabled:!("copyTemplate"in e.$store.getters.apis&&a.isready),icon:"copy",shape:"circle",loading:e.copyLoading},on:{click:function(t){return e.showCopyTemplate(a)}}})],1),o("span",{staticStyle:{"margin-right":"5px"}},[o("a-button",{attrs:{disabled:!("deleteTemplate"in e.$store.getters.apis),type:"danger",icon:"delete",shape:"circle"},on:{click:function(t){return e.onShowDeleteModal(a)}}})],1)]}}])}),o("a-pagination",{staticClass:"row-element",attrs:{size:"small",current:e.page,pageSize:e.pageSize,total:e.itemCount,showTotal:function(t){return e.$t("label.total")+" "+t+" "+e.$t("label.items")},pageSizeOptions:["10","20","40","80","100"],showSizeChanger:""},on:{change:e.handleChangePage,showSizeChange:e.handleChangePageSize},scopedSlots:e._u([{key:"buildOptionText",fn:function(t){return[o("span",[e._v(e._s(t.value)+" / "+e._s(e.$t("label.page")))])]}}])}),"copyTemplate"in e.$store.getters.apis?o("a-modal",{staticStyle:{top:"20px"},attrs:{title:e.$t("label.action.copy.template"),visible:e.showCopyActionForm,closable:!0,maskClosable:!1,okText:e.$t("label.ok"),cancelText:e.$t("label.cancel"),confirmLoading:e.copyLoading,centered:""},on:{ok:e.handleCopyTemplateSubmit,cancel:e.onCloseModal}},[o("a-spin",{attrs:{spinning:e.copyLoading}},[o("a-form",{attrs:{form:e.form,layout:"vertical"},on:{submit:e.handleCopyTemplateSubmit}},[o("a-form-item",{attrs:{label:e.$t("label.zoneid")}},[o("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["zoneid",{rules:[{required:!0,message:""+this.$t("message.error.select")}]}],expression:"['zoneid', {\n              rules: [\n                {\n                  required: true,\n                  message: `${this.$t('message.error.select')}`\n                }\n              ]\n            }]"}],attrs:{id:"zone-selection",mode:"multiple",placeholder:e.$t("label.select.zones"),showSearch:"",optionFilterProp:"children",filterOption:function(e,t){return t.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0},loading:e.zoneLoading}},e._l(e.zones,(function(t){return o("a-select-option",{key:t.id},[e._v(" "+e._s(t.name)+" ")])})),1)],1)],1)],1)],1):e._e(),o("a-modal",{attrs:{title:e.$t("label.action.delete.template"),visible:e.showDeleteTemplate,closable:!0,maskClosable:!1,okText:e.$t("label.ok"),cancelText:e.$t("label.cancel"),confirmLoading:e.deleteLoading,centered:""},on:{ok:e.deleteTemplate,cancel:e.onCloseModal}},[o("a-spin",{attrs:{spinning:e.deleteLoading}},[o("a-alert",{attrs:{message:e.$t("message.action.delete.template"),type:"warning"}}),o("a-form-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:e.$t("label.isforced")}},[o("a-switch",{model:{value:e.forcedDelete,callback:function(t){e.forcedDelete=t},expression:"forcedDelete"}})],1)],1)],1)],1)},n=[],i=(o("99af"),o("4de4"),o("4160"),o("caad"),o("c975"),o("a15b"),o("b0c0"),o("d3b7"),o("159b"),o("d0ff")),s=o("365c"),r={name:"TemplateZones",props:{resource:{type:Object,required:!0},loading:{type:Boolean,default:!1}},data:function(){return{columns:[],dataSource:[],page:1,pageSize:10,itemCount:0,fetchLoading:!1,showCopyActionForm:!1,currentRecord:{},zones:[],zoneLoading:!1,copyLoading:!1,deleteLoading:!1,showDeleteTemplate:!1,forcedDelete:!1}},beforeCreate:function(){var e=this;this.form=this.$form.createForm(this),this.apiConfigParams=this.$store.getters.apis.copyTemplate&&this.$store.getters.apis.copyTemplate.params||[],this.apiParams={},this.apiConfigParams.forEach((function(t){e.apiParams[t.name]=t}))},created:function(){this.columns=[{title:this.$t("label.zonename"),dataIndex:"zonename"},{title:this.$t("label.status"),dataIndex:"status"},{title:this.$t("label.isready"),dataIndex:"isready",scopedSlots:{customRender:"isready"}}],this.isActionPermitted()&&this.columns.push({title:"",dataIndex:"action",fixed:"right",width:100,scopedSlots:{customRender:"action"}});var e=this.$store.getters.userInfo;["Admin"].includes(e.roletype)||e.account===this.resource.account&&e.domain===this.resource.domain||(this.columns=this.columns.filter((function(e){return"status"!==e.dataIndex})))},mounted:function(){this.fetchData()},watch:{loading:function(e,t){e||this.fetchData()}},methods:{fetchData:function(){var e=this,t={};t.id=this.resource.id,t.templatefilter="executable",t.listall=!0,t.page=this.page,t.pagesize=this.pageSize,this.dataSource=[],this.itemCount=0,this.fetchLoading=!0,Object(s["a"])("listTemplates",t).then((function(t){e.dataSource=t.listtemplatesresponse.template||[],e.itemCount=t.listtemplatesresponse.count||0})).catch((function(t){e.$notifyError(t)})).finally((function(){e.fetchLoading=!1}))},handleChangePage:function(e,t){this.page=e,this.pageSize=t,this.fetchData()},handleChangePageSize:function(e,t){this.page=e,this.pageSize=t,this.fetchData()},isActionPermitted:function(){return(["Admin"].includes(this.$store.getters.userInfo.roletype)||this.resource.domainid===this.$store.getters.userInfo.domainid&&this.resource.account===this.$store.getters.userInfo.account||this.resource.domainid===this.$store.getters.userInfo.domainid&&this.resource.projectid&&this.$store.getters.project&&this.$store.getters.project.id&&this.resource.projectid===this.$store.getters.project.id)&&(this.resource.isready||!this.resource.status||-1===this.resource.status.indexOf("Downloaded"))&&"SYSTEM"!==this.resource.templatetype},deleteTemplate:function(){var e=this,t={id:this.currentRecord.id,forced:this.forcedDelete,zoneid:this.currentRecord.zoneid};this.deleteLoading=!0,Object(s["a"])("deleteTemplate",t).then((function(t){var o=t.deletetemplateresponse.jobid;e.$store.dispatch("AddAsyncJob",{title:e.$t("label.action.delete.template"),jobid:o,description:e.resource.name,status:"progress"});var a=1===e.dataSource.length;e.$pollJob({jobId:o,successMethod:function(t){if(a){var o=e.$route.params&&e.$route.params.id;o&&e.$router.go(-1)}else e.fetchData()},errorMethod:function(){return e.fetchData()},loadingMessage:"".concat(e.$t("label.deleting.template")," ").concat(e.resource.name," ").concat(e.$t("label.in.progress")),catchMessage:e.$t("error.fetching.async.job.result")}),e.onCloseModal(),e.fetchData()})).catch((function(t){e.$notifyError(t)})).finally((function(){e.deleteLoading=!1}))},fetchZoneData:function(){var e=this;this.zones=[],this.zoneLoading=!0,Object(s["a"])("listZones",{listall:!0}).then((function(t){var o=t.listzonesresponse.zone||[];e.zones=Object(i["a"])(o.filter((function(t){return e.currentRecord.zoneid!==t.id})))})).finally((function(){e.zoneLoading=!1}))},showCopyTemplate:function(e){this.currentRecord=e,this.form.setFieldsValue({zoneid:[]}),this.fetchZoneData(),this.showCopyActionForm=!0},onShowDeleteModal:function(e){this.forcedDelete=!1,this.currentRecord=e,this.showDeleteTemplate=!0},onCloseModal:function(){this.currentRecord={},this.showCopyActionForm=!1,this.showDeleteTemplate=!1},handleCopyTemplateSubmit:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,o){if(!e){var a={id:t.currentRecord.id,sourcezoneid:t.currentRecord.zoneid,destzoneids:o.zoneid.join()};t.copyLoading=!0,Object(s["a"])("copyTemplate",a).then((function(e){var o=e.copytemplateresponse.jobid;t.$store.dispatch("AddAsyncJob",{title:t.$t("label.action.copy.template"),jobid:o,description:t.resource.name,status:"progress"}),t.$pollJob({jobId:o,successMethod:function(e){t.fetchData()},errorMethod:function(){return t.fetchData()},loadingMessage:"".concat(t.$t("label.action.copy.template")," ").concat(t.resource.name," ").concat(t.$t("label.in.progress")),catchMessage:t.$t("error.fetching.async.job.result")})})).catch((function(e){t.$notification.error({message:t.$t("message.request.failed"),description:e.response&&e.response.headers&&e.response.headers["x-description"]||e.message})})).finally((function(){t.copyLoading=!1,t.$emit("refresh-data"),t.onCloseModal(),t.fetchData()}))}}))}}},c=r,l=(o("4014"),o("2877")),d=Object(l["a"])(c,a,n,!1,null,"0d6503a4",null);t["default"]=d.exports},d99f:function(e,t,o){}}]);
//# sourceMappingURL=chunk-b0bd0d6e.e2f16d78.js.map