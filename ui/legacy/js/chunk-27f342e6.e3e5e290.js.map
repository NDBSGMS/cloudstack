{"version":3,"sources":["webpack:///./src/views/storage/MigrateVolume.vue?3b27","webpack:///./src/views/storage/MigrateVolume.vue?5a2a","webpack:///src/views/storage/MigrateVolume.vue","webpack:///./src/views/storage/MigrateVolume.vue?97b9","webpack:///./src/views/storage/MigrateVolume.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","storagePools","length","_v","_s","$t","staticStyle","model","value","callback","$$v","selectedStoragePool","expression","_l","storagePool","index","key","attrs","id","name","resource","suitableformigration","_e","on","$event","replaceDiskOffering","selectedDiskOffering","diskOffering","displaytext","domProps","slot","closeModal","submitMigrateVolume","staticRenderFns","props","type","Object","required","inject","data","diskOfferings","mounted","fetchStoragePools","virtualmachineid","fetchDiskOfferings","methods","Array","isArray","zoneid","listall","$parent","close","livemigrate","vmstate","storageid","volumeid","newdiskofferingid","jobId","response","migratevolumeresponse","jobid","successMessage","successMethod","errorMessage","errorMethod","loadingMessage","catchMessage","catchMethod","component"],"mappings":"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","file":"js/chunk-27f342e6.e3e5e290.js","sourcesContent":["import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MigrateVolume.vue?vue&type=style&index=0&id=f940bea6&scoped=true&lang=scss&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MigrateVolume.vue?vue&type=style&index=0&id=f940bea6&scoped=true&lang=scss&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"migrate-volume-container\"},[_c('div',{staticClass:\"modal-form\"},[(_vm.storagePools.length > 0)?_c('div',[_c('p',{staticClass:\"modal-form__label\"},[_vm._v(_vm._s(_vm.$t('label.storagepool')))]),_c('a-select',{staticStyle:{\"width\":\"100%\"},model:{value:(_vm.selectedStoragePool),callback:function ($$v) {_vm.selectedStoragePool=$$v},expression:\"selectedStoragePool\"}},_vm._l((_vm.storagePools),function(storagePool,index){return _c('a-select-option',{key:index,attrs:{\"value\":storagePool.id}},[_vm._v(\" \"+_vm._s(storagePool.name)+\" \"),(_vm.resource.virtualmachineid)?_c('span',[_vm._v(_vm._s(storagePool.suitableformigration ? (\"(\" + (_vm.$t('label.suitable')) + \")\") : (\"(\" + (_vm.$t('label.not.suitable')) + \")\")))]):_vm._e()])}),1),(this.resource.virtualmachineid)?[_c('p',{staticClass:\"modal-form__label\",staticStyle:{\"cursor\":\"pointer\"},on:{\"click\":function($event){_vm.replaceDiskOffering = !_vm.replaceDiskOffering}}},[_vm._v(\" \"+_vm._s(_vm.$t('label.usenewdiskoffering'))+\" \")]),_c('a-checkbox',{model:{value:(_vm.replaceDiskOffering),callback:function ($$v) {_vm.replaceDiskOffering=$$v},expression:\"replaceDiskOffering\"}}),(_vm.replaceDiskOffering)?[_c('p',{staticClass:\"modal-form__label\"},[_vm._v(_vm._s(_vm.$t('label.newdiskoffering')))]),_c('a-select',{staticStyle:{\"width\":\"100%\"},model:{value:(_vm.selectedDiskOffering),callback:function ($$v) {_vm.selectedDiskOffering=$$v},expression:\"selectedDiskOffering\"}},_vm._l((_vm.diskOfferings),function(diskOffering,index){return _c('a-select-option',{key:index,attrs:{\"value\":diskOffering.id}},[_vm._v(\" \"+_vm._s(diskOffering.displaytext)+\" \")])}),1)]:_vm._e()]:_vm._e()],2):_c('a-alert',{staticStyle:{\"margin-top\":\"15px\"},attrs:{\"type\":\"warning\"}},[_c('span',{attrs:{\"slot\":\"message\"},domProps:{\"innerHTML\":_vm._s(_vm.$t('message.no.primary.stores'))},slot:\"message\"})])],1),_c('a-divider'),_c('div',{staticClass:\"actions\"},[_c('a-button',{on:{\"click\":_vm.closeModal}},[_vm._v(\" \"+_vm._s(_vm.$t('label.cancel'))+\" \")]),_c('a-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.submitMigrateVolume}},[_vm._v(\" \"+_vm._s(_vm.$t('label.ok'))+\" \")])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","// Licensed to the Apache Software Foundation (ASF) under one\n// or more contributor license agreements.  See the NOTICE file\n// distributed with this work for additional information\n// regarding copyright ownership.  The ASF licenses this file\n// to you under the Apache License, Version 2.0 (the\n// \"License\"); you may not use this file except in compliance\n// with the License.  You may obtain a copy of the License at\n//\n//   http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing,\n// software distributed under the License is distributed on an\n// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n// KIND, either express or implied.  See the License for the\n// specific language governing permissions and limitations\n// under the License.\n\n<template>\n  <div class=\"migrate-volume-container\">\n\n    <div class=\"modal-form\">\n      <div v-if=\"storagePools.length > 0\">\n        <p class=\"modal-form__label\">{{ $t('label.storagepool') }}</p>\n        <a-select v-model=\"selectedStoragePool\" style=\"width: 100%;\">\n          <a-select-option v-for=\"(storagePool, index) in storagePools\" :value=\"storagePool.id\" :key=\"index\">\n            {{ storagePool.name }} <span v-if=\"resource.virtualmachineid\">{{ storagePool.suitableformigration ? `(${$t('label.suitable')})` : `(${$t('label.not.suitable')})` }}</span>\n          </a-select-option>\n        </a-select>\n        <template v-if=\"this.resource.virtualmachineid\">\n          <p class=\"modal-form__label\" @click=\"replaceDiskOffering = !replaceDiskOffering\" style=\"cursor:pointer;\">\n            {{ $t('label.usenewdiskoffering') }}\n          </p>\n          <a-checkbox v-model=\"replaceDiskOffering\" />\n\n          <template v-if=\"replaceDiskOffering\">\n            <p class=\"modal-form__label\">{{ $t('label.newdiskoffering') }}</p>\n            <a-select v-model=\"selectedDiskOffering\" style=\"width: 100%;\">\n              <a-select-option v-for=\"(diskOffering, index) in diskOfferings\" :value=\"diskOffering.id\" :key=\"index\">\n                {{ diskOffering.displaytext }}\n              </a-select-option>\n            </a-select>\n          </template>\n        </template>\n      </div>\n      <a-alert style=\"margin-top: 15px\" type=\"warning\" v-else>\n        <span slot=\"message\" v-html=\"$t('message.no.primary.stores')\" />\n      </a-alert>\n    </div>\n\n    <a-divider />\n\n    <div class=\"actions\">\n      <a-button @click=\"closeModal\">\n        {{ $t('label.cancel') }}\n      </a-button>\n      <a-button type=\"primary\" @click=\"submitMigrateVolume\">\n        {{ $t('label.ok') }}\n      </a-button>\n    </div>\n\n  </div>\n</template>\n\n<script>\nimport { api } from '@/api'\n\nexport default {\n  name: 'MigrateVolume',\n  props: {\n    resource: {\n      type: Object,\n      required: true\n    }\n  },\n  inject: ['parentFetchData'],\n  data () {\n    return {\n      storagePools: [],\n      selectedStoragePool: null,\n      diskOfferings: [],\n      replaceDiskOffering: false,\n      selectedDiskOffering: null\n    }\n  },\n  mounted () {\n    this.fetchStoragePools()\n    this.resource.virtualmachineid && this.fetchDiskOfferings()\n  },\n  methods: {\n    fetchStoragePools () {\n      if (this.resource.virtualmachineid) {\n        api('findStoragePoolsForMigration', {\n          id: this.resource.id\n        }).then(response => {\n          this.storagePools = response.findstoragepoolsformigrationresponse.storagepool || []\n          if (Array.isArray(this.storagePools) && this.storagePools.length) {\n            this.selectedStoragePool = this.storagePools[0].id || ''\n          }\n        }).catch(error => {\n          this.$notifyError(error)\n          this.closeModal()\n        })\n      } else {\n        api('listStoragePools', {\n          zoneid: this.resource.zoneid\n        }).then(response => {\n          this.storagePools = response.liststoragepoolsresponse.storagepool || []\n          this.storagePools = this.storagePools.filter(pool => { return pool.id !== this.resource.storageid })\n          if (Array.isArray(this.storagePools) && this.storagePools.length) {\n            this.selectedStoragePool = this.storagePools[0].id || ''\n          }\n        }).catch(error => {\n          this.$notifyError(error)\n          this.closeModal()\n        })\n      }\n    },\n    fetchDiskOfferings () {\n      api('listDiskOfferings', {\n        listall: true\n      }).then(response => {\n        this.diskOfferings = response.listdiskofferingsresponse.diskoffering\n        this.selectedDiskOffering = this.diskOfferings[0].id\n      }).catch(error => {\n        this.$notifyError(error)\n        this.closeModal()\n      })\n    },\n    closeModal () {\n      this.$parent.$parent.close()\n    },\n    submitMigrateVolume () {\n      if (this.storagePools.length === 0) {\n        this.closeModal()\n        return\n      }\n      api('migrateVolume', {\n        livemigrate: this.resource.vmstate === 'Running',\n        storageid: this.selectedStoragePool,\n        volumeid: this.resource.id,\n        newdiskofferingid: this.replaceDiskOffering ? this.selectedDiskOffering : null\n      }).then(response => {\n        this.$pollJob({\n          jobId: response.migratevolumeresponse.jobid,\n          successMessage: this.$t('message.success.migrate.volume'),\n          successMethod: () => {\n            this.parentFetchData()\n          },\n          errorMessage: this.$t('message.migrate.volume.failed'),\n          errorMethod: () => {\n            this.parentFetchData()\n          },\n          loadingMessage: this.$t('message.migrate.volume.processing'),\n          catchMessage: this.$t('error.fetching.async.job.result'),\n          catchMethod: () => {\n            this.parentFetchData()\n          }\n        })\n        this.closeModal()\n        this.parentFetchData()\n      }).catch(error => {\n        this.$notifyError(error)\n      })\n    }\n  }\n}\n</script>\n\n<style scoped lang=\"scss\">\n  .migrate-volume-container {\n    width: 95vw;\n    max-width: 100%;\n\n    @media (min-width: 760px) {\n      width: 50vw;\n    }\n  }\n\n  .actions {\n    display: flex;\n    justify-content: flex-end;\n    margin-top: 20px;\n\n    button {\n      &:not(:last-child) {\n        margin-right: 10px;\n      }\n    }\n  }\n\n  .modal-form {\n    margin-top: -20px;\n\n    &__label {\n      margin-top: 10px;\n      margin-bottom: 5px;\n    }\n\n  }\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MigrateVolume.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MigrateVolume.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./MigrateVolume.vue?vue&type=template&id=f940bea6&scoped=true&\"\nimport script from \"./MigrateVolume.vue?vue&type=script&lang=js&\"\nexport * from \"./MigrateVolume.vue?vue&type=script&lang=js&\"\nimport style0 from \"./MigrateVolume.vue?vue&type=style&index=0&id=f940bea6&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f940bea6\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}