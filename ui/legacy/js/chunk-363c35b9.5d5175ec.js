(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-363c35b9"],{"5cc3":function(e,t,l){"use strict";var i=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("a-select",{attrs:{value:e.defaultValue},on:{change:e.handleChange}},[l("a-select-option",{attrs:{value:"allow"}},[e._v(e._s(e.$t("label.allow")))]),l("a-select-option",{attrs:{value:"deny"}},[e._v(e._s(e.$t("label.deny")))])],1)},s=[],n={props:{defaultValue:{type:String,required:!0}},methods:{handleChange:function(e){this.$emit("change",e)}}},a=n,r=l("2877"),o=Object(r["a"])(a,i,s,!1,null,null,null);t["a"]=o.exports},"64ee":function(e,t,l){},"691e":function(e,t,l){"use strict";l.r(t);var i=function(){var e=this,t=e.$createElement,l=e._self._c||t;return e.loadingTable?l("a-icon",{staticClass:"main-loading-spinner",attrs:{type:"loading"}}):l("div",[l("div",{staticStyle:{width:"100%",display:"flex","margin-bottom":"10px"}},[l("a-button",{staticStyle:{width:"100%"},attrs:{type:"dashed",icon:"download"},on:{click:e.exportRolePermissions}},[e._v(" Export Rules ")])],1),e.updateTable?l("div",{staticClass:"loading-overlay"},[l("a-icon",{attrs:{type:"loading"}})],1):e._e(),l("div",{staticClass:"rules-list ant-list ant-list-bordered",class:{"rules-list--overflow-hidden":e.updateTable}},[l("div",{staticClass:"rules-table-item ant-list-item"},[l("div",{staticClass:"rules-table__col rules-table__col--grab"}),l("div",{staticClass:"rules-table__col rules-table__col--rule rules-table__col--new"},[l("a-auto-complete",{class:{"rule-dropdown-error":e.newRuleSelectError},attrs:{autoFocus:!0,filterOption:e.filterOption,dataSource:e.apis,value:e.newRule,placeholder:e.$t("label.rule")},on:{change:function(t){return e.newRule=t}}})],1),l("div",{staticClass:"rules-table__col rules-table__col--permission"},[l("permission-editable",{attrs:{defaultValue:e.newRulePermission},on:{change:function(t){return e.onPermissionChange(null,t)}}})],1),l("div",{staticClass:"rules-table__col rules-table__col--description"},[l("a-input",{attrs:{placeholder:e.$t("label.description")},model:{value:e.newRuleDescription,callback:function(t){e.newRuleDescription=t},expression:"newRuleDescription"}})],1),l("div",{staticClass:"rules-table__col rules-table__col--actions"},[l("a-tooltip",{attrs:{placement:"bottom"}},[l("template",{slot:"title"},[e._v(" "+e._s(e.$t("label.save.new.rule"))+" ")]),l("a-button",{attrs:{disabled:!("createRolePermission"in e.$store.getters.apis),icon:"plus",type:"primary",shape:"circle"},on:{click:e.onRuleSave}})],2)],1)]),l("draggable",{attrs:{disabled:!("updateRolePermission"in this.$store.getters.apis),handle:".drag-handle",animation:"200",ghostClass:"drag-ghost"},on:{change:e.changeOrder},model:{value:e.rules,callback:function(t){e.rules=t},expression:"rules"}},[l("transition-group",{attrs:{type:"transition"}},e._l(e.rules,(function(t,i){return l("div",{key:"item-"+i,staticClass:"rules-table-item ant-list-item"},[l("div",{staticClass:"rules-table__col rules-table__col--grab drag-handle"},[l("a-icon",{attrs:{type:"drag"}})],1),l("div",{staticClass:"rules-table__col rules-table__col--rule"},[e._v(" "+e._s(t.rule)+" ")]),l("div",{staticClass:"rules-table__col rules-table__col--permission"},[l("permission-editable",{attrs:{defaultValue:t.permission},on:{change:function(l){return e.onPermissionChange(t,l)}}})],1),l("div",{staticClass:"rules-table__col rules-table__col--description"},[t.description?[e._v(" "+e._s(t.description)+" ")]:l("div",{staticClass:"no-description"},[e._v(" "+e._s(e.$t("message.no.description"))+" ")])],2),l("div",{staticClass:"rules-table__col rules-table__col--actions"},[l("rule-delete",{attrs:{disabled:!("deleteRolePermission"in e.$store.getters.apis),record:t},on:{delete:function(l){return e.onRuleDelete(t.id)}}})],1)])})),0)],1)],1)])},s=[],n=(l("4160"),l("caad"),l("c975"),l("a15b"),l("d81d"),l("fb6a"),l("b0c0"),l("b64b"),l("d3b7"),l("2532"),l("159b"),l("365c")),a=l("310e"),r=l.n(a),o=l("5cc3"),c=l("8c1f"),u={name:"RolePermissionTab",components:{RuleDelete:c["a"],PermissionEditable:o["a"],draggable:r.a},props:{resource:{type:Object,required:!0}},data:function(){return{loadingTable:!0,updateTable:!1,rules:null,newRule:"",newRulePermission:"allow",newRuleDescription:"",newRuleSelectError:!1,drag:!1,apis:[]}},mounted:function(){this.apis=Object.keys(this.$store.getters.apis).sort((function(e,t){return e.localeCompare(t)})),this.fetchData()},watch:{resource:function(){var e=this;this.fetchData((function(){e.resetNewFields()}))}},methods:{filterOption:function(e,t){return t.componentOptions.children[0].text.toUpperCase().indexOf(e.toUpperCase())>=0},resetNewFields:function(){this.newRule="",this.newRulePermission="allow",this.newRuleDescription="",this.newRuleSelectError=!1},fetchData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.resource.id&&Object(n["a"])("listRolePermissions",{roleid:this.resource.id}).then((function(t){e.rules=t.listrolepermissionsresponse.rolepermission})).catch((function(t){e.$notifyError(t)})).finally((function(){e.loadingTable=!1,e.updateTable=!1,t&&t()}))},changeOrder:function(){var e=this;Object(n["a"])("updateRolePermission",{},"POST",{roleid:this.resource.id,ruleorder:this.rules.map((function(e){return e.id}))}).catch((function(t){e.$notifyError(t)})).finally((function(){e.fetchData()}))},onRuleDelete:function(e){var t=this;this.updateTable=!0,Object(n["a"])("deleteRolePermission",{id:e}).catch((function(e){t.$notifyError(e)})).finally((function(){t.fetchData()}))},onPermissionChange:function(e,t){var l=this;this.newRulePermission=t,e&&(this.updateTable=!0,Object(n["a"])("updateRolePermission",{roleid:this.resource.id,ruleid:e.id,permission:t}).then((function(){l.fetchData()})).catch((function(e){l.$notifyError(e)})))},onRuleSelect:function(e){this.newRule=e},onRuleSave:function(){var e=this;this.newRule?(this.updateTable=!0,Object(n["a"])("createRolePermission",{rule:this.newRule,permission:this.newRulePermission,description:this.newRuleDescription,roleid:this.resource.id}).then((function(){})).catch((function(t){e.$notifyError(t)})).finally((function(){e.resetNewFields(),e.fetchData()}))):this.newRuleSelectError=!0},rulesDataToCsv:function(e){var t=e.data,l=void 0===t?null:t,i=e.columnDelimiter,s=void 0===i?",":i,n=e.lineDelimiter,a=void 0===n?"\n":n;if(null===l||!l.length)return null;var r=["rule","permission","description"],o="";return o+=r.join(s),o+=a,l.forEach((function(e){r.forEach((function(t){void 0===e[t]&&(e[t]=""),o+="string"===typeof e[t]&&e[t].includes(s)?'"'.concat(e[t],'"'):e[t],o+=s})),o=o.slice(0,-1),o+=a})),o},exportRolePermissions:function(){var e=this.rulesDataToCsv({data:this.rules}),t=document.createElement("a");t.href="data:text/csv;charset=utf-8,"+encodeURI(e),t.target="_blank",t.download=this.resource.name+"_"+this.resource.type+".csv",t.click(),t.delete()}}},d=u,p=(l("b71a"),l("7214"),l("2877")),h=Object(p["a"])(d,i,s,!1,null,"7650c927",null);t["default"]=h.exports},7214:function(e,t,l){"use strict";var i=l("c0d8"),s=l.n(i);s.a},"8c1f":function(e,t,l){"use strict";var i=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("a-tooltip",{attrs:{placement:"bottom"}},[l("template",{slot:"title"},[e._v(" "+e._s(e.$t("label.delete.rule"))+" ")]),l("a-popconfirm",{attrs:{title:e.$t("label.delete.rule")+"?",disabled:e.disabled},on:{confirm:e.handleDelete}},[l("a-button",{attrs:{type:"danger",shape:"circle",disabled:e.disabled}},[l("a-icon",{attrs:{type:"delete"}})],1)],1)],2)},s=[],n={name:"RuleDelete",props:{record:{type:Object,required:!0},disabled:{type:Boolean,default:!1}},methods:{handleDelete:function(){this.$emit("delete")}}},a=n,r=(l("c466"),l("2877")),o=Object(r["a"])(a,i,s,!1,null,"c2a6d786",null);t["a"]=o.exports},b71a:function(e,t,l){"use strict";var i=l("64ee"),s=l.n(i);s.a},c0d8:function(e,t,l){},c466:function(e,t,l){"use strict";var i=l("db3a"),s=l.n(i);s.a},db3a:function(e,t,l){}}]);
//# sourceMappingURL=chunk-363c35b9.5d5175ec.js.map