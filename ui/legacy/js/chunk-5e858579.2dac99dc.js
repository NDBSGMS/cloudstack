(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5e858579"],{"790a":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"form-layout"},[a("a-spin",{attrs:{spinning:e.loading}},[a("a-form",{attrs:{form:e.form,layout:"vertical"},on:{submit:e.handleSubmit}},[a("a-form-item",{attrs:{label:e.$t("migrate.from")}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["srcpool",{initialValue:e.selectedStore,rules:[{required:!0,message:e.$t("message.error.select")}]}],expression:"['srcpool', {\n            initialValue: selectedStore,\n            rules: [\n              {\n                required: true,\n                message: $t('message.error.select'),\n              }]\n          }]"}],attrs:{loading:e.loading},on:{change:function(t){e.selectedStore=t}}},e._l(e.imageStores,(function(t){return a("a-select-option",{key:t.id},[e._v(e._s(t.name||e.opt.url))])})),1)],1),a("a-form-item",{attrs:{label:e.$t("migrate.to")}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["destpools",{rules:[{required:!0,message:e.$t("message.select.destination.image.stores")}]}],expression:"['destpools', {\n            rules: [\n              {\n                required: true,\n                message: $t('message.select.destination.image.stores'),\n              }]\n          }]"}],attrs:{mode:"multiple",loading:e.loading}},e._l(e.imageStores,(function(t){return t.id!==e.selectedStore?a("a-select-option",{key:t.id},[e._v(e._s(t.name||e.opt.url))]):e._e()})),1)],1),a("a-form-item",{attrs:{label:e.$t("migrationPolicy")}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["migrationtype",{initialValue:"Complete",rules:[{required:!0,message:e.$t("message.select.migration.policy")}]}],expression:"['migrationtype', {\n            initialValue: 'Complete',\n            rules: [\n              {\n                required: true,\n                message: $t('message.select.migration.policy'),\n              }]\n          }]"}],attrs:{loading:e.loading}},[a("a-select-option",{attrs:{value:"Complete"}},[e._v(e._s(e.$t("label.complete")))]),a("a-select-option",{attrs:{value:"Balance"}},[e._v(e._s(e.$t("label.balance")))])],1)],1),a("div",{staticClass:"action-button",attrs:{span:24}},[a("a-button",{on:{click:e.closeAction}},[e._v(e._s(this.$t("label.cancel")))]),a("a-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.handleSubmit}},[e._v(e._s(this.$t("label.ok")))])],1)],1)],1)],1)},n=[],o=(a("a15b"),a("d3b7"),a("96cf"),a("c964")),s=a("365c"),i={name:"MigrateData",inject:["parentFetchData"],data:function(){return{imageStores:[],loading:!1,selectedStore:""}},beforeCreate:function(){this.form=this.$form.createForm(this)},mounted:function(){this.fetchImageStores()},methods:{fetchImageStores:function(){var e=this;this.loading=!0,Object(s["a"])("listImageStores").then((function(t){e.imageStores=t.listimagestoresresponse.imagestore||[],e.selectedStore=e.imageStores[0].id||""})).finally((function(){e.loading=!1}))},handleSubmit:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,a){if(!e){var r={};for(var n in a){var o=a[n];void 0!==o&&(r[n]="destpools"===n?o.join(","):o)}var s=t.$t("message.data.migration");t.loading=!0;var i=t.migrateData(r,s);i.then((function(e){var a=e.jobresult,r=a.imagestore.success||!1,n=a.imagestore.message||"";r?t.$notification.success({message:s,description:n}):t.$notification.error({message:s,description:n,duration:0}),t.parentFetchData(),t.closeAction()})).catch((function(e){console.log(e)})),setTimeout((function(){t.$message.loading({content:t.$t("label.migrating.data"),duration:1}),t.loading=!1,t.closeAction()}),200)}}))},migrateData:function(e,t){var a=this;return new Promise((function(r,n){Object(s["a"])("migrateSecondaryStorageData",e).then(function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(o){var s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(s=o.migratesecondarystoragedataresponse.jobid,!s){e.next=10;break}return a.$store.dispatch("AddAsyncJob",{title:t,jobid:s,description:a.$t("message.data.migration.progress"),status:"progress",silent:!0}),e.next=5,a.pollJob(s,t);case 5:if(i=e.sent,2!==i.jobstatus){e.next=9;break}return n(i.jobresult.errortext),e.abrupt("return");case 9:r(i);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){n(e)}))}))},pollJob:function(e,t){return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var a=setInterval((function(){Object(s["a"])("queryAsyncJobResult",{jobId:e}).then(function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(r){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=r.queryasyncjobresultresponse,0!==n.jobstatus){e.next=3;break}return e.abrupt("return");case 3:clearInterval(a),t(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),1e3)})));case 1:case"end":return t.stop()}}),t)})))()},closeAction:function(){this.$emit("close-action")}}},c=i,l=(a("ca3d"),a("2877")),u=Object(l["a"])(c,r,n,!1,null,"8f005a9c",null);t["default"]=u.exports},ca3d:function(e,t,a){"use strict";var r=a("e5bd"),n=a.n(r);n.a},e5bd:function(e,t,a){}}]);
//# sourceMappingURL=chunk-5e858579.2dac99dc.js.map