(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-66740c6c"],{7063:function(e,a,i){},a111:function(e,a,i){"use strict";var t=i("7063"),n=i.n(t);n.a},e5d7:function(e,a,i){"use strict";i.r(a);var t=function(){var e=this,a=this,i=a.$createElement,t=a._self._c||i;return t("div",{staticClass:"form-layout"},[a.isSubmitted?a._e():t("a-spin",{attrs:{spinning:a.loading}},[t("p",{domProps:{innerHTML:a._s(a.$t("message.desc.create.ssh.key.pair"))}}),t("a-form",{attrs:{form:a.form,layout:"vertical"},on:{submit:a.handleSubmit}},[t("a-form-item",{attrs:{label:a.$t("label.name")}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:a.$t("message.error.name")}]}],expression:"['name', {\n            rules: [{ required: true, message: $t('message.error.name') }]\n          }]"}],attrs:{placeholder:a.apiParams.name.description}})],1),t("a-form-item",{attrs:{label:a.$t("label.publickey")}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["publickey",{}],expression:"['publickey', {}]"}],attrs:{placeholder:a.apiParams.publickey.description}})],1),this.isAdminOrDomainAdmin()?t("a-form-item",{attrs:{label:a.$t("label.domainid")}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["domainid",{}],expression:"['domainid', {}]"}],attrs:{id:"domain-selection",showSearch:"",optionFilterProp:"children",filterOption:function(e,a){return a.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0},loading:a.domainLoading,placeholder:a.apiParams.domainid.description},on:{change:function(a){e.handleDomainChanged(e.domains[a])}}},a._l(this.domains,(function(e,i){return t("a-select-option",{key:i},[a._v(" "+a._s(e.name||e.description)+" ")])})),1)],1):a._e(),this.isAdminOrDomainAdmin()&&!this.isObjectEmpty(this.selectedDomain)&&null!==this.selectedDomain.id?t("a-form-item",{attrs:{label:a.$t("label.account")}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["account",{}],expression:"['account', {}]"}],attrs:{placeholder:a.apiParams.account.description}})],1):a._e(),t("div",{staticClass:"action-button",attrs:{span:24}},[t("a-button",{on:{click:a.closeAction}},[a._v(a._s(this.$t("label.cancel")))]),t("a-button",{attrs:{loading:a.loading,type:"primary"},on:{click:a.handleSubmit}},[a._v(a._s(this.$t("label.ok")))])],1)],1)],1),a.isSubmitted?t("div",[t("p",{domProps:{innerHTML:a._s(a.$t("message.desc.created.ssh.key.pair"))}}),t("div",{staticClass:"action-button",attrs:{span:24}},[t("a-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:a.hiddenElement.innerHTML,expression:"hiddenElement.innerHTML",arg:"copy"}],attrs:{type:"primary"},on:{click:a.notifyCopied}},[a._v(a._s(a.$t("label.copy.clipboard")))]),t("a-button",{attrs:{type:"primary"},on:{click:a.downloadKey}},[a._v(a._s(this.$t("label.download")))]),t("a-button",{on:{click:a.closeAction}},[a._v(a._s(this.$t("label.close")))])],1)]):a._e()],1)},n=[],s=(i("99af"),i("4160"),i("caad"),i("b0c0"),i("b64b"),i("d3b7"),i("159b"),i("365c")),o={name:"CreateSSHKeyPair",props:{},data:function(){return{domains:[],domainLoading:!1,selectedDomain:{},loading:!1,isSubmitted:!1,hiddenElement:null}},beforeCreate:function(){var e=this;this.form=this.$form.createForm(this),this.apiConfig=this.$store.getters.apis.createSSHKeyPair||{},this.apiParams={},this.apiConfig.params.forEach((function(a){e.apiParams[a.name]=a})),this.apiConfig=this.$store.getters.apis.registerSSHKeyPair||{},this.apiConfig.params.forEach((function(a){a.name in e.apiParams||(e.apiParams[a.name]=a)}))},created:function(){this.domains=[{id:null,name:""}]},mounted:function(){this.fetchData()},methods:{fetchData:function(){this.isAdminOrDomainAdmin()&&this.fetchDomainData()},isAdminOrDomainAdmin:function(){return["Admin","DomainAdmin"].includes(this.$store.getters.userInfo.roletype)},isValidValueForKey:function(e,a){return a in e&&null!=e[a]},arrayHasItems:function(e){return null!==e&&void 0!==e&&Array.isArray(e)&&e.length>0},isObjectEmpty:function(e){return!(null!==e&&void 0!==e&&Object.keys(e).length>0&&e.constructor===Object)},fetchDomainData:function(){var e=this,a={};this.domainLoading=!0,Object(s["a"])("listDomains",a).then((function(a){var i=a.listdomainsresponse.domain;e.domains=e.domains.concat(i)})).finally((function(){e.domainLoading=!1,e.arrayHasItems(e.domains)&&(e.form.setFieldsValue({domainid:0}),e.handleDomainChanged(e.domains[0]))}))},handleDomainChanged:function(e){this.selectedDomain=e},handleSubmit:function(e){var a=this;e.preventDefault(),this.form.validateFields((function(e,i){if(!e){a.loading=!0;var t={name:i.name};a.isValidValueForKey(i,"domainid")&&a.arrayHasItems(a.domains)&&null!==a.domains[i.domainid].id&&(t.domainid=a.domains[i.domainid].id),a.isValidValueForKey(i,"account")&&i.account.length>0&&(t.account=i.account),a.isValidValueForKey(i,"publickey")&&i.publickey.length>0?(t.publickey=i.publickey,Object(s["a"])("registerSSHKeyPair",t).then((function(e){a.$message.success(a.$t("message.success.register.keypair")+" "+i.name)})).catch((function(e){a.$notifyError(e)})).finally((function(){a.$emit("refresh-data"),a.loading=!1,a.closeAction()}))):Object(s["a"])("createSSHKeyPair",t).then((function(e){if(a.$message.success(a.$t("message.success.create.keypair")+" "+i.name),e.createsshkeypairresponse&&e.createsshkeypairresponse.keypair&&e.createsshkeypairresponse.keypair.privatekey){a.isSubmitted=!0;var t=e.createsshkeypairresponse.keypair.privatekey;a.hiddenElement=document.createElement("a"),a.hiddenElement.href="data:text/plain;charset=utf-8,"+encodeURI(t),a.hiddenElement.innerHTML=t,a.hiddenElement.target="_blank",a.hiddenElement.download=i.name+".key"}})).catch((function(e){a.$notifyError(e)})).finally((function(){a.$emit("refresh-data"),a.loading=!1}))}}))},downloadKey:function(){this.hiddenElement.click()},notifyCopied:function(){this.$notification.info({message:this.$t("message.success.copy.clipboard")})},closeAction:function(){this.$emit("close-action")}}},r=o,c=(i("a111"),i("2877")),d=Object(c["a"])(r,t,n,!1,null,"34f9a325",null);a["default"]=d.exports}}]);
//# sourceMappingURL=chunk-66740c6c.071f998d.js.map