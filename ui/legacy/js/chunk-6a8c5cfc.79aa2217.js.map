{"version":3,"sources":["webpack:///./src/components/view/ResourceLimitTab.vue?110c","webpack:///src/components/view/ResourceLimitTab.vue","webpack:///./src/components/view/ResourceLimitTab.vue?1e47","webpack:///./src/components/view/ResourceLimitTab.vue","webpack:///./src/components/view/ResourceLimitTab.vue?2140"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","formLoading","form","on","handleSubmit","_l","item","index","resourcetypename","key","$t","replace","directives","name","rawName","value","resourcetype","initialValue","max","expression","staticStyle","$store","getters","apis","_e","staticClass","$route","meta","resource","level","_v","_s","staticRenderFns","props","type","Object","required","loading","Boolean","default","data","dataResource","beforeCreate","$form","createForm","mounted","fetchData","watch","newData","id","methods","getParams","params","account","domainid","projectid","e","preventDefault","validateFields","err","undefined","input","arrAsync","push","Promise","all","then","listResourceLimits","json","listresourcelimitsresponse","resourcelimit","sort","resolve","reject","error","response","headers","updateResourceLimit","component"],"mappings":"8IAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,SAAS,CAACE,MAAM,CAAC,SAAWN,EAAIO,cAAc,CAACH,EAAG,SAAS,CAACE,MAAM,CAAC,KAAON,EAAIQ,KAAK,OAAS,YAAYC,GAAG,CAAC,OAAST,EAAIU,eAAe,CAACV,EAAIW,GAAIX,EAAgB,cAAE,SAASY,EAAKC,GAAO,MAAkC,YAA1BD,EAAKE,iBAAgCV,EAAG,cAAc,CAACW,IAAIF,EAAMP,MAAM,CAAC,SAASM,EAAKE,iBAAiB,MAAQd,EAAIgB,GAAG,YAAcJ,EAAKE,iBAAiBG,QAAQ,IAAK,OAAO,CAACb,EAAG,iBAAiB,CAACc,WAAW,CAAC,CAACC,KAAK,YAAYC,QAAQ,cAAcC,MAAM,CAAET,EAAKU,aAAc,CAC5iBC,aAAcX,EAAKY,MACjBC,WAAW,wEAAwEC,YAAY,CAAC,MAAQ,QAAQpB,MAAM,CAAC,WAAa,wBAAyBN,EAAI2B,OAAOC,QAAQC,UAAU,GAAG7B,EAAI8B,QAAO1B,EAAG,MAAM,CAAC2B,YAAY,eAAe,CAA6B,WAAzB/B,EAAIgC,OAAOC,KAAKd,MAA4C,IAAvBnB,EAAIkC,SAASC,MAAc/B,EAAG,WAAW,CAACE,MAAM,CAAC,WAAa,wBAAyBN,EAAI2B,OAAOC,QAAQC,MAAM,QAAU7B,EAAIO,YAAY,KAAO,WAAWE,GAAG,CAAC,MAAQT,EAAIU,eAAe,CAACV,EAAIoC,GAAGpC,EAAIqC,GAAGrC,EAAIgB,GAAG,oBAAoBhB,EAAI8B,MAAM,IAAI,IAAI,IACrhBQ,EAAkB,G,4ECkDtB,GACEnB,KAAM,mBACNoB,MAAO,CACLL,SAAU,CACRM,KAAMC,OACNC,UAAU,GAEZC,QAAS,CACPH,KAAMI,QACNC,SAAS,IAGbC,KAZF,WAaI,MAAO,CACLvC,aAAa,EACbwC,aAAc,KAGlBC,aAlBF,WAmBI/C,KAAKO,KAAOP,KAAKgD,MAAMC,WAAWjD,OAEpCkD,QArBF,WAsBIlD,KAAKmD,aAEPC,MAAO,CACLnB,SADJ,SACA,KACWoB,GAAYA,EAAQC,KAGzBtD,KAAKiC,SAAWoB,EAChBrD,KAAKmD,eAGTI,QAAS,CACPC,UADJ,WAEM,IAAN,KASM,MAR8B,YAA1BxD,KAAK+B,OAAOC,KAAKd,MACnBuC,EAAOC,QAAU1D,KAAKiC,SAASf,KAC/BuC,EAAOE,SAAW3D,KAAKiC,SAAS0B,UACxC,iCACQF,EAAOE,SAAW3D,KAAKiC,SAASqB,GAEhCG,EAAOG,UAAY5D,KAAKiC,SAASqB,GAE5BG,GAET,UAbJ,WAaA,qKACA,gBADA,SAGA,iBAHA,SAIA,wBAJA,OAIA,eAJA,OAKA,iBALA,mDAOA,uBACA,uCACA,mBAEA,iBAXA,4DAcIhD,aA3BJ,SA2BA,cACMoD,EAAEC,iBAEF9D,KAAKO,KAAKwD,gBAAe,SAA/B,KACQ,IAAIC,EAAJ,CAGA,IAAR,KACA,gBACQ,IAAK,IAAb,QACU,IAAV,YAEwBC,IAAVC,IAGJT,EAAOpC,aAAeP,EACtB2C,EAAOlC,IAAM2C,EACbC,EAASC,KAAK,EAAxB,yBAGQ,EAAR,eAEQC,QAAQC,IAAIH,GAAUI,MAAK,WACzB,EAAV,gDACU,EAAV,eACA,mBACU,EAAV,mBACA,oBACU,EAAV,uBAIIC,mBA3DJ,SA2DA,GACM,OAAO,IAAIH,SAAQ,SAAzB,KACQ,IAAR,KACQ,OAAR,OAAQ,CAAR,0CACcI,EAAKC,2BAA2BC,gBAClC7B,EAAe2B,EAAKC,2BAA2BC,cAC/C7B,EAAa8B,MAAK,SAA9B,8CAEUC,EAAQ/B,MAClB,mBACUgC,EAAOC,EAAMC,SAASC,QAAQ,yBAIpCC,oBAzEJ,SAyEA,GACM,OAAO,IAAIb,SAAQ,SAAzB,KACQ,OAAR,OAAQ,CAAR,2CACUQ,OACV,mBACUC,EAAOC,YCpKwV,I,wBCQrWI,EAAY,eACd,EACArF,EACAuC,GACA,EACA,KACA,WACA,MAIa,aAAA8C,E,2CCnBf,yBAAskB,EAAG","file":"js/chunk-6a8c5cfc.79aa2217.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('a-spin',{attrs:{\"spinning\":_vm.formLoading}},[_c('a-form',{attrs:{\"form\":_vm.form,\"layout\":\"vertical\"},on:{\"submit\":_vm.handleSubmit}},[_vm._l((_vm.dataResource),function(item,index){return (item.resourcetypename !== 'project')?_c('a-form-item',{key:index,attrs:{\"v-bind\":item.resourcetypename,\"label\":_vm.$t('label.max' + item.resourcetypename.replace('_', ''))}},[_c('a-input-number',{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:([item.resourcetype, {\n          initialValue: item.max\n        }]),expression:\"[item.resourcetype, {\\n          initialValue: item.max\\n        }]\"}],staticStyle:{\"width\":\"100%\"},attrs:{\"disabled\":!('updateResourceLimit' in _vm.$store.getters.apis)}})],1):_vm._e()}),_c('div',{staticClass:\"card-footer\"},[(!(_vm.$route.meta.name === 'domain' && _vm.resource.level === 0))?_c('a-button',{attrs:{\"disabled\":!('updateResourceLimit' in _vm.$store.getters.apis),\"loading\":_vm.formLoading,\"type\":\"primary\"},on:{\"click\":_vm.handleSubmit}},[_vm._v(_vm._s(_vm.$t('label.submit')))]):_vm._e()],1)],2)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","// Licensed to the Apache Software Foundation (ASF) under one\n// or more contributor license agreements.  See the NOTICE file\n// distributed with this work for additional information\n// regarding copyright ownership.  The ASF licenses this file\n// to you under the Apache License, Version 2.0 (the\n// \"License\"); you may not use this file except in compliance\n// with the License.  You may obtain a copy of the License at\n//\n//   http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing,\n// software distributed under the License is distributed on an\n// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n// KIND, either express or implied.  See the License for the\n// specific language governing permissions and limitations\n// under the License.\n\n<template>\n  <a-spin :spinning=\"formLoading\">\n    <a-form\n      :form=\"form\"\n      @submit=\"handleSubmit\"\n      layout=\"vertical\"\n    >\n      <a-form-item\n        v-for=\"(item, index) in dataResource\"\n        :key=\"index\"\n        v-if=\"item.resourcetypename !== 'project'\"\n        :v-bind=\"item.resourcetypename\"\n        :label=\"$t('label.max' + item.resourcetypename.replace('_', ''))\">\n        <a-input-number\n          :disabled=\"!('updateResourceLimit' in $store.getters.apis)\"\n          style=\"width: 100%;\"\n          v-decorator=\"[item.resourcetype, {\n            initialValue: item.max\n          }]\"\n        />\n      </a-form-item>\n      <div class=\"card-footer\">\n        <a-button\n          :disabled=\"!('updateResourceLimit' in $store.getters.apis)\"\n          v-if=\"!($route.meta.name === 'domain' && resource.level === 0)\"\n          :loading=\"formLoading\"\n          type=\"primary\"\n          @click=\"handleSubmit\">{{ $t('label.submit') }}</a-button>\n      </div>\n    </a-form>\n  </a-spin>\n</template>\n\n<script>\nimport { api } from '@/api'\n\nexport default {\n  name: 'ResourceLimitTab',\n  props: {\n    resource: {\n      type: Object,\n      required: true\n    },\n    loading: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data () {\n    return {\n      formLoading: false,\n      dataResource: []\n    }\n  },\n  beforeCreate () {\n    this.form = this.$form.createForm(this)\n  },\n  mounted () {\n    this.fetchData()\n  },\n  watch: {\n    resource (newData, oldData) {\n      if (!newData || !newData.id) {\n        return\n      }\n      this.resource = newData\n      this.fetchData()\n    }\n  },\n  methods: {\n    getParams () {\n      const params = {}\n      if (this.$route.meta.name === 'account') {\n        params.account = this.resource.name\n        params.domainid = this.resource.domainid\n      } else if (this.$route.meta.name === 'domain') {\n        params.domainid = this.resource.id\n      } else { // project\n        params.projectid = this.resource.id\n      }\n      return params\n    },\n    async fetchData () {\n      const params = this.getParams()\n      try {\n        this.formLoading = true\n        this.dataResource = await this.listResourceLimits(params)\n        this.formLoading = false\n      } catch (e) {\n        this.$notification.error({\n          message: this.$t('message.request.failed'),\n          description: e\n        })\n        this.formLoading = false\n      }\n    },\n    handleSubmit (e) {\n      e.preventDefault()\n\n      this.form.validateFields((err, values) => {\n        if (err) {\n          return\n        }\n        const arrAsync = []\n        const params = this.getParams()\n        for (const key in values) {\n          const input = values[key]\n\n          if (input === undefined) {\n            continue\n          }\n          params.resourcetype = key\n          params.max = input\n          arrAsync.push(this.updateResourceLimit(params))\n        }\n\n        this.formLoading = true\n\n        Promise.all(arrAsync).then(() => {\n          this.$message.success(this.$t('message.apply.success'))\n          this.fetchData()\n        }).catch(error => {\n          this.$notifyError(error)\n        }).finally(() => {\n          this.formLoading = false\n        })\n      })\n    },\n    listResourceLimits (params) {\n      return new Promise((resolve, reject) => {\n        let dataResource = []\n        api('listResourceLimits', params).then(json => {\n          if (json.listresourcelimitsresponse.resourcelimit) {\n            dataResource = json.listresourcelimitsresponse.resourcelimit\n            dataResource.sort((a, b) => a.resourcetype - b.resourcetype)\n          }\n          resolve(dataResource)\n        }).catch(error => {\n          reject(error.response.headers['x-description'])\n        })\n      })\n    },\n    updateResourceLimit (params) {\n      return new Promise((resolve, reject) => {\n        api('updateResourceLimit', params).then(json => {\n          resolve()\n        }).catch(error => {\n          reject(error)\n        })\n      })\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n  .card-footer {\n    button + button {\n      margin-left: 8px;\n    }\n  }\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ResourceLimitTab.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ResourceLimitTab.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ResourceLimitTab.vue?vue&type=template&id=004f1203&scoped=true&\"\nimport script from \"./ResourceLimitTab.vue?vue&type=script&lang=js&\"\nexport * from \"./ResourceLimitTab.vue?vue&type=script&lang=js&\"\nimport style0 from \"./ResourceLimitTab.vue?vue&type=style&index=0&id=004f1203&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"004f1203\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ResourceLimitTab.vue?vue&type=style&index=0&id=004f1203&lang=less&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ResourceLimitTab.vue?vue&type=style&index=0&id=004f1203&lang=less&scoped=true&\""],"sourceRoot":""}