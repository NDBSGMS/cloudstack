(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-cc08a8f6"],{"3a5f":function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"form-layout"},[r("a-spin",{attrs:{spinning:e.loading}},[r("a-form",{attrs:{form:e.form,layout:"vertical"},on:{submit:e.handleSubmit}},[r("a-form-item",{attrs:{label:e.$t("label.rules.file")}},[r("a-upload-dragger",{directives:[{name:"decorator",rawName:"v-decorator",value:["file",{rules:[{required:!0,message:e.$t("message.error.required.input")},{validator:e.checkCsvRulesFile,message:e.$t("label.error.rules.file.import")}]}],expression:"['file', {\n            rules: [{ required: true, message: $t('message.error.required.input') },\n                    {\n                      validator: checkCsvRulesFile,\n                      message: $t('label.error.rules.file.import')\n                    }\n            ]\n          }]"}],attrs:{multiple:!1,fileList:e.fileList,remove:e.handleRemove,beforeUpload:e.beforeUpload},on:{change:e.handleChange}},[r("p",{staticClass:"ant-upload-drag-icon"},[r("a-icon",{attrs:{type:"cloud-upload"}})],1),0===e.fileList.length?r("p",{staticClass:"ant-upload-text"},[e._v(" "+e._s(e.$t("label.rules.file.import.description"))+" ")]):e._e()])],1),r("a-form-item",{attrs:{label:e.$t("label.name")}},[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:e.$t("message.error.required.input")}]}],expression:"['name', {\n            rules: [{ required: true, message: $t('message.error.required.input') }]\n          }]"}],attrs:{placeholder:e.importRoleApiParams.name.description}})],1),r("a-form-item",{attrs:{label:e.$t("label.description")}},[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["description"],expression:"['description']"}],attrs:{placeholder:e.importRoleApiParams.description.description}})],1),r("a-form-item",{attrs:{label:e.$t("label.type")}},[r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["type",{rules:[{required:!0,message:e.$t("message.error.select")}]}],expression:"['type', {\n            rules: [{ required: true, message: $t('message.error.select') }]\n          }]"}],attrs:{placeholder:e.importRoleApiParams.type.description}},e._l(e.defaultRoles,(function(t){return r("a-select-option",{key:t},[e._v(" "+e._s(t)+" ")])})),1)],1),r("a-form-item",{attrs:{label:e.$t("label.forced")}},[r("a-switch",{directives:[{name:"decorator",rawName:"v-decorator",value:["forced",{initialValue:!1}],expression:"['forced', {\n            initialValue: false\n          }]"}]})],1),r("div",{staticClass:"action-button",attrs:{span:24}},[r("a-button",{on:{click:e.closeAction}},[e._v(e._s(this.$t("label.cancel")))]),r("a-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.handleSubmit}},[e._v(e._s(this.$t("label.ok")))])],1)],1)],1)],1)},a=[],s=(r("4160"),r("c975"),r("d81d"),r("fb6a"),r("a434"),r("b0c0"),r("d3b7"),r("ac1f"),r("8a79"),r("1276"),r("2ca0"),r("498a"),r("159b"),r("365c")),o={name:"ImportRole",data:function(){return{fileList:[],defaultRoles:["Admin","DomainAdmin","ResourceAdmin","User"],rulesCsv:"",loading:!1}},beforeCreate:function(){var e=this;this.form=this.$form.createForm(this),this.apiConfig=this.$store.getters.apis.importRole||{},this.importRoleApiParams={},this.apiConfig.params.forEach((function(t){e.importRoleApiParams[t.name]=t}))},methods:{handleRemove:function(e){var t=this.fileList.indexOf(e),r=this.fileList.slice();r.splice(t,1),this.fileList=r},handleChange:function(e){"error"===e.file.status&&this.$notification.error({message:this.$t("label.error.file.upload"),description:this.$t("label.error.file.upload")})},beforeUpload:function(e){return"text/csv"!==e.type||(this.fileList=[e]),!1},handleSubmit:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,r){if(!e){var i={};for(var a in r){var s=r[a];void 0!==s&&("file"!==a&&(i[a]=s))}if(1===t.fileList.length){var o=t.rulesCsvToJson(t.rulesCsv);o.forEach((function(e,t){for(var r in e)i["rules["+t+"]."+r]=e[r]})),t.importRole(i)}}}))},closeAction:function(){this.$emit("close-action")},importRole:function(e){var t=this;this.loading=!0,Object(s["a"])("importRole",{},"POST",e).then((function(r){var i=r.importroleresponse.role;i&&(t.$emit("refresh-data"),t.$notification.success({message:"Import Role",description:"Sucessfully imported role "+e.name})),t.closeAction()})).catch((function(e){t.$notifyError(e)})).finally((function(){t.loading=!1}))},rulesCsvToJson:function(e){var t=",",r="\n",i=e.split(r),a=[];if(0===i.length)return a;var s=i[0].split(t);return i=i.slice(1),i.map((function(e,r){if(""!==e.trim()){var i={},o=e.trim().split(t);s.map((function(e,r){if(2===r&&o.length>3){o[r].startsWith('"')?i[e.trim()]=o[r].substr(1):i[e.trim()]=o[r];for(var a=3;a<o.length-1;a++)i[e.trim()]+=t+o[a];var s=o[o.length-1];s.endsWith('"')?i[e.trim()]+=t+s.substr(0,s.length-1):i[e.trim()]+=t+s}else i[e.trim()]=o[r]})),a.push(i)}})),a},checkCsvRulesFile:function(e,t,r){t&&""!==t&&""!==t.file?("text/csv"!==t.file.type&&r(e.message),this.readCsvFile(t.file).then((function(t){t?r():r(e.message)})).catch((function(t){console.log(t),r(e.message)}))):r()},readCsvFile:function(e){var t=this;return new Promise((function(r,i){if(window.FileReader){var a=new FileReader;a.onload=function(e){t.rulesCsv=e.target.result;var i=t.rulesCsv.split("\n"),a=i[0].split(",");3!==a.length||"rule"!==a[0].trim()||"permission"!==a[1].trim()||"description"!==a[2].trim()?r(!1):r(!0)},a.onerror=function(e){"NotReadableError"===e.target.error.name&&i(e.target.error)},a.readAsText(e)}else i(t.$t("label.error.file.read"))}))}}},n=o,l=(r("b37a"),r("2877")),c=Object(l["a"])(n,i,a,!1,null,"09889282",null);t["default"]=c.exports},"498a":function(e,t,r){"use strict";var i=r("23e7"),a=r("58a8").trim,s=r("c8d2");i({target:"String",proto:!0,forced:s("trim")},{trim:function(){return a(this)}})},9835:function(e,t,r){},b37a:function(e,t,r){"use strict";var i=r("9835"),a=r.n(i);a.a},c8d2:function(e,t,r){var i=r("d039"),a=r("5899"),s="​᠎";e.exports=function(e){return i((function(){return!!a[e]()||s[e]()!=s||a[e].name!==e}))}}}]);
//# sourceMappingURL=chunk-cc08a8f6.50837a78.js.map