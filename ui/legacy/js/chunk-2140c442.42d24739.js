(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2140c442"],{"082e":function(t,e,i){"use strict";var a=i("5548"),s=i.n(a);s.a},"498a":function(t,e,i){"use strict";var a=i("23e7"),s=i("58a8").trim,n=i("c8d2");a({target:"String",proto:!0,forced:n("trim")},{trim:function(){return s(this)}})},5548:function(t,e,i){},6718:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a-spin",{attrs:{spinning:t.loading}},[t.disableSettings?i("a-alert",{attrs:{banner:"",message:t.$t("message.action.settings.warning.vm.running")}}):i("div",[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.showAddDetail,expression:"!showAddDetail"}]},[i("a-button",{staticStyle:{width:"100%"},attrs:{type:"dashed",icon:"plus",disabled:!("updateTemplate"in t.$store.getters.apis&&"updateVirtualMachine"in t.$store.getters.apis&&t.isAdminOrOwner())},on:{click:t.onShowAddDetail}},[t._v(" "+t._s(t.$t("label.add.setting"))+" ")])],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.showAddDetail,expression:"showAddDetail"}]},[i("a-input-group",{attrs:{type:"text",compact:""}},[i("a-auto-complete",{ref:"keyElm",staticClass:"detail-input",attrs:{filterOption:t.filterOption,value:t.newKey,dataSource:Object.keys(t.detailOptions),placeholder:t.$t("label.name")},on:{change:function(e){return t.onAddInputChange(e,"newKey")}}}),i("a-input",{staticStyle:{width:"30px","border-left":"0","pointer-events":"none",backgroundColor:"#fff"},attrs:{placeholder:"=",disabled:""}}),i("a-auto-complete",{staticClass:"detail-input",attrs:{filterOption:t.filterOption,value:t.newValue,dataSource:t.detailOptions[t.newKey],placeholder:t.$t("label.value")},on:{change:function(e){return t.onAddInputChange(e,"newValue")}}}),i("a-tooltip",{attrs:{arrowPointAtCenter:"",placement:"topRight"}},[i("template",{slot:"title"},[t._v(" "+t._s(t.$t("label.add.setting"))+" ")]),i("a-button",{staticClass:"detail-button",attrs:{icon:"check"},on:{click:t.addDetail}})],2),i("a-tooltip",{attrs:{arrowPointAtCenter:"",placement:"topRight"}},[i("template",{slot:"title"},[t._v(" "+t._s(t.$t("label.cancel"))+" ")]),i("a-button",{staticClass:"detail-button",attrs:{icon:"close"},on:{click:t.closeDetail}})],2)],1),t.error?i("p",{staticStyle:{color:"red"}},[t._v(" "+t._s(t.$t(t.error))+" ")]):t._e()],1)]),i("a-list",{attrs:{size:"large"}},t._l(t.details,(function(e,a){return i("a-list-item",{key:a},[i("a-list-item-meta",[i("span",{attrs:{slot:"title"},slot:"title"},[t._v(" "+t._s(e.name)+" ")]),i("span",{staticStyle:{"word-break":"break-all"},attrs:{slot:"description"},slot:"description"},[e.edit?i("span",{staticStyle:{display:"flex"}},[i("a-auto-complete",{staticStyle:{width:"100%"},attrs:{value:e.value,dataSource:t.detailOptions[e.name]},on:{change:function(e){return t.handleInputChange(e,a)},pressEnter:function(e){return t.updateDetail(a)}}})],1):i("span",[t._v(t._s(e.value))])])]),!t.disableSettings&&"updateTemplate"in t.$store.getters.apis&&"updateVirtualMachine"in t.$store.getters.apis&&t.isAdminOrOwner()&&t.allowEditOfDetail(e.name)?i("div",{attrs:{slot:"actions"},slot:"actions"},[e.edit?i("a-button",{attrs:{shape:"circle",size:"default"},on:{click:function(e){return t.updateDetail(a)}}},[i("a-icon",{attrs:{type:"check-circle",theme:"twoTone",twoToneColor:"#52c41a"}})],1):t._e(),e.edit?i("a-button",{attrs:{shape:"circle",size:"default"},on:{click:function(e){return t.hideEditDetail(a)}}},[i("a-icon",{attrs:{type:"close-circle",theme:"twoTone",twoToneColor:"#f5222d"}})],1):t._e(),e.edit?t._e():i("a-button",{attrs:{shape:"circle",icon:"edit"},on:{click:function(e){return t.showEditDetail(a)}}})],1):t._e(),!t.disableSettings&&"updateTemplate"in t.$store.getters.apis&&"updateVirtualMachine"in t.$store.getters.apis&&t.isAdminOrOwner()&&t.allowEditOfDetail(e.name)?i("div",{attrs:{slot:"actions"},slot:"actions"},[i("a-popconfirm",{attrs:{title:t.$t("label.delete.setting")+"?",okText:t.$t("label.yes"),cancelText:t.$t("label.no"),placement:"left"},on:{confirm:function(e){return t.deleteDetail(a)}}},[i("a-button",{attrs:{shape:"circle",type:"danger",icon:"delete"}})],1)],1):t._e()],1)})),1)],1)},s=[],n=(i("4160"),i("caad"),i("c975"),i("d81d"),i("a434"),i("b0c0"),i("b64b"),i("d3b7"),i("ac1f"),i("2532"),i("1276"),i("498a"),i("159b"),i("365c")),r={name:"DetailSettings",props:{resource:{type:Object,required:!0}},data:function(){return{details:[],detailOptions:{},showAddDetail:!1,disableSettings:!1,newKey:"",newValue:"",loading:!1,resourceType:"UserVm",error:!1}},watch:{resource:function(t,e){this.updateResource(t)}},mounted:function(){this.updateResource(this.resource)},methods:{filterOption:function(t,e){return e.componentOptions.children[0].text.toUpperCase().indexOf(t.toUpperCase())>=0},updateResource:function(t){var e=this;this.details=[],t&&(this.resource=t,this.resourceType=this.$route.meta.resourceType,t.details&&(this.details=Object.keys(this.resource.details).map((function(t){return{name:t,value:e.resource.details[t],edit:!1}}))),Object(n["a"])("listDetailOptions",{resourcetype:this.resourceType,resourceid:this.resource.id}).then((function(t){e.detailOptions=t.listdetailoptionsresponse.detailoptions.details})),this.disableSettings="vm"===this.$route.meta.name&&"Stopped"!==this.resource.state)},allowEditOfDetail:function(t){return!this.resource.readonlyuidetails||!this.resource.readonlyuidetails.split(",").map((function(t){return t.trim()})).includes(t)},showEditDetail:function(t){this.details[t].edit=!0,this.details[t].originalValue=this.details[t].value,this.$set(this.details,t,this.details[t])},hideEditDetail:function(t){this.details[t].edit=!1,this.details[t].value=this.details[t].originalValue,this.$set(this.details,t,this.details[t])},handleInputChange:function(t,e){this.details[e].value=t,this.$set(this.details,e,this.details[e])},onAddInputChange:function(t,e){this.error=!1,this[e]=t},isAdminOrOwner:function(){return["Admin"].includes(this.$store.getters.userInfo.roletype)||this.resource.domainid===this.$store.getters.userInfo.domainid&&this.resource.account===this.$store.getters.userInfo.account||this.resource.project&&this.resource.projectid===this.$store.getters.project.id},runApi:function(){var t=this,e="";if("UserVm"===this.resourceType?e="updateVirtualMachine":"Template"===this.resourceType&&(e="updateTemplate"),e in this.$store.getters.apis){var i={id:this.resource.id};0===this.details.length?i.cleanupdetails=!0:this.details.forEach((function(t,e){i["details[0]."+t.name]=t.value})),this.loading=!0,Object(n["a"])(e,i).then((function(e){var i={};"UserVm"===t.resourceType&&e.updatevirtualmachineresponse.virtualmachine.details?i=e.updatevirtualmachineresponse.virtualmachine.details:"Template"===t.resourceType&&e.updatetemplateresponse.template.details&&(i=e.updatetemplateresponse.template.details),t.details=Object.keys(i).map((function(t){return{name:t,value:i[t],edit:!1}}))})).catch((function(e){t.$notifyError(e)})).finally((function(e){t.loading=!1,t.showAddDetail=!1,t.newKey="",t.newValue=""}))}else this.$notification.error({message:this.$t("error.execute.api.failed")+" "+e,description:this.$t("message.user.not.permitted.api")})},addDetail:function(){""!==this.newKey&&""!==this.newValue?(this.error=!1,this.details.push({name:this.newKey,value:this.newValue}),this.runApi()):this.error=this.$t("message.error.provide.setting")},updateDetail:function(t){this.runApi()},deleteDetail:function(t){this.details.splice(t,1),this.runApi()},onShowAddDetail:function(){var t=this;this.showAddDetail=!0,setTimeout((function(){t.$refs.keyElm.focus()}))},closeDetail:function(){this.newKey="",this.newValue="",this.error=!1,this.showAddDetail=!1}}},o=r,l=(i("082e"),i("2877")),c=Object(l["a"])(o,a,s,!1,null,"59e82484",null);e["default"]=c.exports},c8d2:function(t,e,i){var a=i("d039"),s=i("5899"),n="​᠎";t.exports=function(t){return a((function(){return!!s[t]()||n[t]()!=n||s[t].name!==t}))}}}]);
//# sourceMappingURL=chunk-2140c442.42d24739.js.map