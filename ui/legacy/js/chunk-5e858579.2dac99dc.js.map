{"version":3,"sources":["webpack:///./src/views/infra/MigrateData.vue?74fc","webpack:///src/views/infra/MigrateData.vue","webpack:///./src/views/infra/MigrateData.vue?2cda","webpack:///./src/views/infra/MigrateData.vue","webpack:///./src/views/infra/MigrateData.vue?b6b9"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","loading","form","on","handleSubmit","$t","directives","name","rawName","value","initialValue","selectedStore","rules","required","message","expression","val","_l","store","key","id","_v","_s","opt","url","_e","closeAction","staticRenderFns","inject","data","imageStores","beforeCreate","$form","createForm","mounted","fetchImageStores","methods","e","preventDefault","validateFields","err","undefined","input","params","join","result","then","success","title","description","duration","console","log","error","setTimeout","migrateData","Promise","reject","$emit","component"],"mappings":"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","file":"js/chunk-5e858579.2dac99dc.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"form-layout\"},[_c('a-spin',{attrs:{\"spinning\":_vm.loading}},[_c('a-form',{attrs:{\"form\":_vm.form,\"layout\":\"vertical\"},on:{\"submit\":_vm.handleSubmit}},[_c('a-form-item',{attrs:{\"label\":_vm.$t('migrate.from')}},[_c('a-select',{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:(['srcpool', {\n            initialValue: _vm.selectedStore,\n            rules: [\n              {\n                required: true,\n                message: _vm.$t('message.error.select'),\n              }]\n          }]),expression:\"['srcpool', {\\n            initialValue: selectedStore,\\n            rules: [\\n              {\\n                required: true,\\n                message: $t('message.error.select'),\\n              }]\\n          }]\"}],attrs:{\"loading\":_vm.loading},on:{\"change\":function (val) { _vm.selectedStore = val }}},_vm._l((_vm.imageStores),function(store){return _c('a-select-option',{key:store.id},[_vm._v(_vm._s(store.name || _vm.opt.url))])}),1)],1),_c('a-form-item',{attrs:{\"label\":_vm.$t('migrate.to')}},[_c('a-select',{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:(['destpools', {\n            rules: [\n              {\n                required: true,\n                message: _vm.$t('message.select.destination.image.stores'),\n              }]\n          }]),expression:\"['destpools', {\\n            rules: [\\n              {\\n                required: true,\\n                message: $t('message.select.destination.image.stores'),\\n              }]\\n          }]\"}],attrs:{\"mode\":\"multiple\",\"loading\":_vm.loading}},_vm._l((_vm.imageStores),function(store){return (store.id !== _vm.selectedStore)?_c('a-select-option',{key:store.id},[_vm._v(_vm._s(store.name || _vm.opt.url))]):_vm._e()}),1)],1),_c('a-form-item',{attrs:{\"label\":_vm.$t('migrationPolicy')}},[_c('a-select',{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:(['migrationtype', {\n            initialValue: 'Complete',\n            rules: [\n              {\n                required: true,\n                message: _vm.$t('message.select.migration.policy'),\n              }]\n          }]),expression:\"['migrationtype', {\\n            initialValue: 'Complete',\\n            rules: [\\n              {\\n                required: true,\\n                message: $t('message.select.migration.policy'),\\n              }]\\n          }]\"}],attrs:{\"loading\":_vm.loading}},[_c('a-select-option',{attrs:{\"value\":\"Complete\"}},[_vm._v(_vm._s(_vm.$t('label.complete')))]),_c('a-select-option',{attrs:{\"value\":\"Balance\"}},[_vm._v(_vm._s(_vm.$t('label.balance')))])],1)],1),_c('div',{staticClass:\"action-button\",attrs:{\"span\":24}},[_c('a-button',{on:{\"click\":_vm.closeAction}},[_vm._v(_vm._s(this.$t('label.cancel')))]),_c('a-button',{attrs:{\"loading\":_vm.loading,\"type\":\"primary\"},on:{\"click\":_vm.handleSubmit}},[_vm._v(_vm._s(this.$t('label.ok')))])],1)],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","// Licensed to the Apache Software Foundation (ASF) under one\n// or more contributor license agreements.  See the NOTICE file\n// distributed with this work for additional information\n// regarding copyright ownership.  The ASF licenses this file\n// to you under the Apache License, Version 2.0 (the\n// \"License\"); you may not use this file except in compliance\n// with the License.  You may obtain a copy of the License at\n//\n//   http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing,\n// software distributed under the License is distributed on an\n// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n// KIND, either express or implied.  See the License for the\n// specific language governing permissions and limitations\n// under the License.\n\n<template>\n  <div class=\"form-layout\">\n    <a-spin :spinning=\"loading\">\n      <a-form :form=\"form\" @submit=\"handleSubmit\" layout=\"vertical\">\n        <a-form-item\n          :label=\"$t('migrate.from')\">\n          <a-select\n            v-decorator=\"['srcpool', {\n              initialValue: selectedStore,\n              rules: [\n                {\n                  required: true,\n                  message: $t('message.error.select'),\n                }]\n            }]\"\n            :loading=\"loading\"\n            @change=\"val => { selectedStore = val }\"\n          >\n            <a-select-option\n              v-for=\"store in imageStores\"\n              :key=\"store.id\"\n            >{{ store.name || opt.url }}</a-select-option>\n          </a-select>\n        </a-form-item>\n        <a-form-item\n          :label=\"$t('migrate.to')\">\n          <a-select\n            v-decorator=\"['destpools', {\n              rules: [\n                {\n                  required: true,\n                  message: $t('message.select.destination.image.stores'),\n                }]\n            }]\"\n            mode=\"multiple\"\n            :loading=\"loading\"\n          >\n            <a-select-option\n              v-for=\"store in imageStores\"\n              v-if=\"store.id !== selectedStore\"\n              :key=\"store.id\"\n            >{{ store.name || opt.url }}</a-select-option>\n          </a-select>\n        </a-form-item>\n        <a-form-item :label=\"$t('migrationPolicy')\">\n          <a-select\n            v-decorator=\"['migrationtype', {\n              initialValue: 'Complete',\n              rules: [\n                {\n                  required: true,\n                  message: $t('message.select.migration.policy'),\n                }]\n            }]\"\n            :loading=\"loading\"\n          >\n            <a-select-option value=\"Complete\">{{ $t('label.complete') }}</a-select-option>\n            <a-select-option value=\"Balance\">{{ $t('label.balance') }}</a-select-option>\n          </a-select>\n        </a-form-item>\n        <div :span=\"24\" class=\"action-button\">\n          <a-button @click=\"closeAction\">{{ this.$t('label.cancel') }}</a-button>\n          <a-button :loading=\"loading\" type=\"primary\" @click=\"handleSubmit\">{{ this.$t('label.ok') }}</a-button>\n        </div>\n      </a-form>\n    </a-spin>\n  </div>\n</template>\n<script>\nimport { api } from '@/api'\nexport default {\n  name: 'MigrateData',\n  inject: ['parentFetchData'],\n  data () {\n    return {\n      imageStores: [],\n      loading: false,\n      selectedStore: ''\n    }\n  },\n  beforeCreate () {\n    this.form = this.$form.createForm(this)\n  },\n  mounted () {\n    this.fetchImageStores()\n  },\n  methods: {\n    fetchImageStores () {\n      this.loading = true\n      api('listImageStores').then(json => {\n        this.imageStores = json.listimagestoresresponse.imagestore || []\n        this.selectedStore = this.imageStores[0].id || ''\n      }).finally(() => {\n        this.loading = false\n      })\n    },\n    handleSubmit (e) {\n      e.preventDefault()\n      this.form.validateFields((err, values) => {\n        if (err) {\n          return\n        }\n        const params = {}\n        for (const key in values) {\n          const input = values[key]\n          if (input === undefined) {\n            continue\n          }\n          if (key === 'destpools') {\n            params[key] = input.join(',')\n          } else {\n            params[key] = input\n          }\n        }\n\n        const title = this.$t('message.data.migration')\n        this.loading = true\n\n        const result = this.migrateData(params, title)\n        result.then(json => {\n          const result = json.jobresult\n          const success = result.imagestore.success || false\n          const message = result.imagestore.message || ''\n          if (success) {\n            this.$notification.success({\n              message: title,\n              description: message\n            })\n          } else {\n            this.$notification.error({\n              message: title,\n              description: message,\n              duration: 0\n            })\n          }\n          this.parentFetchData()\n          this.closeAction()\n        }).catch(error => {\n          console.log(error)\n        })\n        setTimeout(() => {\n          this.$message.loading({ content: this.$t('label.migrating.data'), duration: 1 })\n          this.loading = false\n          this.closeAction()\n        }, 200)\n      })\n    },\n    migrateData (args, title) {\n      return new Promise((resolve, reject) => {\n        api('migrateSecondaryStorageData', args).then(async json => {\n          const jobId = json.migratesecondarystoragedataresponse.jobid\n          if (jobId) {\n            this.$store.dispatch('AddAsyncJob', {\n              title: title,\n              jobid: jobId,\n              description: this.$t('message.data.migration.progress'),\n              status: 'progress',\n              silent: true\n            })\n            const result = await this.pollJob(jobId, title)\n            if (result.jobstatus === 2) {\n              reject(result.jobresult.errortext)\n              return\n            }\n            resolve(result)\n          }\n        }).catch(error => {\n          reject(error)\n        })\n      })\n    },\n    async pollJob (jobId, title) {\n      return new Promise(resolve => {\n        const asyncJobInterval = setInterval(() => {\n          api('queryAsyncJobResult', { jobId }).then(async json => {\n            const result = json.queryasyncjobresultresponse\n            if (result.jobstatus === 0) {\n              return\n            }\n            clearInterval(asyncJobInterval)\n            resolve(result)\n          })\n        }, 1000)\n      })\n    },\n    closeAction () {\n      this.$emit('close-action')\n    }\n  }\n}\n</script>\n<style lang=\"scss\" scoped>\n.form-layout {\n  width: 85vw;\n\n  @media (min-width: 1000px) {\n    width: 40vw;\n  }\n}\n\n.action-button {\n  text-align: right;\n\n  button {\n    margin-right: 5px;\n  }\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MigrateData.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MigrateData.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./MigrateData.vue?vue&type=template&id=8f005a9c&scoped=true&\"\nimport script from \"./MigrateData.vue?vue&type=script&lang=js&\"\nexport * from \"./MigrateData.vue?vue&type=script&lang=js&\"\nimport style0 from \"./MigrateData.vue?vue&type=style&index=0&id=8f005a9c&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"8f005a9c\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MigrateData.vue?vue&type=style&index=0&id=8f005a9c&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MigrateData.vue?vue&type=style&index=0&id=8f005a9c&lang=scss&scoped=true&\""],"sourceRoot":""}